<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=0x5h1n0k0><link href=https://0x5h1n0k0.github.io/dvwa/sql-injection/ rel=canonical><link rel=icon href=../../assets/favicon.png><meta name=generator content="mkdocs-1.5.2, mkdocs-material-8.3.9"><title>SQL Injection | 0x5h1n0k0</title><link rel=stylesheet href=../../assets/stylesheets/main.1d29e8d0.min.css><link rel=stylesheet href=../../assets/stylesheets/cur.css><link rel=stylesheet href=../../assets/stylesheets/footer.scss><link rel=stylesheet href=../../assets/stylesheets/palette.cbb835fc.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Sans:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Fira Sans";--md-code-font:"Fira Code"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XXXXXXXXXX"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&gtag("event","search",{search_term:this.value})}),"undefined"!=typeof location$&&location$.subscribe(function(e){gtag("config","G-XXXXXXXXXX",{page_path:e.pathname})})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script><link rel=stylesheet href=../../overrides/assets/stylesheets/main.82a244a8.min.css><!-- live 2d --><link href=https://r18-nmsl.cn/pio/pio.css rel=stylesheet type=text/css><!-- <link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css">
    <script src="https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js"></script> --></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#sql-injection class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=0x5h1n0k0 class="md-header__button md-logo" aria-label=0x5h1n0k0 data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82z"></path></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> 0x5h1n0k0 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> SQL Injection </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/0x5h1n0k0/0x5h1n0k0.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> 0x5h1n0k0/0x5h1n0k0.github.io <ul class=md-source__facts> </ul> </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=0x5h1n0k0 class="md-nav__button md-logo" aria-label=0x5h1n0k0 data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82z"></path></svg> </a> 0x5h1n0k0 </label> <div class=md-nav__source> <a href=https://github.com/0x5h1n0k0/0x5h1n0k0.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> 0x5h1n0k0/0x5h1n0k0.github.io <ul class=md-source__facts> </ul> </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> PINNED <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=PINNED data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> PINNED </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cve/ class=md-nav__link> CVE </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1_2 type=checkbox id=__nav_1_2> <label class=md-nav__link for=__nav_1_2> Privilege Escalation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Privilege Escalation" data-md-level=2> <label class=md-nav__title for=__nav_1_2> <span class="md-nav__icon md-icon"></span> Privilege Escalation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../notes/privilege-escalation/linux/ class=md-nav__link> Linux Privilege Escalation </a> </li> <li class=md-nav__item> <a href=../../notes/privilege-escalation/windows/ class=md-nav__link> Windows Privilege Escalation </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../notes/reverse-shell/ class=md-nav__link> Reverse Shell Cheatsheet </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Try Hack Me <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Try Hack Me" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Try Hack Me </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tryhackme/room/ class=md-nav__link> Machines </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> 247CTF <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=247CTF data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> 247CTF </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../247ctf/ class=md-nav__link> Web </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../ class=md-nav__link> DVWA </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#security-level-low class=md-nav__link> Security Level: Low </a> <nav class=md-nav aria-label="Security Level: Low"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#analysis class=md-nav__link> Analysis </a> </li> <li class=md-nav__item> <a href=#exploition class=md-nav__link> Exploition </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#security-level-medium class=md-nav__link> Security Level: Medium </a> <nav class=md-nav aria-label="Security Level: Medium"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#analysis_1 class=md-nav__link> Analysis </a> </li> <li class=md-nav__item> <a href=#exploition_1 class=md-nav__link> Exploition </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#security-level-high class=md-nav__link> Security Level: High </a> <nav class=md-nav aria-label="Security Level: High"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#analysis_2 class=md-nav__link> Analysis </a> </li> <li class=md-nav__item> <a href=#exploition_2 class=md-nav__link> Exploition </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#security-level-impossible class=md-nav__link> Security Level: Impossible </a> <nav class=md-nav aria-label="Security Level: Impossible"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#analysis_3 class=md-nav__link> Analysis </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#what-we-learned class=md-nav__link> What we learned </a> </li> <li class=md-nav__item> <a href=#more-information class=md-nav__link> More Information </a> </li> <li class=md-nav__item> <a href=#see-more class=md-nav__link> See more </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <aside class=mdx-author> </aside> <div class=tags-items style="color: var(--md-default-fg-color--light); padding-bottom: 10px; opacity: 0.9">Tags</div> <a href=https://github.com/0x5h1n0k0/0x5h1n0k0.github.io/edit/master/docs/dvwa/sql-injection/index.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg> </a> <a href=https://github.com/0x5h1n0k0/0x5h1n0k0.github.io/edit/master/docs/dvwa/sql-injection/index.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg> </a> <nav class=md-tags> <a href=../../tags/tags/#dvwa class=md-tag> DVWA </a> </nav> <h1 id=sql-injection><strong>SQL Injection</strong><a class=headerlink href=#sql-injection title="Permanent link">&para;</a></h1><p style="color:#bdbdbd"><i>Estimated time to read: 8 minutes</i></p>
 <p><em>Notes: Mục tiêu của challenge này là tìm được password của các user.</em></p> <hr> <h2 id=security-level-low><strong>Security Level: Low</strong><a class=headerlink href=#security-level-low title="Permanent link">&para;</a></h2> <p>Source code</p> <div class=highlight><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>vulnerabilities/sqli/source/low.php</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1> 1</a></span>
<span class=normal><a href=#__codelineno-0-2> 2</a></span>
<span class=normal><a href=#__codelineno-0-3> 3</a></span>
<span class=normal><a href=#__codelineno-0-4> 4</a></span>
<span class=normal><a href=#__codelineno-0-5> 5</a></span>
<span class=normal><a href=#__codelineno-0-6> 6</a></span>
<span class=normal><a href=#__codelineno-0-7> 7</a></span>
<span class=normal><a href=#__codelineno-0-8> 8</a></span>
<span class=normal><a href=#__codelineno-0-9> 9</a></span>
<span class=normal><a href=#__codelineno-0-10>10</a></span>
<span class=normal><a href=#__codelineno-0-11>11</a></span>
<span class=normal><a href=#__codelineno-0-12>12</a></span>
<span class=normal><a href=#__codelineno-0-13>13</a></span>
<span class=normal><a href=#__codelineno-0-14>14</a></span>
<span class=normal><a href=#__codelineno-0-15>15</a></span>
<span class=normal><a href=#__codelineno-0-16>16</a></span>
<span class=normal><a href=#__codelineno-0-17>17</a></span>
<span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span>
<span class=normal><a href=#__codelineno-0-31>31</a></span>
<span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span>
<span class=normal><a href=#__codelineno-0-39>39</a></span>
<span class=normal><a href=#__codelineno-0-40>40</a></span>
<span class=normal><a href=#__codelineno-0-41>41</a></span>
<span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span>
<span class=normal><a href=#__codelineno-0-44>44</a></span>
<span class=normal><a href=#__codelineno-0-45>45</a></span>
<span class=normal><a href=#__codelineno-0-46>46</a></span>
<span class=normal><a href=#__codelineno-0-47>47</a></span>
<span class=normal><a href=#__codelineno-0-48>48</a></span>
<span class=normal><a href=#__codelineno-0-49>49</a></span>
<span class=normal><a href=#__codelineno-0-50>50</a></span>
<span class=normal><a href=#__codelineno-0-51>51</a></span>
<span class=normal><a href=#__codelineno-0-52>52</a></span>
<span class=normal><a href=#__codelineno-0-53>53</a></span>
<span class=normal><a href=#__codelineno-0-54>54</a></span>
<span class=normal><a href=#__codelineno-0-55>55</a></span>
<span class=normal><a href=#__codelineno-0-56>56</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1></a><span class=cp>&lt;?php</span>
<a id=__codelineno-0-2 name=__codelineno-0-2></a>
<a id=__codelineno-0-3 name=__codelineno-0-3></a><span class=k>if</span><span class=p>(</span> <span class=nb>isset</span><span class=p>(</span> <span class=nv>$_REQUEST</span><span class=p>[</span> <span class=s1>&#39;Submit&#39;</span> <span class=p>]</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-0-4 name=__codelineno-0-4></a>    <span class=c1>// Get input</span>
<a id=__codelineno-0-5 name=__codelineno-0-5></a>    <span class=nv>$id</span> <span class=o>=</span> <span class=nv>$_REQUEST</span><span class=p>[</span> <span class=s1>&#39;id&#39;</span> <span class=p>];</span>
<a id=__codelineno-0-6 name=__codelineno-0-6></a>
<a id=__codelineno-0-7 name=__codelineno-0-7></a>    <span class=k>switch</span> <span class=p>(</span><span class=nv>$_DVWA</span><span class=p>[</span><span class=s1>&#39;SQLI_DB&#39;</span><span class=p>])</span> <span class=p>{</span>
<a id=__codelineno-0-8 name=__codelineno-0-8></a>        <span class=k>case</span> <span class=nx>MYSQL</span><span class=o>:</span>
<a id=__codelineno-0-9 name=__codelineno-0-9></a>            <span class=c1>// Check database</span>
<a id=__codelineno-0-10 name=__codelineno-0-10></a><span class=hll>            <span class=nv>$query</span>  <span class=o>=</span> <span class=s2>&quot;SELECT first_name, last_name FROM users WHERE user_id = &#39;</span><span class=si>$id</span><span class=s2>&#39;;&quot;</span><span class=p>;</span>
</span><a id=__codelineno-0-11 name=__codelineno-0-11></a>            <span class=nv>$result</span> <span class=o>=</span> <span class=nx>mysqli_query</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>],</span>  <span class=nv>$query</span> <span class=p>)</span> <span class=k>or</span> <span class=k>die</span><span class=p>(</span> <span class=s1>&#39;&lt;pre&gt;&#39;</span> <span class=o>.</span> <span class=p>((</span><span class=nb>is_object</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>]))</span> <span class=o>?</span> <span class=nx>mysqli_error</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>])</span> <span class=o>:</span> <span class=p>((</span><span class=nv>$___mysqli_res</span> <span class=o>=</span> <span class=nx>mysqli_connect_error</span><span class=p>())</span> <span class=o>?</span> <span class=nv>$___mysqli_res</span> <span class=o>:</span> <span class=k>false</span><span class=p>))</span> <span class=o>.</span> <span class=s1>&#39;&lt;/pre&gt;&#39;</span> <span class=p>);</span>
<a id=__codelineno-0-12 name=__codelineno-0-12></a>
<a id=__codelineno-0-13 name=__codelineno-0-13></a>            <span class=c1>// Get results</span>
<a id=__codelineno-0-14 name=__codelineno-0-14></a>            <span class=k>while</span><span class=p>(</span> <span class=nv>$row</span> <span class=o>=</span> <span class=nx>mysqli_fetch_assoc</span><span class=p>(</span> <span class=nv>$result</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-0-15 name=__codelineno-0-15></a>                <span class=c1>// Get values</span>
<a id=__codelineno-0-16 name=__codelineno-0-16></a>                <span class=nv>$first</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s2>&quot;first_name&quot;</span><span class=p>];</span>
<a id=__codelineno-0-17 name=__codelineno-0-17></a>                <span class=nv>$last</span>  <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s2>&quot;last_name&quot;</span><span class=p>];</span>
<a id=__codelineno-0-18 name=__codelineno-0-18></a>
<a id=__codelineno-0-19 name=__codelineno-0-19></a>                <span class=c1>// Feedback for end user</span>
<a id=__codelineno-0-20 name=__codelineno-0-20></a>                <span class=k>echo</span> <span class=s2>&quot;&lt;pre&gt;ID: </span><span class=si>{</span><span class=nv>$id</span><span class=si>}</span><span class=s2>&lt;br /&gt;First name: </span><span class=si>{</span><span class=nv>$first</span><span class=si>}</span><span class=s2>&lt;br /&gt;Surname: </span><span class=si>{</span><span class=nv>$last</span><span class=si>}</span><span class=s2>&lt;/pre&gt;&quot;</span><span class=p>;</span>
<a id=__codelineno-0-21 name=__codelineno-0-21></a>            <span class=p>}</span>
<a id=__codelineno-0-22 name=__codelineno-0-22></a>
<a id=__codelineno-0-23 name=__codelineno-0-23></a>            <span class=nx>mysqli_close</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>]);</span>
<a id=__codelineno-0-24 name=__codelineno-0-24></a>            <span class=k>break</span><span class=p>;</span>
<a id=__codelineno-0-25 name=__codelineno-0-25></a>        <span class=k>case</span> <span class=nx>SQLITE</span><span class=o>:</span>
<a id=__codelineno-0-26 name=__codelineno-0-26></a>            <span class=k>global</span> <span class=nv>$sqlite_db_connection</span><span class=p>;</span>
<a id=__codelineno-0-27 name=__codelineno-0-27></a>
<a id=__codelineno-0-28 name=__codelineno-0-28></a>            <span class=c1>#$sqlite_db_connection = new SQLite3($_DVWA[&#39;SQLITE_DB&#39;]);</span>
<a id=__codelineno-0-29 name=__codelineno-0-29></a>            <span class=c1>#$sqlite_db_connection-&gt;enableExceptions(true);</span>
<a id=__codelineno-0-30 name=__codelineno-0-30></a>
<a id=__codelineno-0-31 name=__codelineno-0-31></a>            <span class=nv>$query</span>  <span class=o>=</span> <span class=s2>&quot;SELECT first_name, last_name FROM users WHERE user_id = &#39;</span><span class=si>$id</span><span class=s2>&#39;;&quot;</span><span class=p>;</span>
<a id=__codelineno-0-32 name=__codelineno-0-32></a>            <span class=c1>#print $query;</span>
<a id=__codelineno-0-33 name=__codelineno-0-33></a>            <span class=k>try</span> <span class=p>{</span>
<a id=__codelineno-0-34 name=__codelineno-0-34></a>                <span class=nv>$results</span> <span class=o>=</span> <span class=nv>$sqlite_db_connection</span><span class=o>-&gt;</span><span class=na>query</span><span class=p>(</span><span class=nv>$query</span><span class=p>);</span>
<a id=__codelineno-0-35 name=__codelineno-0-35></a>            <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>Exception</span> <span class=nv>$e</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-0-36 name=__codelineno-0-36></a>                <span class=k>echo</span> <span class=s1>&#39;Caught exception: &#39;</span> <span class=o>.</span> <span class=nv>$e</span><span class=o>-&gt;</span><span class=na>getMessage</span><span class=p>();</span>
<a id=__codelineno-0-37 name=__codelineno-0-37></a>                <span class=k>exit</span><span class=p>();</span>
<a id=__codelineno-0-38 name=__codelineno-0-38></a>            <span class=p>}</span>
<a id=__codelineno-0-39 name=__codelineno-0-39></a>
<a id=__codelineno-0-40 name=__codelineno-0-40></a>            <span class=k>if</span> <span class=p>(</span><span class=nv>$results</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-0-41 name=__codelineno-0-41></a>                <span class=k>while</span> <span class=p>(</span><span class=nv>$row</span> <span class=o>=</span> <span class=nv>$results</span><span class=o>-&gt;</span><span class=na>fetchArray</span><span class=p>())</span> <span class=p>{</span>
<a id=__codelineno-0-42 name=__codelineno-0-42></a>                    <span class=c1>// Get values</span>
<a id=__codelineno-0-43 name=__codelineno-0-43></a>                    <span class=nv>$first</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s2>&quot;first_name&quot;</span><span class=p>];</span>
<a id=__codelineno-0-44 name=__codelineno-0-44></a>                    <span class=nv>$last</span>  <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s2>&quot;last_name&quot;</span><span class=p>];</span>
<a id=__codelineno-0-45 name=__codelineno-0-45></a>
<a id=__codelineno-0-46 name=__codelineno-0-46></a>                    <span class=c1>// Feedback for end user</span>
<a id=__codelineno-0-47 name=__codelineno-0-47></a>                    <span class=k>echo</span> <span class=s2>&quot;&lt;pre&gt;ID: </span><span class=si>{</span><span class=nv>$id</span><span class=si>}</span><span class=s2>&lt;br /&gt;First name: </span><span class=si>{</span><span class=nv>$first</span><span class=si>}</span><span class=s2>&lt;br /&gt;Surname: </span><span class=si>{</span><span class=nv>$last</span><span class=si>}</span><span class=s2>&lt;/pre&gt;&quot;</span><span class=p>;</span>
<a id=__codelineno-0-48 name=__codelineno-0-48></a>                <span class=p>}</span>
<a id=__codelineno-0-49 name=__codelineno-0-49></a>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
<a id=__codelineno-0-50 name=__codelineno-0-50></a>                <span class=k>echo</span> <span class=s2>&quot;Error in fetch &quot;</span><span class=o>.</span><span class=nv>$sqlite_db</span><span class=o>-&gt;</span><span class=na>lastErrorMsg</span><span class=p>();</span>
<a id=__codelineno-0-51 name=__codelineno-0-51></a>            <span class=p>}</span>
<a id=__codelineno-0-52 name=__codelineno-0-52></a>            <span class=k>break</span><span class=p>;</span>
<a id=__codelineno-0-53 name=__codelineno-0-53></a>    <span class=p>}</span> 
<a id=__codelineno-0-54 name=__codelineno-0-54></a><span class=p>}</span>
<a id=__codelineno-0-55 name=__codelineno-0-55></a>
<a id=__codelineno-0-56 name=__codelineno-0-56></a><span class=cp>?&gt;</span>
</code></pre></div></td></tr></table></div> <h3 id=analysis><strong>Analysis</strong><a class=headerlink href=#analysis title="Permanent link">&para;</a></h3> <p>Ta sẽ thăm dò một vài thứ từ cơ sở dữ liệu.</p> <p>Đầu tiên, ta nhận thấy trong database chỉ có 5 user (thông qua việc check user ID)</p> <p><img alt src=image.png></p> <p>Để ý source code trên ở dòng 10</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>first_name</span><span class=p>,</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>user_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;$id&#39;</span><span class=p>;</span>
</code></pre></div> <p>Ta thấy câu lệnh truy vấn cơ sở dữ liệu khá đơn giản, lấy thông tin của biến <code>$id</code> để check giá trị của <code>user_id</code>. Chuyện gì xảy ra nếu giá trị của biến <code>$id</code> là <code>1'or '1'='1</code>. Ngay lập tức nó đem giá trị này vào <code>user_id</code> và kết hợp với dấu <code>'</code> trong code, ta được câu lệnh full như sau</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>first_name</span><span class=p>,</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>user_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=k>or</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=o>=</span><span class=s1>&#39;1&#39;</span><span class=p>;</span>
</code></pre></div> <p>Lúc này, ngay lập tức câu lệnh select của ta sẽ tồn tại logic <code>or '1'='1'</code> thể hiện việc điều kiện where luôn đúng. Điều này về cơ bản sẽ đồng nghĩa với câu lệnh sau</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>first_name</span><span class=p>,</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span>
</code></pre></div> <p>Đã có cái nhìn đầu tiên cho challenge, ta sẽ tiến hành khai thác nó thôi</p> <h3 id=exploition><strong>Exploition</strong><a class=headerlink href=#exploition title="Permanent link">&para;</a></h3> <p>Bằng việc thêm logic cơ bản (or'1'='1) ta dễ dàng lấy được thông tin toàn bộ user trong table <code>users</code></p> <p><img alt src=image-1.png></p> <p>Oke, đã thành công tiêm payload, giờ là bước kết hợp các loại select để tìm ra được các cột có thể khai thác trong tables user</p> <p>Đầu tiên ta phải xác định hệ quản trị cơ sở dữ liệu của challenge này là loại gì bằng cách tiêm payload lỗi để nhận thông báo lỗi</p> <p><img alt src=image-2.png></p> <p>Thấy rằng, họ dùng mysql. Trong mysql ta sẽ có table <code>information_schema.tables</code> là bảng chứa tất cả các bảng dữ liệu trong cơ sở dữ liệu.</p> <p>Ta sẽ lần lượt tìm kiếm thông tin của bảng dữ liệu chứa password</p> <blockquote> <p>Trường hợp bảng users chỉ lưu thông tin cơ bản của user như username, first_name, last_name,... và tồn tại 1 table khác lưu thông tin password của user. Hai bảng này kết nối với nhau thông qua username chẳng hạn.</p> </blockquote> <details class=tip> <summary>Đừng xem</summary> <p>'union select 1,table_name from information_schema.tables#</p> </details> <p><img alt src=image-3.png></p> <p>Ta nhận được bảng users và guestbook. Thì ta có thể kết luận password có thể lưu vào bảng users. </p> <p>Roài ta sẽ tiếp tục xem table users có tổng cộng bao nhiêu cột</p> <details class=tip> <summary>Đừng xem</summary> <p>'union select 1,column_name from information_schema.columns where table_name="users" #</p> </details> <p><img alt src=image-4.png></p> <p>Sau khi có thông tin các cột trong bảng thì dễ rồi, ta sẽ lấy ra password của các user bằng việc lấy ra cột password và cột user_id</p> <details class=tip> <summary>Đừng xem</summary> <p>'union select 1,concat(user_id," ",password) from users #</p> </details> <p><img alt src=image-5.png></p> <p>Mục tiêu hoàn thành.</p> <hr> <h2 id=security-level-medium><strong>Security Level: Medium</strong><a class=headerlink href=#security-level-medium title="Permanent link">&para;</a></h2> <p>Source code</p> <div class=highlight><span class=filename>vulnerabilities/sqli/source/medium.php</span><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=cp>&lt;?php</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=k>if</span><span class=p>(</span> <span class=nb>isset</span><span class=p>(</span> <span class=nv>$_POST</span><span class=p>[</span> <span class=s1>&#39;Submit&#39;</span> <span class=p>]</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>    <span class=c1>// Get input</span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>    <span class=nv>$id</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span> <span class=s1>&#39;id&#39;</span> <span class=p>];</span>
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>    <span class=nv>$id</span> <span class=o>=</span> <span class=nx>mysqli_real_escape_string</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>],</span> <span class=nv>$id</span><span class=p>);</span>
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>    <span class=k>switch</span> <span class=p>(</span><span class=nv>$_DVWA</span><span class=p>[</span><span class=s1>&#39;SQLI_DB&#39;</span><span class=p>])</span> <span class=p>{</span>
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>        <span class=k>case</span> <span class=nx>MYSQL</span><span class=o>:</span>
<a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>            <span class=nv>$query</span>  <span class=o>=</span> <span class=s2>&quot;SELECT first_name, last_name FROM users WHERE user_id = </span><span class=si>$id</span><span class=s2>;&quot;</span><span class=p>;</span>
<a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a>            <span class=nv>$result</span> <span class=o>=</span> <span class=nx>mysqli_query</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>],</span> <span class=nv>$query</span><span class=p>)</span> <span class=k>or</span> <span class=k>die</span><span class=p>(</span> <span class=s1>&#39;&lt;pre&gt;&#39;</span> <span class=o>.</span> <span class=nx>mysqli_error</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>])</span> <span class=o>.</span> <span class=s1>&#39;&lt;/pre&gt;&#39;</span> <span class=p>);</span>
<a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a>
<a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a>            <span class=c1>// Get results</span>
<a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a>            <span class=k>while</span><span class=p>(</span> <span class=nv>$row</span> <span class=o>=</span> <span class=nx>mysqli_fetch_assoc</span><span class=p>(</span> <span class=nv>$result</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a>                <span class=c1>// Display values</span>
<a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a>                <span class=nv>$first</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s2>&quot;first_name&quot;</span><span class=p>];</span>
<a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a>                <span class=nv>$last</span>  <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s2>&quot;last_name&quot;</span><span class=p>];</span>
<a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a>
<a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a>                <span class=c1>// Feedback for end user</span>
<a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a>                <span class=k>echo</span> <span class=s2>&quot;&lt;pre&gt;ID: </span><span class=si>{</span><span class=nv>$id</span><span class=si>}</span><span class=s2>&lt;br /&gt;First name: </span><span class=si>{</span><span class=nv>$first</span><span class=si>}</span><span class=s2>&lt;br /&gt;Surname: </span><span class=si>{</span><span class=nv>$last</span><span class=si>}</span><span class=s2>&lt;/pre&gt;&quot;</span><span class=p>;</span>
<a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a>            <span class=p>}</span>
<a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a>            <span class=k>break</span><span class=p>;</span>
<a id=__codelineno-4-24 name=__codelineno-4-24 href=#__codelineno-4-24></a>        <span class=k>case</span> <span class=nx>SQLITE</span><span class=o>:</span>
<a id=__codelineno-4-25 name=__codelineno-4-25 href=#__codelineno-4-25></a>            <span class=k>global</span> <span class=nv>$sqlite_db_connection</span><span class=p>;</span>
<a id=__codelineno-4-26 name=__codelineno-4-26 href=#__codelineno-4-26></a>
<a id=__codelineno-4-27 name=__codelineno-4-27 href=#__codelineno-4-27></a>            <span class=nv>$query</span>  <span class=o>=</span> <span class=s2>&quot;SELECT first_name, last_name FROM users WHERE user_id = </span><span class=si>$id</span><span class=s2>;&quot;</span><span class=p>;</span>
<a id=__codelineno-4-28 name=__codelineno-4-28 href=#__codelineno-4-28></a>            <span class=c1>#print $query;</span>
<a id=__codelineno-4-29 name=__codelineno-4-29 href=#__codelineno-4-29></a>            <span class=k>try</span> <span class=p>{</span>
<a id=__codelineno-4-30 name=__codelineno-4-30 href=#__codelineno-4-30></a>                <span class=nv>$results</span> <span class=o>=</span> <span class=nv>$sqlite_db_connection</span><span class=o>-&gt;</span><span class=na>query</span><span class=p>(</span><span class=nv>$query</span><span class=p>);</span>
<a id=__codelineno-4-31 name=__codelineno-4-31 href=#__codelineno-4-31></a>            <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>Exception</span> <span class=nv>$e</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-4-32 name=__codelineno-4-32 href=#__codelineno-4-32></a>                <span class=k>echo</span> <span class=s1>&#39;Caught exception: &#39;</span> <span class=o>.</span> <span class=nv>$e</span><span class=o>-&gt;</span><span class=na>getMessage</span><span class=p>();</span>
<a id=__codelineno-4-33 name=__codelineno-4-33 href=#__codelineno-4-33></a>                <span class=k>exit</span><span class=p>();</span>
<a id=__codelineno-4-34 name=__codelineno-4-34 href=#__codelineno-4-34></a>            <span class=p>}</span>
<a id=__codelineno-4-35 name=__codelineno-4-35 href=#__codelineno-4-35></a>
<a id=__codelineno-4-36 name=__codelineno-4-36 href=#__codelineno-4-36></a>            <span class=k>if</span> <span class=p>(</span><span class=nv>$results</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-4-37 name=__codelineno-4-37 href=#__codelineno-4-37></a>                <span class=k>while</span> <span class=p>(</span><span class=nv>$row</span> <span class=o>=</span> <span class=nv>$results</span><span class=o>-&gt;</span><span class=na>fetchArray</span><span class=p>())</span> <span class=p>{</span>
<a id=__codelineno-4-38 name=__codelineno-4-38 href=#__codelineno-4-38></a>                    <span class=c1>// Get values</span>
<a id=__codelineno-4-39 name=__codelineno-4-39 href=#__codelineno-4-39></a>                    <span class=nv>$first</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s2>&quot;first_name&quot;</span><span class=p>];</span>
<a id=__codelineno-4-40 name=__codelineno-4-40 href=#__codelineno-4-40></a>                    <span class=nv>$last</span>  <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s2>&quot;last_name&quot;</span><span class=p>];</span>
<a id=__codelineno-4-41 name=__codelineno-4-41 href=#__codelineno-4-41></a>
<a id=__codelineno-4-42 name=__codelineno-4-42 href=#__codelineno-4-42></a>                    <span class=c1>// Feedback for end user</span>
<a id=__codelineno-4-43 name=__codelineno-4-43 href=#__codelineno-4-43></a>                    <span class=k>echo</span> <span class=s2>&quot;&lt;pre&gt;ID: </span><span class=si>{</span><span class=nv>$id</span><span class=si>}</span><span class=s2>&lt;br /&gt;First name: </span><span class=si>{</span><span class=nv>$first</span><span class=si>}</span><span class=s2>&lt;br /&gt;Surname: </span><span class=si>{</span><span class=nv>$last</span><span class=si>}</span><span class=s2>&lt;/pre&gt;&quot;</span><span class=p>;</span>
<a id=__codelineno-4-44 name=__codelineno-4-44 href=#__codelineno-4-44></a>                <span class=p>}</span>
<a id=__codelineno-4-45 name=__codelineno-4-45 href=#__codelineno-4-45></a>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
<a id=__codelineno-4-46 name=__codelineno-4-46 href=#__codelineno-4-46></a>                <span class=k>echo</span> <span class=s2>&quot;Error in fetch &quot;</span><span class=o>.</span><span class=nv>$sqlite_db</span><span class=o>-&gt;</span><span class=na>lastErrorMsg</span><span class=p>();</span>
<a id=__codelineno-4-47 name=__codelineno-4-47 href=#__codelineno-4-47></a>            <span class=p>}</span>
<a id=__codelineno-4-48 name=__codelineno-4-48 href=#__codelineno-4-48></a>            <span class=k>break</span><span class=p>;</span>
<a id=__codelineno-4-49 name=__codelineno-4-49 href=#__codelineno-4-49></a>    <span class=p>}</span>
<a id=__codelineno-4-50 name=__codelineno-4-50 href=#__codelineno-4-50></a><span class=p>}</span>
<a id=__codelineno-4-51 name=__codelineno-4-51 href=#__codelineno-4-51></a>
<a id=__codelineno-4-52 name=__codelineno-4-52 href=#__codelineno-4-52></a><span class=c1>// This is used later on in the index.php page</span>
<a id=__codelineno-4-53 name=__codelineno-4-53 href=#__codelineno-4-53></a><span class=c1>// Setting it here so we can close the database connection in here like in the rest of the source scripts</span>
<a id=__codelineno-4-54 name=__codelineno-4-54 href=#__codelineno-4-54></a><span class=nv>$query</span>  <span class=o>=</span> <span class=s2>&quot;SELECT COUNT(*) FROM users;&quot;</span><span class=p>;</span>
<a id=__codelineno-4-55 name=__codelineno-4-55 href=#__codelineno-4-55></a><span class=nv>$result</span> <span class=o>=</span> <span class=nx>mysqli_query</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>],</span>  <span class=nv>$query</span> <span class=p>)</span> <span class=k>or</span> <span class=k>die</span><span class=p>(</span> <span class=s1>&#39;&lt;pre&gt;&#39;</span> <span class=o>.</span> <span class=p>((</span><span class=nb>is_object</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>]))</span> <span class=o>?</span> <span class=nx>mysqli_error</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>])</span> <span class=o>:</span> <span class=p>((</span><span class=nv>$___mysqli_res</span> <span class=o>=</span> <span class=nx>mysqli_connect_error</span><span class=p>())</span> <span class=o>?</span> <span class=nv>$___mysqli_res</span> <span class=o>:</span> <span class=k>false</span><span class=p>))</span> <span class=o>.</span> <span class=s1>&#39;&lt;/pre&gt;&#39;</span> <span class=p>);</span>
<a id=__codelineno-4-56 name=__codelineno-4-56 href=#__codelineno-4-56></a><span class=nv>$number_of_rows</span> <span class=o>=</span> <span class=nx>mysqli_fetch_row</span><span class=p>(</span> <span class=nv>$result</span> <span class=p>)[</span><span class=mi>0</span><span class=p>];</span>
<a id=__codelineno-4-57 name=__codelineno-4-57 href=#__codelineno-4-57></a>
<a id=__codelineno-4-58 name=__codelineno-4-58 href=#__codelineno-4-58></a><span class=nx>mysqli_close</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>]);</span>
<a id=__codelineno-4-59 name=__codelineno-4-59 href=#__codelineno-4-59></a><span class=cp>?&gt;</span>
</code></pre></div> <h3 id=analysis_1><strong>Analysis</strong><a class=headerlink href=#analysis_1 title="Permanent link">&para;</a></h3> <p>Thử thách này họ chuyển từ GET HTTP Request thành POST HTTP Request. Ta sẽ dùng Burpsuite để xem trạng thái gói tin</p> <blockquote> <p>Challenge ban nãy ta có thể tiêm thẳng trên URL.</p> </blockquote> <p>Bên cạnh đó, họ còn filter các kí tự đặt biệt bằng việc dùng hàm <code>mysqli_real_escape_string[^1]</code> thông qua câu lệnh bên dưới</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=x>$id = mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;], $id);</span>
</code></pre></div> <p>Và bộ kí tự được filter là</p> <p><img alt src=image-7.png></p> <p>Nhưng đáng tiếc thay, trong truy vấn lại không có dấu ngoặc kép xung quanh dẫn đến việc ta không cần mã hóa dấu ngoặc (gbk,...) mà vẫn có thể bypass được</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=x>$query  = &quot;SELECT first_name, last_name FROM users WHERE user_id = $id;&quot;;</span>
</code></pre></div> <h3 id=exploition_1><strong>Exploition</strong><a class=headerlink href=#exploition_1 title="Permanent link">&para;</a></h3> <p>Dùng những payload ở mức độ Low để bypass challenge này.</p> <p><img alt src=image-6.png></p> <p><img alt src=image-8.png></p> <hr> <h2 id=security-level-high><strong>Security Level: High</strong><a class=headerlink href=#security-level-high title="Permanent link">&para;</a></h2> <p>Source code</p> <div class=highlight><span class=filename>vulnerabilities/sqli/source/high.php</span><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=cp>&lt;?php</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=k>if</span><span class=p>(</span> <span class=nb>isset</span><span class=p>(</span> <span class=nv>$_SESSION</span> <span class=p>[</span> <span class=s1>&#39;id&#39;</span> <span class=p>]</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>    <span class=c1>// Get input</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>    <span class=nv>$id</span> <span class=o>=</span> <span class=nv>$_SESSION</span><span class=p>[</span> <span class=s1>&#39;id&#39;</span> <span class=p>];</span>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>    <span class=k>switch</span> <span class=p>(</span><span class=nv>$_DVWA</span><span class=p>[</span><span class=s1>&#39;SQLI_DB&#39;</span><span class=p>])</span> <span class=p>{</span>
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a>        <span class=k>case</span> <span class=nx>MYSQL</span><span class=o>:</span>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a>            <span class=c1>// Check database</span>
<a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a>            <span class=nv>$query</span>  <span class=o>=</span> <span class=s2>&quot;SELECT first_name, last_name FROM users WHERE user_id = &#39;</span><span class=si>$id</span><span class=s2>&#39; LIMIT 1;&quot;</span><span class=p>;</span>
<a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a>            <span class=nv>$result</span> <span class=o>=</span> <span class=nx>mysqli_query</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>],</span> <span class=nv>$query</span> <span class=p>)</span> <span class=k>or</span> <span class=k>die</span><span class=p>(</span> <span class=s1>&#39;&lt;pre&gt;Something went wrong.&lt;/pre&gt;&#39;</span> <span class=p>);</span>
<a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a>
<a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a>            <span class=c1>// Get results</span>
<a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a>            <span class=k>while</span><span class=p>(</span> <span class=nv>$row</span> <span class=o>=</span> <span class=nx>mysqli_fetch_assoc</span><span class=p>(</span> <span class=nv>$result</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a>                <span class=c1>// Get values</span>
<a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a>                <span class=nv>$first</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s2>&quot;first_name&quot;</span><span class=p>];</span>
<a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a>                <span class=nv>$last</span>  <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s2>&quot;last_name&quot;</span><span class=p>];</span>
<a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a>
<a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a>                <span class=c1>// Feedback for end user</span>
<a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a>                <span class=k>echo</span> <span class=s2>&quot;&lt;pre&gt;ID: </span><span class=si>{</span><span class=nv>$id</span><span class=si>}</span><span class=s2>&lt;br /&gt;First name: </span><span class=si>{</span><span class=nv>$first</span><span class=si>}</span><span class=s2>&lt;br /&gt;Surname: </span><span class=si>{</span><span class=nv>$last</span><span class=si>}</span><span class=s2>&lt;/pre&gt;&quot;</span><span class=p>;</span>
<a id=__codelineno-7-21 name=__codelineno-7-21 href=#__codelineno-7-21></a>            <span class=p>}</span>
<a id=__codelineno-7-22 name=__codelineno-7-22 href=#__codelineno-7-22></a>
<a id=__codelineno-7-23 name=__codelineno-7-23 href=#__codelineno-7-23></a>            <span class=p>((</span><span class=nb>is_null</span><span class=p>(</span><span class=nv>$___mysqli_res</span> <span class=o>=</span> <span class=nx>mysqli_close</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&quot;___mysqli_ston&quot;</span><span class=p>])))</span> <span class=o>?</span> <span class=k>false</span> <span class=o>:</span> <span class=nv>$___mysqli_res</span><span class=p>);</span>        
<a id=__codelineno-7-24 name=__codelineno-7-24 href=#__codelineno-7-24></a>            <span class=k>break</span><span class=p>;</span>
<a id=__codelineno-7-25 name=__codelineno-7-25 href=#__codelineno-7-25></a>        <span class=k>case</span> <span class=nx>SQLITE</span><span class=o>:</span>
<a id=__codelineno-7-26 name=__codelineno-7-26 href=#__codelineno-7-26></a>            <span class=k>global</span> <span class=nv>$sqlite_db_connection</span><span class=p>;</span>
<a id=__codelineno-7-27 name=__codelineno-7-27 href=#__codelineno-7-27></a>
<a id=__codelineno-7-28 name=__codelineno-7-28 href=#__codelineno-7-28></a>            <span class=nv>$query</span>  <span class=o>=</span> <span class=s2>&quot;SELECT first_name, last_name FROM users WHERE user_id = &#39;</span><span class=si>$id</span><span class=s2>&#39; LIMIT 1;&quot;</span><span class=p>;</span>
<a id=__codelineno-7-29 name=__codelineno-7-29 href=#__codelineno-7-29></a>            <span class=c1>#print $query;</span>
<a id=__codelineno-7-30 name=__codelineno-7-30 href=#__codelineno-7-30></a>            <span class=k>try</span> <span class=p>{</span>
<a id=__codelineno-7-31 name=__codelineno-7-31 href=#__codelineno-7-31></a>                <span class=nv>$results</span> <span class=o>=</span> <span class=nv>$sqlite_db_connection</span><span class=o>-&gt;</span><span class=na>query</span><span class=p>(</span><span class=nv>$query</span><span class=p>);</span>
<a id=__codelineno-7-32 name=__codelineno-7-32 href=#__codelineno-7-32></a>            <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>Exception</span> <span class=nv>$e</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-7-33 name=__codelineno-7-33 href=#__codelineno-7-33></a>                <span class=k>echo</span> <span class=s1>&#39;Caught exception: &#39;</span> <span class=o>.</span> <span class=nv>$e</span><span class=o>-&gt;</span><span class=na>getMessage</span><span class=p>();</span>
<a id=__codelineno-7-34 name=__codelineno-7-34 href=#__codelineno-7-34></a>                <span class=k>exit</span><span class=p>();</span>
<a id=__codelineno-7-35 name=__codelineno-7-35 href=#__codelineno-7-35></a>            <span class=p>}</span>
<a id=__codelineno-7-36 name=__codelineno-7-36 href=#__codelineno-7-36></a>
<a id=__codelineno-7-37 name=__codelineno-7-37 href=#__codelineno-7-37></a>            <span class=k>if</span> <span class=p>(</span><span class=nv>$results</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-7-38 name=__codelineno-7-38 href=#__codelineno-7-38></a>                <span class=k>while</span> <span class=p>(</span><span class=nv>$row</span> <span class=o>=</span> <span class=nv>$results</span><span class=o>-&gt;</span><span class=na>fetchArray</span><span class=p>())</span> <span class=p>{</span>
<a id=__codelineno-7-39 name=__codelineno-7-39 href=#__codelineno-7-39></a>                    <span class=c1>// Get values</span>
<a id=__codelineno-7-40 name=__codelineno-7-40 href=#__codelineno-7-40></a>                    <span class=nv>$first</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s2>&quot;first_name&quot;</span><span class=p>];</span>
<a id=__codelineno-7-41 name=__codelineno-7-41 href=#__codelineno-7-41></a>                    <span class=nv>$last</span>  <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s2>&quot;last_name&quot;</span><span class=p>];</span>
<a id=__codelineno-7-42 name=__codelineno-7-42 href=#__codelineno-7-42></a>
<a id=__codelineno-7-43 name=__codelineno-7-43 href=#__codelineno-7-43></a>                    <span class=c1>// Feedback for end user</span>
<a id=__codelineno-7-44 name=__codelineno-7-44 href=#__codelineno-7-44></a>                    <span class=k>echo</span> <span class=s2>&quot;&lt;pre&gt;ID: </span><span class=si>{</span><span class=nv>$id</span><span class=si>}</span><span class=s2>&lt;br /&gt;First name: </span><span class=si>{</span><span class=nv>$first</span><span class=si>}</span><span class=s2>&lt;br /&gt;Surname: </span><span class=si>{</span><span class=nv>$last</span><span class=si>}</span><span class=s2>&lt;/pre&gt;&quot;</span><span class=p>;</span>
<a id=__codelineno-7-45 name=__codelineno-7-45 href=#__codelineno-7-45></a>                <span class=p>}</span>
<a id=__codelineno-7-46 name=__codelineno-7-46 href=#__codelineno-7-46></a>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
<a id=__codelineno-7-47 name=__codelineno-7-47 href=#__codelineno-7-47></a>                <span class=k>echo</span> <span class=s2>&quot;Error in fetch &quot;</span><span class=o>.</span><span class=nv>$sqlite_db</span><span class=o>-&gt;</span><span class=na>lastErrorMsg</span><span class=p>();</span>
<a id=__codelineno-7-48 name=__codelineno-7-48 href=#__codelineno-7-48></a>            <span class=p>}</span>
<a id=__codelineno-7-49 name=__codelineno-7-49 href=#__codelineno-7-49></a>            <span class=k>break</span><span class=p>;</span>
<a id=__codelineno-7-50 name=__codelineno-7-50 href=#__codelineno-7-50></a>    <span class=p>}</span>
<a id=__codelineno-7-51 name=__codelineno-7-51 href=#__codelineno-7-51></a><span class=p>}</span>
<a id=__codelineno-7-52 name=__codelineno-7-52 href=#__codelineno-7-52></a>
<a id=__codelineno-7-53 name=__codelineno-7-53 href=#__codelineno-7-53></a><span class=cp>?&gt;</span><span class=x> </span>
</code></pre></div> <h3 id=analysis_2><strong>Analysis</strong><a class=headerlink href=#analysis_2 title="Permanent link">&para;</a></h3> <p>Bài này chắc ở mức Low thôi, thay vì tác động trên URL thì bài này sẽ mở 1 phiên khác để nhập payload vào, nhưng lại không có filter gì cả. Nên ta dễ dàng bypass.</p> <h3 id=exploition_2><strong>Exploition</strong><a class=headerlink href=#exploition_2 title="Permanent link">&para;</a></h3> <p>Exploit như challenge Low</p> <p><img alt src=image-9.png></p> <p><img alt src=image-10.png></p> <hr> <h2 id=security-level-impossible><strong>Security Level: Impossible</strong><a class=headerlink href=#security-level-impossible title="Permanent link">&para;</a></h2> <p>Source code</p> <div class=highlight><span class=filename>vulnerabilities/sqli/source/impossible.php</span><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=cp>&lt;?php</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=k>if</span><span class=p>(</span> <span class=nb>isset</span><span class=p>(</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;Submit&#39;</span> <span class=p>]</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>    <span class=c1>// Check Anti-CSRF token</span>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>    <span class=nx>checkToken</span><span class=p>(</span> <span class=nv>$_REQUEST</span><span class=p>[</span> <span class=s1>&#39;user_token&#39;</span> <span class=p>],</span> <span class=nv>$_SESSION</span><span class=p>[</span> <span class=s1>&#39;session_token&#39;</span> <span class=p>],</span> <span class=s1>&#39;index.php&#39;</span> <span class=p>);</span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>    <span class=c1>// Get input</span>
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a>    <span class=nv>$id</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;id&#39;</span> <span class=p>];</span>
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>
<a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a>    <span class=c1>// Was a number entered?</span>
<a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a>    <span class=k>if</span><span class=p>(</span><span class=nb>is_numeric</span><span class=p>(</span> <span class=nv>$id</span> <span class=p>))</span> <span class=p>{</span>
<a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a>        <span class=nv>$id</span> <span class=o>=</span> <span class=nb>intval</span> <span class=p>(</span><span class=nv>$id</span><span class=p>);</span>
<a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a>        <span class=k>switch</span> <span class=p>(</span><span class=nv>$_DVWA</span><span class=p>[</span><span class=s1>&#39;SQLI_DB&#39;</span><span class=p>])</span> <span class=p>{</span>
<a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a>            <span class=k>case</span> <span class=nx>MYSQL</span><span class=o>:</span>
<a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a>                <span class=c1>// Check the database</span>
<a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a>                <span class=nv>$data</span> <span class=o>=</span> <span class=nv>$db</span><span class=o>-&gt;</span><span class=na>prepare</span><span class=p>(</span> <span class=s1>&#39;SELECT first_name, last_name FROM users WHERE user_id = (:id) LIMIT 1;&#39;</span> <span class=p>);</span>
<a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a>                <span class=nv>$data</span><span class=o>-&gt;</span><span class=na>bindParam</span><span class=p>(</span> <span class=s1>&#39;:id&#39;</span><span class=p>,</span> <span class=nv>$id</span><span class=p>,</span> <span class=nx>PDO</span><span class=o>::</span><span class=na>PARAM_INT</span> <span class=p>);</span>
<a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a>                <span class=nv>$data</span><span class=o>-&gt;</span><span class=na>execute</span><span class=p>();</span>
<a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a>                <span class=nv>$row</span> <span class=o>=</span> <span class=nv>$data</span><span class=o>-&gt;</span><span class=na>fetch</span><span class=p>();</span>
<a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a>
<a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a>                <span class=c1>// Make sure only 1 result is returned</span>
<a id=__codelineno-8-22 name=__codelineno-8-22 href=#__codelineno-8-22></a>                <span class=k>if</span><span class=p>(</span> <span class=nv>$data</span><span class=o>-&gt;</span><span class=na>rowCount</span><span class=p>()</span> <span class=o>==</span> <span class=mi>1</span> <span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-8-23 name=__codelineno-8-23 href=#__codelineno-8-23></a>                    <span class=c1>// Get values</span>
<a id=__codelineno-8-24 name=__codelineno-8-24 href=#__codelineno-8-24></a>                    <span class=nv>$first</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span> <span class=s1>&#39;first_name&#39;</span> <span class=p>];</span>
<a id=__codelineno-8-25 name=__codelineno-8-25 href=#__codelineno-8-25></a>                    <span class=nv>$last</span>  <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span> <span class=s1>&#39;last_name&#39;</span> <span class=p>];</span>
<a id=__codelineno-8-26 name=__codelineno-8-26 href=#__codelineno-8-26></a>
<a id=__codelineno-8-27 name=__codelineno-8-27 href=#__codelineno-8-27></a>                    <span class=c1>// Feedback for end user</span>
<a id=__codelineno-8-28 name=__codelineno-8-28 href=#__codelineno-8-28></a>                    <span class=k>echo</span> <span class=s2>&quot;&lt;pre&gt;ID: </span><span class=si>{</span><span class=nv>$id</span><span class=si>}</span><span class=s2>&lt;br /&gt;First name: </span><span class=si>{</span><span class=nv>$first</span><span class=si>}</span><span class=s2>&lt;br /&gt;Surname: </span><span class=si>{</span><span class=nv>$last</span><span class=si>}</span><span class=s2>&lt;/pre&gt;&quot;</span><span class=p>;</span>
<a id=__codelineno-8-29 name=__codelineno-8-29 href=#__codelineno-8-29></a>                <span class=p>}</span>
<a id=__codelineno-8-30 name=__codelineno-8-30 href=#__codelineno-8-30></a>                <span class=k>break</span><span class=p>;</span>
<a id=__codelineno-8-31 name=__codelineno-8-31 href=#__codelineno-8-31></a>            <span class=k>case</span> <span class=nx>SQLITE</span><span class=o>:</span>
<a id=__codelineno-8-32 name=__codelineno-8-32 href=#__codelineno-8-32></a>                <span class=k>global</span> <span class=nv>$sqlite_db_connection</span><span class=p>;</span>
<a id=__codelineno-8-33 name=__codelineno-8-33 href=#__codelineno-8-33></a>
<a id=__codelineno-8-34 name=__codelineno-8-34 href=#__codelineno-8-34></a>                <span class=nv>$stmt</span> <span class=o>=</span> <span class=nv>$sqlite_db_connection</span><span class=o>-&gt;</span><span class=na>prepare</span><span class=p>(</span><span class=s1>&#39;SELECT first_name, last_name FROM users WHERE user_id = :id LIMIT 1;&#39;</span> <span class=p>);</span>
<a id=__codelineno-8-35 name=__codelineno-8-35 href=#__codelineno-8-35></a>                <span class=nv>$stmt</span><span class=o>-&gt;</span><span class=na>bindValue</span><span class=p>(</span><span class=s1>&#39;:id&#39;</span><span class=p>,</span><span class=nv>$id</span><span class=p>,</span><span class=nx>SQLITE3_INTEGER</span><span class=p>);</span>
<a id=__codelineno-8-36 name=__codelineno-8-36 href=#__codelineno-8-36></a>                <span class=nv>$result</span> <span class=o>=</span> <span class=nv>$stmt</span><span class=o>-&gt;</span><span class=na>execute</span><span class=p>();</span>
<a id=__codelineno-8-37 name=__codelineno-8-37 href=#__codelineno-8-37></a>                <span class=nv>$result</span><span class=o>-&gt;</span><span class=na>finalize</span><span class=p>();</span>
<a id=__codelineno-8-38 name=__codelineno-8-38 href=#__codelineno-8-38></a>                <span class=k>if</span> <span class=p>(</span><span class=nv>$result</span> <span class=o>!==</span> <span class=k>false</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-8-39 name=__codelineno-8-39 href=#__codelineno-8-39></a>                    <span class=c1>// There is no way to get the number of rows returned</span>
<a id=__codelineno-8-40 name=__codelineno-8-40 href=#__codelineno-8-40></a>                    <span class=c1>// This checks the number of columns (not rows) just</span>
<a id=__codelineno-8-41 name=__codelineno-8-41 href=#__codelineno-8-41></a>                    <span class=c1>// as a precaution, but it won&#39;t stop someone dumping</span>
<a id=__codelineno-8-42 name=__codelineno-8-42 href=#__codelineno-8-42></a>                    <span class=c1>// multiple rows and viewing them one at a time.</span>
<a id=__codelineno-8-43 name=__codelineno-8-43 href=#__codelineno-8-43></a>
<a id=__codelineno-8-44 name=__codelineno-8-44 href=#__codelineno-8-44></a>                    <span class=nv>$num_columns</span> <span class=o>=</span> <span class=nv>$result</span><span class=o>-&gt;</span><span class=na>numColumns</span><span class=p>();</span>
<a id=__codelineno-8-45 name=__codelineno-8-45 href=#__codelineno-8-45></a>                    <span class=k>if</span> <span class=p>(</span><span class=nv>$num_columns</span> <span class=o>==</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-8-46 name=__codelineno-8-46 href=#__codelineno-8-46></a>                        <span class=nv>$row</span> <span class=o>=</span> <span class=nv>$result</span><span class=o>-&gt;</span><span class=na>fetchArray</span><span class=p>();</span>
<a id=__codelineno-8-47 name=__codelineno-8-47 href=#__codelineno-8-47></a>
<a id=__codelineno-8-48 name=__codelineno-8-48 href=#__codelineno-8-48></a>                        <span class=c1>// Get values</span>
<a id=__codelineno-8-49 name=__codelineno-8-49 href=#__codelineno-8-49></a>                        <span class=nv>$first</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span> <span class=s1>&#39;first_name&#39;</span> <span class=p>];</span>
<a id=__codelineno-8-50 name=__codelineno-8-50 href=#__codelineno-8-50></a>                        <span class=nv>$last</span>  <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span> <span class=s1>&#39;last_name&#39;</span> <span class=p>];</span>
<a id=__codelineno-8-51 name=__codelineno-8-51 href=#__codelineno-8-51></a>
<a id=__codelineno-8-52 name=__codelineno-8-52 href=#__codelineno-8-52></a>                        <span class=c1>// Feedback for end user</span>
<a id=__codelineno-8-53 name=__codelineno-8-53 href=#__codelineno-8-53></a>                        <span class=k>echo</span> <span class=s2>&quot;&lt;pre&gt;ID: </span><span class=si>{</span><span class=nv>$id</span><span class=si>}</span><span class=s2>&lt;br /&gt;First name: </span><span class=si>{</span><span class=nv>$first</span><span class=si>}</span><span class=s2>&lt;br /&gt;Surname: </span><span class=si>{</span><span class=nv>$last</span><span class=si>}</span><span class=s2>&lt;/pre&gt;&quot;</span><span class=p>;</span>
<a id=__codelineno-8-54 name=__codelineno-8-54 href=#__codelineno-8-54></a>                    <span class=p>}</span>
<a id=__codelineno-8-55 name=__codelineno-8-55 href=#__codelineno-8-55></a>                <span class=p>}</span>
<a id=__codelineno-8-56 name=__codelineno-8-56 href=#__codelineno-8-56></a>
<a id=__codelineno-8-57 name=__codelineno-8-57 href=#__codelineno-8-57></a>                <span class=k>break</span><span class=p>;</span>
<a id=__codelineno-8-58 name=__codelineno-8-58 href=#__codelineno-8-58></a>        <span class=p>}</span>
<a id=__codelineno-8-59 name=__codelineno-8-59 href=#__codelineno-8-59></a>    <span class=p>}</span>
<a id=__codelineno-8-60 name=__codelineno-8-60 href=#__codelineno-8-60></a><span class=p>}</span>
<a id=__codelineno-8-61 name=__codelineno-8-61 href=#__codelineno-8-61></a>
<a id=__codelineno-8-62 name=__codelineno-8-62 href=#__codelineno-8-62></a><span class=c1>// Generate Anti-CSRF token</span>
<a id=__codelineno-8-63 name=__codelineno-8-63 href=#__codelineno-8-63></a><span class=nx>generateSessionToken</span><span class=p>();</span>
<a id=__codelineno-8-64 name=__codelineno-8-64 href=#__codelineno-8-64></a>
<a id=__codelineno-8-65 name=__codelineno-8-65 href=#__codelineno-8-65></a><span class=cp>?&gt;</span><span class=x> </span>
</code></pre></div> <h3 id=analysis_3><strong>Analysis</strong><a class=headerlink href=#analysis_3 title="Permanent link">&para;</a></h3> <hr> <h2 id=what-we-learned><strong>What we learned</strong><a class=headerlink href=#what-we-learned title="Permanent link">&para;</a></h2> <h2 id=more-information><strong>More Information</strong><a class=headerlink href=#more-information title="Permanent link">&para;</a></h2> <ul> <li><a href=https://en.wikipedia.org/wiki/SQL_injection>https://en.wikipedia.org/wiki/SQL_injection</a></li> <li><a href=https://www.netsparker.com/blog/web-security/sql-injection-cheat-sheet/ >https://www.netsparker.com/blog/web-security/sql-injection-cheat-sheet/</a></li> <li><a href=https://owasp.org/www-community/attacks/SQL_Injection>https://owasp.org/www-community/attacks/SQL_Injection</a></li> <li><a href=https://bobby-tables.com/ >https://bobby-tables.com/</a></li> </ul> <h2 id=see-more><strong>See more</strong><a class=headerlink href=#see-more title="Permanent link">&para;</a></h2> <ul> <li><a href=https://www.mssqltips.com/sqlservertutorial/196/information-schema-tables/ >https://www.mssqltips.com/sqlservertutorial/196/information-schema-tables/</a></li> <li><a href=https://www.mssqltips.com/sqlservertutorial/183/information-schema-columns/ >https://www.mssqltips.com/sqlservertutorial/183/information-schema-columns/</a></li> <li><a href=https://linuxhint.com/get-table-names-using-select-statement-in-mysql/ >https://linuxhint.com/get-table-names-using-select-statement-in-mysql/</a></li> </ul> <div class=footnote> <hr> <ol> <li id=fn:1> <p>Xem tại <a href=https://www.php.net/manual/en/mysqli.real-escape-string.php>https://www.php.net/manual/en/mysqli.real-escape-string.php</a>&#160;<a class=footnote-backref href=#fnref:1 title="Jump back to footnote 1 in the text">&#8617;</a></p> </li> </ol> </div> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">September 7, 2023</span> <br> Created: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">September 7, 2023</span> </small> </div> <h2 id=__comments><strong>Comments</strong></h2> <script src=https://giscus.app/client.js data-repo=hieuhdh/hieuhdh.github.io data-repo-id=R_kgDOHowGCg data-category=General data-category-id=DIC_kwDOHowGCs4CQLlU data-mapping=pathname data-reactions-enabled=1 data-emit-metadata=1 data-theme=preferred_color_scheme data-lang=en crossorigin=anonymous async></script> <script>
  var theme, giscus = document.querySelector("script[src*=giscus]"),
    palette = __md_get("__palette");
  palette && "object" == typeof palette.color && (theme = "slate" === palette.color.scheme ? "dark" : "light", giscus
    .setAttribute("data-theme", theme)), document.addEventListener("DOMContentLoaded", function () {
    document.querySelector("[data-md-component=palette]").addEventListener("change", function () {
      var e = __md_get("__palette");
      e && "object" == typeof e.color && (e = "slate" === e.color.scheme ? "dark" : "light", document
        .querySelector(".giscus-frame").contentWindow.postMessage({
          giscus: {
            setConfig: {
              theme: e
            }
          }
        }, "https://giscus.app"))
    })
  })

</script> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 0x5h1n0k0 </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.sections", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../assets/javascripts/bundle.6c7ad80a.min.js></script> <script src=../../assets/javascripts/cursor-effects.js></script> <!-- get ip
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <script>
            function taskService() {
                this.postListApi = function () {
                    return axios({
                        url: "https://api.ipify.org?format=json",
                        method: "GET",
                    });
                };
            }
            var TaskList = new taskService();

            TaskList.postListApi()
                .then(function (result) {

                    function taskService02() {
                        this.getListApiii = function () {
                            return axios({
                                url: "https://bedeu.herokuapp.com/iphomeposts/views/",
                                method: "POST",
                                data: {
                                    "ip": result.data.ip,
                                },
                            });
                        };
                    }
                    var TaskListList = new taskService02();

                    TaskListList.getListApiii()
                        .then(function (result) {
                            if (result.data.sl > 1) {
                                document.getElementById("view-user").innerHTML = result.data.sl + " times"
                            } else {
                                document.getElementById("view-user").innerHTML = result.data.sl + " time"
                            }
                        })
                        .catch(function (erro) {
                            console.log(erro)
                        });
                        
                    function taskService01() {
                        this.getListApii = function () {
                            return axios({
                                url: "https://bedeu.herokuapp.com/iphomeposts/views_total/",
                                method: "GET",
                            });
                        };
                    }
                    var TaskListt = new taskService01();

                    TaskListt.getListApii()
                        .then(function (result) {
                            document.getElementById("view-all").innerHTML = result.data
                        })
                        .catch(function (erro) {
                            console.log(erro)
                        });
                })
                .catch(function (erro) {});

        </script>

        <script>
            function taskServicePost() {
                this.postListApiTotal = function () {
                    return axios({
                        url: "https://api.ipify.org?format=json",
                        method: "GET",
                    });
                };
            }
            var TaskList = new taskServicePost();
            var arr = window.location.pathname.split('/');


            TaskList.postListApiTotal()
                .then(function (result) {

                    function taskServicePost02() {
                        this.getListApiUser = function () {
                            return axios({
                                url: "https://bedeu.herokuapp.com/ipposts/views/",
                                method: "POST",
                                data: {
                                    "ip": result.data.ip,
                                    "post": arr[arr.length - 2],
                                },
                            });
                        };
                    }
                    var TaskListUser = new taskServicePost02();

                    TaskListUser.getListApiUser()
                        .then(function (result) {
                            if (result.data.sl > 1) {
                                document.getElementById("view-post-user").innerHTML = result.data.sl + " times";
                            } else {
                                document.getElementById("view-post-user").innerHTML = result.data.sl + " time";
                            }
                        })
                        .catch(function (erro) {
                            console.log(erro)
                        });

                        function taskServicePost01() {
                        this.getListApiTotal = function () {
                            return axios({
                                url: "https://bedeu.herokuapp.com/ipposts/views_total/",
                                method: "POST",
                                data: {
                                    "post": arr[arr.length - 2],
                                },
                            });
                        };
                    }
                    var TaskListTotal = new taskServicePost01();

                    TaskListTotal.getListApiTotal()
                        .then(function (result) {
                            if (result.data > 1) {
                                document.getElementById("view-post-all").innerHTML = result.data + " times";
                            } else {
                                document.getElementById("view-post-all").innerHTML = result.data + " time";
                            }
                        })
                        .catch(function (erro) {
                            console.log(erro)
                        });
                })
                .catch(function (erro) {});

        </script> --> <script src=../../javascripts/consent.js></script> <script src=../../javascripts/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script src=https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js></script> <script src=../../javascripts/tablesort.js></script> <script src=../../overrides/assets/javascripts/bundle.ed7d8744.min.js></script> <script src=../../overrides/assets/javascripts/cursor-effects.js></script> <!-- <script src="../../assets/javascripts/cursor-effects.js"></script> --> </body> </html>