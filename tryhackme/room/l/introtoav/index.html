<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=0x5h1n0k0><link href=https://0x5h1n0k0.github.io/tryhackme/room/l/introtoav/ rel=canonical><link rel=icon href=../../../../assets/favicon.png><meta name=generator content="mkdocs-1.5.2, mkdocs-material-8.3.9"><title>Introduction to Antivirus | 0x5h1n0k0</title><link rel=stylesheet href=../../../../assets/stylesheets/main.1d29e8d0.min.css><link rel=stylesheet href=../../../../assets/stylesheets/cur.css><link rel=stylesheet href=../../../../assets/stylesheets/footer.scss><link rel=stylesheet href=../../../../assets/stylesheets/palette.cbb835fc.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Sans:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Fira Sans";--md-code-font:"Fira Code"}</style><link rel=stylesheet href=../../../../stylesheets/extra.css><script>__md_scope=new URL("../../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XXXXXXXXXX"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&gtag("event","search",{search_term:this.value})}),"undefined"!=typeof location$&&location$.subscribe(function(e){gtag("config","G-XXXXXXXXXX",{page_path:e.pathname})})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script><!-- live 2d --><link href=https://r18-nmsl.cn/pio/pio.css rel=stylesheet type=text/css><!-- <link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css">
    <script src="https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js"></script> --></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#introduction-to-antivirus class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../.. title=0x5h1n0k0 class="md-header__button md-logo" aria-label=0x5h1n0k0 data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82z"></path></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> 0x5h1n0k0 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Introduction to Antivirus </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/0x5h1n0k0/0x5h1n0k0.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> 0x5h1n0k0/0x5h1n0k0.github.io <ul class=md-source__facts> </ul> </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../.. title=0x5h1n0k0 class="md-nav__button md-logo" aria-label=0x5h1n0k0 data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82z"></path></svg> </a> 0x5h1n0k0 </label> <div class=md-nav__source> <a href=https://github.com/0x5h1n0k0/0x5h1n0k0.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> 0x5h1n0k0/0x5h1n0k0.github.io <ul class=md-source__facts> </ul> </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> PINNED <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=PINNED data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> PINNED </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../cve/ class=md-nav__link> CVE </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1_2 type=checkbox id=__nav_1_2> <label class=md-nav__link for=__nav_1_2> Privilege Escalation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Privilege Escalation" data-md-level=2> <label class=md-nav__title for=__nav_1_2> <span class="md-nav__icon md-icon"></span> Privilege Escalation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../notes/privilege-escalation/linux/ class=md-nav__link> Linux Privilege Escalation </a> </li> <li class=md-nav__item> <a href=../../../../notes/privilege-escalation/windows/ class=md-nav__link> Windows Privilege Escalation </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../notes/reverse-shell/ class=md-nav__link> Reverse Shell Cheatsheet </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Try Hack Me <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Try Hack Me" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Try Hack Me </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ class=md-nav__link> Machines </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> 247CTF <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=247CTF data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> 247CTF </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../247ctf/ class=md-nav__link> Web </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../dvwa/ class=md-nav__link> DVWA </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#task-1-introduction class=md-nav__link> Task 1: Introduction </a> <nav class=md-nav aria-label="Task 1: Introduction"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#learning-objectives class=md-nav__link> Learning Objectives </a> </li> <li class=md-nav__item> <a href=#room-prerequisites class=md-nav__link> Room prerequisites </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#task-2-antivirus-software class=md-nav__link> Task 2: Antivirus Software </a> <nav class=md-nav aria-label="Task 2: Antivirus Software"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#what-is-av-software class=md-nav__link> What is AV software? </a> </li> <li class=md-nav__item> <a href=#what-does-av-software-look-for class=md-nav__link> What does AV software look for? </a> </li> <li class=md-nav__item> <a href=#av-vs-other-security-products class=md-nav__link> AV vs other security products </a> </li> <li class=md-nav__item> <a href=#av-software-in-the-past-and-present class=md-nav__link> AV software in the past and present </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#task-3-antivirus-features class=md-nav__link> Task 3: Antivirus Features </a> <nav class=md-nav aria-label="Task 3: Antivirus Features"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#antivirus-engines class=md-nav__link> Antivirus Engines </a> </li> <li class=md-nav__item> <a href=#scanner class=md-nav__link> Scanner </a> </li> <li class=md-nav__item> <a href=#detection-techniques class=md-nav__link> Detection techniques </a> </li> <li class=md-nav__item> <a href=#compressors-and-archives class=md-nav__link> Compressors and Archives </a> </li> <li class=md-nav__item> <a href=#pe-portable-executable-parsing-and-unpackers class=md-nav__link> PE (Portable Executable) Parsing and Unpackers </a> </li> <li class=md-nav__item> <a href=#emulators class=md-nav__link> Emulators </a> </li> <li class=md-nav__item> <a href=#other-common-features class=md-nav__link> Other common features </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#task-4-deploy-the-vm class=md-nav__link> Task 4: Deploy the VM </a> </li> <li class=md-nav__item> <a href=#task-5-av-static-detection class=md-nav__link> Task 5: AV Static Detection </a> <nav class=md-nav aria-label="Task 5: AV Static Detection"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#static-detection class=md-nav__link> Static Detection </a> </li> <li class=md-nav__item> <a href=#create-your-own-signature-database class=md-nav__link> Create Your Own Signature Database </a> </li> <li class=md-nav__item> <a href=#yara-rules-for-static-detection class=md-nav__link> Yara Rules for Static Detection </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#task-6-other-detection-techniques class=md-nav__link> Task 6: Other Detection Techniques </a> <nav class=md-nav aria-label="Task 6: Other Detection Techniques"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#dynamic-detection class=md-nav__link> Dynamic Detection </a> </li> <li class=md-nav__item> <a href=#heuristic-and-behavioral-detection class=md-nav__link> Heuristic and Behavioral Detection </a> </li> <li class=md-nav__item> <a href=#summing-up-detection-methods class=md-nav__link> Summing up detection methods </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#task-7-av-testing-and-fingerprinting class=md-nav__link> Task 7: AV Testing and Fingerprinting </a> <nav class=md-nav aria-label="Task 7: AV Testing and Fingerprinting"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#av-vendors class=md-nav__link> AV Vendors </a> </li> <li class=md-nav__item> <a href=#av-testing-environment class=md-nav__link> AV Testing Environment </a> </li> <li class=md-nav__item> <a href=#virustotal class=md-nav__link> VirusTotal </a> </li> <li class=md-nav__item> <a href=#virustotal-alternatives class=md-nav__link> VirusTotal alternatives </a> </li> <li class=md-nav__item> <a href=#fingerprinting-av-software class=md-nav__link> Fingerprinting AV software </a> </li> <li class=md-nav__item> <a href=#sharpedrchecker class=md-nav__link> SharpEDRChecker </a> </li> <li class=md-nav__item> <a href=#c-fingerprint-checks class=md-nav__link> C# Fingerprint checks </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#task-8-conclusion class=md-nav__link> Task 8: Conclusion </a> <nav class=md-nav aria-label="Task 8: Conclusion"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#recap class=md-nav__link> Recap </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/0x5h1n0k0/0x5h1n0k0.github.io/edit/master/docs/tryhackme/room/l/introtoav/index.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1 id=introduction-to-antivirus><strong>Introduction to Antivirus</strong><a class=headerlink href=#introduction-to-antivirus title="Permanent link">&para;</a></h1><p style="color:#bdbdbd"><i>Estimated time to read: 34 minutes</i></p>
 <p>Room at <a href=https://tryhackme.com/room/introtoav>https://tryhackme.com/room/introtoav</a></p> <hr> <h2 id=task-1-introduction><strong>Task 1: Introduction</strong><a class=headerlink href=#task-1-introduction title="Permanent link">&para;</a></h2> <p>Welcome to Intro to AV</p> <p>Antivirus (AV) software is one of the essential host-based security solutions available to detect and prevent malware attacks within the end-user's machine. AV software consists of different modules, features, and detection techniques, which are discussed in this room.</p> <p>As a red teamer or pentester, it is essential to be familiar with and understand how AV software and its detection techniques work. Once this knowledge is acquired, it will be easier to work toward AV evasion techniques.</p> <p><img alt src=image.png></p> <h3 id=learning-objectives><strong>Learning Objectives</strong><a class=headerlink href=#learning-objectives title="Permanent link">&para;</a></h3> <ul> <li>What is Antivirus software?</li> <li>Antivirus detection approaches</li> <li>Enumerate installed AV software in the target machine</li> <li>Test in a simulated environment</li> </ul> <h3 id=room-prerequisites><strong>Room prerequisites</strong><a class=headerlink href=#room-prerequisites title="Permanent link">&para;</a></h3> <ul> <li>General knowledge of host-based detection solutions; check <a href=/tryhackme/room/l/thelayoftheland>The Lay of the Land</a> room for more information.</li> <li>General experience with Hashing crypto; check the Hashing - Crypto 101 room for more information.</li> <li>Basic knowledge of Yara Rules; check the THM Yara room for more information.</li> </ul> <details class=question> <summary>Answer the questions bellow</summary> <p>Question: Which Antivirus software is running on the VM? </p> <blockquote> <p>Ans: name</p> </blockquote> </details> <h2 id=task-2-antivirus-software><strong>Task 2: Antivirus Software</strong><a class=headerlink href=#task-2-antivirus-software title="Permanent link">&para;</a></h2> <h3 id=what-is-av-software><strong>What is AV software?</strong><a class=headerlink href=#what-is-av-software title="Permanent link">&para;</a></h3> <p>Antivirus (AV) software is an extra layer of security that aims to detect and prevent the execution and spread of malicious files in a target operating system.</p> <p>It is a host-based application that runs in real-time (in the background) to monitor and check the current and newly downloaded files. The AV software inspects and decides whether files are malicious using different techniques, which will be covered later in this room.</p> <p>Interestingly, the first antivirus software was designed solely to detect and remove <a href=https://malware-history.fandom.com/wiki/Virus>computer viruses</a>. Nowadays, that has changed; modern antivirus applications can detect and remove computer viruses as well other harmful files and threats.</p> <h3 id=what-does-av-software-look-for><strong>What does AV software look for?</strong><a class=headerlink href=#what-does-av-software-look-for title="Permanent link">&para;</a></h3> <p>Traditional AV software looks for <strong>malware</strong> with predefined malicious patterns or signatures. Malware is harmful software whose primary goal is to cause damage to a target machine, including but not limited to:</p> <ul> <li>Gain full access to a target machine.</li> <li>Steal sensitive information such as passwords.</li> <li>Encrypt files and cause damage to files.</li> <li>Inject other malicious software or unwanted advertisements.</li> <li>Used the compromised machine to perform further attacks such as botnet attacks.</li> </ul> <p><img alt src=image-1.png></p> <h3 id=av-vs-other-security-products><strong>AV vs other security products</strong><a class=headerlink href=#av-vs-other-security-products title="Permanent link">&para;</a></h3> <p> <figure><img src=image-2.png><figcaption>Alt text</figcaption> </figure> </p> <p>In addition to AV software, other host-based security solutions provide real-time protection to endpoint devices. Endpoint Detection and Response (EDR) is a security solution that provides real-time protection based on behavioral analytics. An antivirus application performs scanning, detecting, and removing malicious files. On the other hand, EDR monitors various security checks in the target machine, including file activities, memory, network connections, Windows registry, processes, etc.</p> <p>Modern Antivirus products are implemented to integrate the traditional Antivirus features and other advanced functionalities (similar to EDR functionalities) into one product to provide comprehensive protection against digital threats. For more information about Host-based security solutions, we suggest visiting the THM room: <a href=/tryhackme/room/l/thelayoftheland>The Lay of the Land</a>.</p> <h3 id=av-software-in-the-past-and-present><strong>AV software in the past and present</strong><a class=headerlink href=#av-software-in-the-past-and-present title="Permanent link">&para;</a></h3> <p>McAfee Associates, Inc. started the first AV software implementation in 1987. It was called "VirusScan," and its main goal at that time was to remove a virus named "Brain" that infected John McAfee's computer. Later, other companies joined in the battle against viruses. AV software was called scanners, and they were command-line software that searched for malicious patterns in files.</p> <p>Since then, things have changed. AV software nowadays uses a Graphical User Interface (GUI) to perform scans for malicious files and other tasks. Malware programs have also expanded in scope and now target victims on Windows and other operating systems. Modern AV software supports most devices and platforms, including Windows, Linux, macOS, Android, and iOS. Modern AV software has improved and become more intelligent and sophisticated, as they pack a bundle of versatile features, including Antivirus, Anti-Exploit, Firewall, Encryption tool, etc.</p> <p>We will be discussing some AV features in the next task.</p> <details class=question> <summary>Answer the questions bellow</summary> <p>Question: What does AV mean?</p> <blockquote> <p>Ans: Antivirus</p> </blockquote> <p>Question: Which PC Antivirus vendor implemented the first AV software on the market?</p> <blockquote> <p>McAfee</p> </blockquote> <p>Question: Antivirus software is a _____-based security solution.</p> <blockquote> <p>host-based</p> </blockquote> </details> <h2 id=task-3-antivirus-features><strong>Task 3: Antivirus Features</strong><a class=headerlink href=#task-3-antivirus-features title="Permanent link">&para;</a></h2> <h3 id=antivirus-engines><strong>Antivirus Engines</strong><a class=headerlink href=#antivirus-engines title="Permanent link">&para;</a></h3> <p>An AV engine is responsible for finding and removing malicious code and files. Good AV software implements an effective and solid AV core that accurately and quickly analyzes malicious files. Also, It should handle and support various file types, including archive files, where it can self-extract and inspect all compressed files.</p> <p>Most AV products share the same common features but are implemented differently, including but not limited to:</p> <ul> <li>Scanner</li> <li>Detection techniques</li> <li>Compressors and Archives</li> <li>Unpackers</li> <li>Emulators</li> </ul> <h3 id=scanner><strong>Scanner</strong><a class=headerlink href=#scanner title="Permanent link">&para;</a></h3> <p>The scanner feature is included in most AV products: AV software runs and scans in real-time or on-demand. This feature is available in the GUI or through the command prompt. The user can use it whenever required to check files or directories. The scanning feature must support the most known malicious file types to detect and remove the threat. In addition, it also may support other types of scanning depending on the AV software, including vulnerabilities, emails, Windows memory, and Windows Registry.</p> <h3 id=detection-techniques><strong>Detection techniques</strong><a class=headerlink href=#detection-techniques title="Permanent link">&para;</a></h3> <p>An AV detection technique searches for and detects malicious files; different detection techniques can be used within the AV engine, including:</p> <ul> <li>Signature-based detection is the traditional AV technique that looks for predefined malicious patterns and signatures within files.</li> <li>Heuristic detection is a more advanced technique that includes various behavioral methods to analyze suspicious files.</li> <li>Dynamic detection is a technique that includes monitoring the system calls and APIs and testing and analyzing in an isolated environment.</li> </ul> <p>We will cover these techniques in the next task. A good AV engine is accurate and quickly detects malicious files with fewer false-positive results. We will showcase several AV products that provide inaccurate results and misclassify a file.</p> <h3 id=compressors-and-archives><strong>Compressors and Archives</strong><a class=headerlink href=#compressors-and-archives title="Permanent link">&para;</a></h3> <p>The "Compressors and Archives" feature should be included in any AV software. It must support and be able to deal with various system file types, including compressed or archived files: ZIP, TGZ, 7z, XAR, RAR, etc. Malicious code often tries to evade host-based security solutions by hiding in compressed files. For this reason, AV software must decompress and scan through all files before a user opens a file within the archive.</p> <h3 id=pe-portable-executable-parsing-and-unpackers><strong>PE (Portable Executable) Parsing and Unpackers</strong><a class=headerlink href=#pe-portable-executable-parsing-and-unpackers title="Permanent link">&para;</a></h3> <p>Malware hides and packs its malicious code by compressing and encrypting it within a payload. It decompresses and decrypts itself during runtime to make it harder to perform static analysis. Thus, AV software must be able to detect and unpack most of the known packers (UPX, Armadillo, ASPack, etc.) before the runtime for static analysis.</p> <p>Malware developers use various techniques, such as Packing, to shrink the size and change the malicious file's structure. Packing compresses the original executable file to make it harder to analyze. Therefore, AV software must have an unpacker feature to unpack protected or compressed executable files into the original code.</p> <p>Another feature that AV software must have is Windows Portable Executable (PE) header parser. Parsing PE of executable files helps distinguish malicious and legitimate software (.exe files). The PE file format in Windows (32 and 64 bits) contains various information and resources, such as object code, DLLs, icon files, font files, and core dumps.</p> <h3 id=emulators><strong>Emulators</strong><a class=headerlink href=#emulators title="Permanent link">&para;</a></h3> <p>An emulator is an Antivirus feature that does further analysis on suspicious files. Once an emulator receives a request, the emulator runs the suspect (exe, DLL, PDF, etc.) files in a virtualized and controlled environment. It monitors the executable files' behavior during the execution, including the Windows APIs calls, Registry, and other Windows files. The following are examples of the artifacts that the emulator may collect:</p> <ul> <li>API calls</li> <li>Memory dumps</li> <li>Filesystem modifications</li> <li>Log events</li> <li>Running processes</li> <li>Web requests</li> </ul> <p>An emulator stops the execution of a file when enough artifacts are collected to detect malware.</p> <h3 id=other-common-features><strong>Other common features</strong><a class=headerlink href=#other-common-features title="Permanent link">&para;</a></h3> <p>The following are some common features found in AV products:</p> <ul> <li>A self-protection driver to guard against malware attacking the actual AV.</li> <li>Firewall and network inspection functionality.</li> <li>Command-line and graphical interface tools.</li> <li>A daemon or service.</li> <li>A management console.</li> </ul> <details class=question> <summary>Answer the questions bellow</summary> <p>Question: Which AV feature analyzes malware in a safe and isolated environment?</p> <blockquote> <p>Ans: Emulators</p> </blockquote> <p>Question: An _______ feature is a process of restoring or decrypting the compressed executable files to the original. </p> <blockquote> <p>Ans: Unpackers</p> </blockquote> <p>Question: Read the above to proceed to the next task, where we discuss the AV detection techniques.</p> <blockquote> <p>Ans: No answer needed</p> </blockquote> </details> <h2 id=task-4-deploy-the-vm><strong>Task 4: Deploy the VM</strong><a class=headerlink href=#task-4-deploy-the-vm title="Permanent link">&para;</a></h2> <p>We have provided a Windows machine 10 Pro to complete this room. The VM can be accessed through the in-browser feature. Once the VM is deployed, your browser should split into two windows, as the following:</p> <p><img alt src=image-3.png></p> <p>If the browser doesn't split, you can select the "Show Split View" bottom located at the top of your browser.</p> <p><img alt src=image-4.png></p> <p>You can also connect via RDP, make sure you deploy the AttackBox or connect to the VPN.</p> <p>Use the following credentials below.</p> <div style="text-align: center"> Machine IP: <strong style=color:red>MACHINE_IP</strong> Username: <strong style=color:red>thm</strong> Password: <strong style=color:red>TryHackM3</strong> </div> <div class=highlight><span class=filename>Connect to the VM via the RDP client</span><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=n>user</span><span class=nv>@machine</span><span class=p>$</span> <span class=n>xfreerdp</span> <span class=p>/</span><span class=n>v</span><span class=p>:</span><span class=n>MACHINE_IP</span> <span class=p>/</span><span class=n>u</span><span class=p>:</span><span class=n>thm</span> <span class=p>/</span><span class=n>p</span><span class=p>:</span><span class=n>TryHackM3</span>
</code></pre></div> <details class=question> <summary>Answer the questions bellow</summary> <p>Question: Once you've deployed the VM, it will take a few minutes to boot up. Then, progress to the next task!</p> <blockquote> <p>Ans: No answer needed</p> </blockquote> </details> <h2 id=task-5-av-static-detection><strong>Task 5: AV Static Detection</strong><a class=headerlink href=#task-5-av-static-detection title="Permanent link">&para;</a></h2> <p>Generally speaking, AV detection can be classified into three main approaches:</p> <ul> <li>Static Detection</li> <li>Dynamic Detection</li> <li>Heuristic and Behavioral Detection </li> </ul> <h3 id=static-detection><strong>Static Detection</strong><a class=headerlink href=#static-detection title="Permanent link">&para;</a></h3> <p>A static detection technique is the simplest type of Antivirus detection, which is based on predefined signatures of malicious files. Simply, it uses pattern-matching techniques in the detection, such as finding a unique string, CRC (Checksums), sequence of bytecode/Hex values, and Cryptographic hashes (MD5, SHA1, etc.).</p> <p>It then performs a set of comparisons between existing files within the operating system and a database of signatures. If the signature exists in the database, then it is considered malicious. This method is effective against static malware.</p> <p><img alt src=image-5.png></p> <p>In this task, we will be using a signature-based detection method to see how antivirus products detect malicious files. It is important to note that this technique works against known malicious files only with pre-generated signatures in a database. Thus, the database needs to be updated from time to time.</p> <p>We will use the ClamAV antivirus software to demonstrate how signature-based detection identifies malicious files. The ClamAV software is pre-installed in the provided VM, and we can access it in the following path: c:\Program Files\ClamAV\clamscan.exe. We will also scan a couple of malware samples, which can be found on the desktop. The Malware samples folder contains the following files:</p> <ol> <li><strong>EICAR</strong> is a test file containing ASCII strings used to test AV software's effectiveness instead of real malware that could damage your machine. For more information, you may visit the official EICAR website, Here.</li> <li><strong>Backdoor 1</strong> is a C# program that uses a well-known technique to establish a reverse connection, including creating a process and executing a Metasploit Framework shellcode.</li> <li><strong>Backdoor 2</strong> is a C# program that uses process injection and encryption to establish a reverse connection, including injecting a Metasploit shellcode into an existing and running process.</li> <li><strong>AV-Check</strong> is a C# program that enumerates AV software in a target machine. Note that this file is not malicious. We will discuss this tool in more detail in task 6. </li> <li><strong>notes.txt</strong> is a text file that contains a command line. Note that this file is not malicious.</li> </ol> <p>ClamAV comes with its database, and during the installation, we need to download the recently updated version. Let's try to scan the Malware sample folder using the <strong>clamscan.exe</strong> binary and check how ClamAV performs against these samples.</p> <div class=highlight><span class=filename>Command Prompt</span><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=n>c</span><span class=p>:\&gt;</span><span class=s2>&quot;c:\Program Files\ClamAV\clamscan.exe&quot;</span> <span class=n>c</span><span class=p>:\</span><span class=n>Users</span><span class=p>\</span><span class=n>thm</span><span class=p>\</span><span class=n>Desktop</span><span class=p>\</span><span class=n>Samples</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=n>Loading</span><span class=p>:</span>    <span class=n>22s</span><span class=p>,</span> <span class=n>ETA</span><span class=p>:</span>   <span class=n>0s</span> <span class=p>[========================&gt;]</span>    <span class=n>8</span><span class=p>.</span><span class=n>61M</span><span class=p>/</span><span class=n>8</span><span class=p>.</span><span class=n>61M</span> <span class=n>sigs</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=n>Compiling</span><span class=p>:</span>   <span class=n>4s</span><span class=p>,</span> <span class=n>ETA</span><span class=p>:</span>   <span class=n>0s</span> <span class=p>[========================&gt;]</span>       <span class=n>41</span><span class=p>/</span><span class=n>41</span> <span class=n>tasks</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=n>C</span><span class=p>:\</span><span class=n>Users</span><span class=p>\</span><span class=n>thm</span><span class=p>\</span><span class=n>Desktop</span><span class=p>\</span><span class=n>Samples</span><span class=p>\</span><span class=n>AV-Check</span><span class=p>.</span><span class=n>exe</span><span class=p>:</span> <span class=n>OK</span>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=n>C</span><span class=p>:\</span><span class=n>Users</span><span class=p>\</span><span class=n>thm</span><span class=p>\</span><span class=n>Desktop</span><span class=p>\</span><span class=n>Samples</span><span class=p>\</span><span class=n>backdoor1</span><span class=p>.</span><span class=n>exe</span><span class=p>:</span> <span class=n>Win</span><span class=p>.</span><span class=n>Malware</span><span class=p>.</span><span class=n>Swrort</span><span class=p>-</span><span class=n>9872015</span><span class=p>-</span><span class=n>0</span> <span class=n>FOUND</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=n>C</span><span class=p>:\</span><span class=n>Users</span><span class=p>\</span><span class=n>thm</span><span class=p>\</span><span class=n>Desktop</span><span class=p>\</span><span class=n>Samples</span><span class=p>\</span><span class=n>backdoor2</span><span class=p>.</span><span class=n>exe</span><span class=p>:</span> <span class=n>OK</span>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=n>C</span><span class=p>:\</span><span class=n>Users</span><span class=p>\</span><span class=n>thm</span><span class=p>\</span><span class=n>Desktop</span><span class=p>\</span><span class=n>Samples</span><span class=p>\</span><span class=n>eicar</span><span class=p>.</span><span class=n>com</span><span class=p>:</span> <span class=n>Win</span><span class=p>.</span><span class=n>Test</span><span class=p>.</span><span class=n>EICAR_HDB</span><span class=p>-</span><span class=n>1</span> <span class=n>FOUND</span>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=n>C</span><span class=p>:\</span><span class=n>Users</span><span class=p>\</span><span class=n>thm</span><span class=p>\</span><span class=n>Desktop</span><span class=p>\</span><span class=n>Samples</span><span class=p>\</span><span class=n>notes</span><span class=p>.</span><span class=n>txt</span><span class=p>:</span> <span class=n>OK</span>
</code></pre></div> <p>The above output shows that ClamAV software correctly analyzed and flagged two of our tested files (EICAR, backdoor1, AV-Check, and notes.txt) as malicious. However, it incorrectly identified the backdoor2 as non-malicious while it does.</p> <p>You can run <code>clamscan.exe --debug &lt;file_to_scan&gt;</code>, and you will see all modules loaded and used during the scanning. For example, it uses the unpacking method to split the files and look for a predefined malicious sequence of bytecode values, and that is how it was able to detect the C# backdoor 1. The bytecode value of the Metasploit shellcode used in backdoor 1 was previously identified and added to ClamAV's database. </p> <p>However, backdoor 2 uses an encryption technique (XOR) for the Metasploit shellcode, resulting in different sequences of bytecode values that it doesn't find in the ClamAV database. </p> <p>While the ClamAV was able to detect the EICAR.COM test file as malicious using the md5 signature-based technique. To confirm this, we can re-scan the EICAR.COM test file again in debug mode (--debug). At some point in the output, you will see the following message:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=n>LibClamAV</span> <span class=n>debug</span><span class=p>:</span> <span class=n>FP</span> <span class=n>SIGNATURE</span><span class=p>:</span> <span class=n>44d88612fea8a8f36de82e1278abb02f</span><span class=p>:</span><span class=n>68</span><span class=p>:</span><span class=n>Win</span><span class=p>.</span><span class=n>Test</span><span class=p>.</span><span class=n>EICAR_HDB</span><span class=p>-</span><span class=n>1</span>  <span class=c># Name: eicar.com, Type: CL_TYPE_TEXT_ASCII</span>
</code></pre></div> <p>ï»¿Now let's generate the md5 value of the EICAR.COM if it matches what we see in the previous message from the output. We will be using the sigtool for that: </p> <div class=highlight><span class=filename>Command Prompt</span><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=n>c</span><span class=p>:\&gt;</span><span class=s2>&quot;c:\Program Files\ClamAV\sigtool.exe&quot;</span> <span class=p>-</span><span class=n>-md5</span> <span class=n>c</span><span class=p>:\</span><span class=n>Users</span><span class=p>\</span><span class=n>thm</span><span class=p>\</span><span class=n>Desktop</span><span class=p>\</span><span class=n>Samples</span><span class=p>\</span><span class=n>eicar</span><span class=p>.</span><span class=n>com</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=n>44d88612fea8a8f36de82e1278abb02f</span><span class=p>:</span><span class=n>68</span><span class=p>:</span><span class=n>eicar</span><span class=p>.</span><span class=n>com</span>
</code></pre></div> <p>If you closely check the generated MD5 value, <code>44d88612fea8a8f36de82e1278abb02f</code>, it matches.</p> <h3 id=create-your-own-signature-database><strong>Create Your Own Signature Database</strong><a class=headerlink href=#create-your-own-signature-database title="Permanent link">&para;</a></h3> <p>One of ClamAV's features is creating your own database, allowing you to include items not found in the official ClamAV database. Let's try to create a signature for Backdoor 2, which ClamAV already missed, and add it to a database. The following are the required steps:</p> <ol> <li>Generate an MD5 signature for the file.</li> <li>Add the generated signature into a database with the extension ".hdb".</li> <li>Re-scan the ClamAV against the file using our new database. First, we will be using the <code>sigtool</code> tool, which is included in the ClamAV suite, to generate an MD5 hash of <code>backdoor2.exe</code> using the <code>--md5</code> argument.</li> </ol> <div class=highlight><span class=filename>Generate an MD5 hash</span><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=n>C</span><span class=p>:\</span><span class=n>Users</span><span class=p>\</span><span class=n>thm</span><span class=p>\</span><span class=n>Desktop</span><span class=p>\</span><span class=n>Samples</span><span class=p>&gt;</span><span class=s2>&quot;c:\Program Files\ClamAV\sigtool.exe&quot;</span> <span class=p>-</span><span class=n>-md5</span> <span class=n>backdoor2</span><span class=p>.</span><span class=n>exe</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=n>75047189991b1d119fdb477fef333ceb</span><span class=p>:</span><span class=n>6144</span><span class=p>:</span><span class=n>backdoor2</span><span class=p>.</span><span class=n>exe</span> 
</code></pre></div> <p>As shown in the output, the generated hash string contains the following structure: <code>Hash:Size-in-byte:FileName</code>. Note that ClamAV uses the generated value in the comparison during the scan.</p> <p>Now that we have the MD5 hash, now let's create our own database. We will use the <code>sigtool</code> tool and save the output into a file using the <code>&gt; thm.hdb</code> as follows,</p> <div class=highlight><span class=filename>Generate our new database</span><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=n>C</span><span class=p>:\</span><span class=n>Users</span><span class=p>\</span><span class=n>thm</span><span class=p>\</span><span class=n>Desktop</span><span class=p>\</span><span class=n>Samples</span><span class=p>&gt;</span><span class=s2>&quot;c:\Program Files\ClamAV\sigtool.exe&quot;</span> <span class=p>-</span><span class=n>-md5</span> <span class=n>backdoor2</span><span class=p>.</span><span class=n>exe</span> <span class=p>&gt;</span> <span class=n>thm</span><span class=p>.</span><span class=n>hdb</span>
</code></pre></div> <p>As a result, a <code>thm.hdb</code> file will be created in the current directory that executes the command. </p> <p>We already know that ClamAV did not detect the backdoor2.exe using the official database! Now, let's re-scan it using the database we created, <code>thm.hdb</code>, and see the result!</p> <div class=highlight><span class=filename>Re-scanning backdoor2.exe using the new database!</span><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=n>C</span><span class=p>:\</span><span class=n>Users</span><span class=p>\</span><span class=n>thm</span><span class=p>\</span><span class=n>Desktop</span><span class=p>\</span><span class=n>Samples</span><span class=p>&gt;</span><span class=s2>&quot;c:\Program Files\ClamAV\clamscan.exe&quot;</span> <span class=n>-d</span> <span class=n>thm</span><span class=p>.</span><span class=n>hdb</span> <span class=n>backdoor2</span><span class=p>.</span><span class=n>exe</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=n>Loading</span><span class=p>:</span>     <span class=n>0s</span><span class=p>,</span> <span class=n>ETA</span><span class=p>:</span>   <span class=n>0s</span> <span class=p>[========================&gt;]</span>        <span class=n>1</span><span class=p>/</span><span class=n>1</span> <span class=n>sigs</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=n>Compiling</span><span class=p>:</span>   <span class=n>0s</span><span class=p>,</span> <span class=n>ETA</span><span class=p>:</span>   <span class=n>0s</span> <span class=p>[========================&gt;]</span>       <span class=n>10</span><span class=p>/</span><span class=n>10</span> <span class=n>tasks</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=n>C</span><span class=p>:\</span><span class=n>Users</span><span class=p>\</span><span class=n>thm</span><span class=p>\</span><span class=n>Desktop</span><span class=p>\</span><span class=n>Samples</span><span class=p>\</span><span class=n>backdoor2</span><span class=p>.</span><span class=n>exe</span><span class=p>:</span> <span class=n>backdoor2</span><span class=p>.</span><span class=n>exe</span><span class=p>.</span><span class=n>UNOFFICIAL</span> <span class=n>FOUND</span>
</code></pre></div> <p>As we expected, the <code>ClamAV</code> tool flagged the <code>backdoor2.exe</code> binary as malicious based on the database we provided. As a practice, add the AV-Check.exe's MD5 signature into the same database we already created, then check whether ClamAV can flag AV-Check.exe as malicious.</p> <h3 id=yara-rules-for-static-detection><strong>Yara Rules for Static Detection</strong><a class=headerlink href=#yara-rules-for-static-detection title="Permanent link">&para;</a></h3> <p>One of the tools that help in static detection is <a href=http://virustotal.github.io/yara/ >Yara</a>. Yara is a tool that allows malware engineers to classify and detect malware. Yara uses rule-based detection, so in order to detect new malware, we need to create a new rule. ClamAV can also deal with Yara rules to detect malicious files. The rule will be the same as in our database in the previous section. </p> <p>To create a rule, we need to examine and analyze the malware; based on the findings, we write a rule. Let's take AV-Check.exe as an example and write a rule for it. </p> <p>First, let's analyze the file and list all human-readable strings in the binary using the strings tool. As a result, we will see all functions, variables, and nonsense strings. But, if you look closely, we can use some of the unique strings in our rules to detect this file in the future. The AV-Check uses a program database (.pdb), which contains a type and symbolic debugging information of the program during the compiling.</p> <div class=highlight><span class=filename>Command Prompt</span><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=n>C</span><span class=p>:\</span><span class=n>Users</span><span class=p>\</span><span class=n>thm</span><span class=p>\</span><span class=n>Desktop</span><span class=p>\</span><span class=n>Samples</span><span class=p>&gt;</span><span class=n>strings</span> <span class=n>AV-Check</span><span class=p>.</span><span class=n>exe</span> <span class=p>|</span> <span class=n>findstr</span> <span class=n>pdb</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=n>C</span><span class=p>:\</span><span class=n>Users</span><span class=p>\</span><span class=n>thm</span><span class=p>\</span><span class=n>source</span><span class=p>\</span><span class=n>repos</span><span class=p>\</span><span class=n>AV-Check</span><span class=p>\</span><span class=n>AV-Check</span><span class=p>\</span><span class=n>obj</span><span class=p>\</span><span class=n>Debug</span><span class=p>\</span><span class=n>AV-Check</span><span class=p>.</span><span class=n>pdb</span>
</code></pre></div> <p>We will use the path in the previous command's output as our unique string example in the Yara rule that we will create. The signature could be something else in the real world, such as Registry keys, commands, etc. If you are not familiar with Yara, then we suggest checking the Yara THM room. The following is Yara's rule that we will use in our detection:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>rule thm_demo_rule {
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>    meta:
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>        author = &quot;THM: Intro-to-AV-Room&quot;
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>        description = &quot;Look at how the Yara rule works with ClamAV&quot;
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>    strings:
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>        $a = &quot;C:\\Users\\thm\\source\\repos\\AV-Check\\AV-Check\\obj\\Debug\\AV-Check.pdb&quot;
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>    condition:
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a>        $a
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>}
</code></pre></div> <p>Let's explain this Yara's rule a bit more.</p> <ul> <li>The rule starts with <code>rule thm_demo_rule</code>, which is the name of our rule. ClamAV uses this name if a rule matches.</li> <li>The metadata section, which is general information, contains the author and description, which the user can fill.</li> <li>The strings section contains the strings or bytecode that we are looking for. We are using the C# program's database path in this case. Notice that we add an extra in that path to escape the special character, so it does not break the rule. In the condition section, we specify if the defined string is found in the string section, then flag the file.</li> </ul> <p>Note that Yara rules must store in a <code>.yara</code> extension file for ClamAV to deal with it. Let's re-scan the <code>c:\Users\thm\Desktop\Samples</code> folder again using the Yara rule we created. You can find a copy of the Yara rule on the desktop at <code>c:\Users\thm\Desktop\Files\thm-demo-1.yara</code>.</p> <div class=highlight><span class=filename>Scanning using the Yara rule</span><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=n>C</span><span class=p>:\</span><span class=n>Users</span><span class=p>\</span><span class=n>thm</span><span class=p>&gt;</span><span class=s2>&quot;c:\Program Files\ClamAV\clamscan.exe&quot;</span> <span class=n>-d</span> <span class=n>Desktop</span><span class=p>\</span><span class=n>Files</span><span class=p>\</span><span class=n>thm-demo</span><span class=p>-</span><span class=n>1</span><span class=p>.</span><span class=n>yara</span> <span class=n>Desktop</span><span class=p>\</span><span class=n>Samples</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=n>Loading</span><span class=p>:</span>     <span class=n>0s</span><span class=p>,</span> <span class=n>ETA</span><span class=p>:</span>   <span class=n>0s</span> <span class=p>[========================&gt;]</span>        <span class=n>1</span><span class=p>/</span><span class=n>1</span> <span class=n>sigs</span>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=n>Compiling</span><span class=p>:</span>   <span class=n>0s</span><span class=p>,</span> <span class=n>ETA</span><span class=p>:</span>   <span class=n>0s</span> <span class=p>[========================&gt;]</span>       <span class=n>40</span><span class=p>/</span><span class=n>40</span> <span class=n>tasks</span>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=n>C</span><span class=p>:\</span><span class=n>Users</span><span class=p>\</span><span class=n>thm</span><span class=p>\</span><span class=n>Desktop</span><span class=p>\</span><span class=n>Samples</span><span class=p>\</span><span class=n>AV-Check</span><span class=p>.</span><span class=n>exe</span><span class=p>:</span> <span class=n>YARA</span><span class=p>.</span><span class=n>thm_demo_rule</span><span class=p>.</span><span class=n>UNOFFICIAL</span> <span class=n>FOUND</span>
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=n>C</span><span class=p>:\</span><span class=n>Users</span><span class=p>\</span><span class=n>thm</span><span class=p>\</span><span class=n>Desktop</span><span class=p>\</span><span class=n>Samples</span><span class=p>\</span><span class=n>backdoor1</span><span class=p>.</span><span class=n>exe</span><span class=p>:</span> <span class=n>OK</span>
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=n>C</span><span class=p>:\</span><span class=n>Users</span><span class=p>\</span><span class=n>thm</span><span class=p>\</span><span class=n>Desktop</span><span class=p>\</span><span class=n>Samples</span><span class=p>\</span><span class=n>backdoor2</span><span class=p>.</span><span class=n>exe</span><span class=p>:</span> <span class=n>OK</span>
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=n>C</span><span class=p>:\</span><span class=n>Users</span><span class=p>\</span><span class=n>thm</span><span class=p>\</span><span class=n>Desktop</span><span class=p>\</span><span class=n>Samples</span><span class=p>\</span><span class=n>eicar</span><span class=p>.</span><span class=n>com</span><span class=p>:</span> <span class=n>OK</span>
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=n>C</span><span class=p>:\</span><span class=n>Users</span><span class=p>\</span><span class=n>thm</span><span class=p>\</span><span class=n>Desktop</span><span class=p>\</span><span class=n>Samples</span><span class=p>\</span><span class=n>notes</span><span class=p>.</span><span class=n>txt</span><span class=p>:</span> <span class=n>YARA</span><span class=p>.</span><span class=n>thm_demo_rule</span><span class=p>.</span><span class=n>UNOFFICIAL</span> <span class=n>FOUND</span>
</code></pre></div> <p>As a result, ClamAV can detect the <code>AV-Check.exe</code> binary as malicious based on the Yara rule we provide. However, ClamAV gave a false-positive result where it flagged the <code>notes.txt</code> file as malicious. If we open the <code>notes.txt</code> file, we can see that the text contains the same path we specified in the rule.</p> <p>Let's improve our Yara rule to reduce the false-positive result. We will be specifying the file type in our rule. Often, the types of a file can be identified using magic numbers, which are the first two bytes of the binary. For example, <a href=https://en.wikipedia.org/wiki/DOS_MZ_executable>executable files</a> (.exe) always start with the ASCII "MZ" value or "4D 5A" in hex.</p> <p>To confirm this, let's use the <a href=https://mh-nexus.de/en/hxd/ >HxD</a> application, which is a freeware Hex Editor, to examine the AV-Check.exe binary and see the first two bytes. Note that the HxD is already available in the provided VM.</p> <p><img alt src=image-6.png></p> <p>Knowing this will help improve the detection, let's include this in our Yara rule to flag only the .exe files that contain our signature string as malicious. The following is the improved Yara rule:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>rule thm_demo_rule {
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>    meta:
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>        author = &quot;THM: Intro-to-AV-Room&quot;
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>        description = &quot;Look at how the Yara rule works with ClamAV&quot;
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>    strings:
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a>        $a = &quot;C:\\Users\\thm\\source\\repos\\AV-Check\\AV-Check\\obj\\Debug\\AV-Check.pdb&quot;
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>        $b = &quot;MZ&quot;
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>    condition:
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>        $b at 0 and $a
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>}
</code></pre></div> <p>In the new Yara rule, we defined a unique string ($b) equal to the MZ as an identifier for the .exe file type. We also updated the condition section, which now includes the following conditions:</p> <ol> <li>If the string "MZ" is found at the 0 location, the file's beginning.</li> <li>If the unique string (the path) occurs within the binary.</li> <li>In the condition section, we used the <code>AND</code> operator for both definitions in 1 and 2 are found, then we have a match. </li> </ol> <p>You can find the updated rule in <code>Desktop\Files\thm-demo-2.yara</code>. Now that we have our updated Yara rule, now let's try it again.</p> <div class=highlight><span class=filename>Scanning using the Yara rule</span><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=n>C</span><span class=p>:\</span><span class=n>Users</span><span class=p>\</span><span class=n>thm</span><span class=p>&gt;</span><span class=s2>&quot;c:\Program Files\ClamAV\clamscan.exe&quot;</span> <span class=n>-d</span> <span class=n>Desktop</span><span class=p>\</span><span class=n>Files</span><span class=p>\</span><span class=n>thm-demo</span><span class=p>-</span><span class=n>2</span><span class=p>.</span><span class=n>yara</span> <span class=n>Desktop</span><span class=p>\</span><span class=n>Samples</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=n>Loading</span><span class=p>:</span>     <span class=n>0s</span><span class=p>,</span> <span class=n>ETA</span><span class=p>:</span>   <span class=n>0s</span> <span class=p>[========================&gt;]</span>        <span class=n>1</span><span class=p>/</span><span class=n>1</span> <span class=n>sigs</span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=n>Compiling</span><span class=p>:</span>   <span class=n>0s</span><span class=p>,</span> <span class=n>ETA</span><span class=p>:</span>   <span class=n>0s</span> <span class=p>[========================&gt;]</span>       <span class=n>40</span><span class=p>/</span><span class=n>40</span> <span class=n>tasks</span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=n>C</span><span class=p>:\</span><span class=n>Users</span><span class=p>\</span><span class=n>thm</span><span class=p>\</span><span class=n>Desktop</span><span class=p>\</span><span class=n>Samples</span><span class=p>\</span><span class=n>AV-Check</span><span class=p>.</span><span class=n>exe</span><span class=p>:</span> <span class=n>YARA</span><span class=p>.</span><span class=n>thm_demo_rule</span><span class=p>.</span><span class=n>UNOFFICIAL</span> <span class=n>FOUND</span>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=n>C</span><span class=p>:\</span><span class=n>Users</span><span class=p>\</span><span class=n>thm</span><span class=p>\</span><span class=n>Desktop</span><span class=p>\</span><span class=n>Samples</span><span class=p>\</span><span class=n>backdoor1</span><span class=p>.</span><span class=n>exe</span><span class=p>:</span> <span class=n>OK</span>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=n>C</span><span class=p>:\</span><span class=n>Users</span><span class=p>\</span><span class=n>thm</span><span class=p>\</span><span class=n>Desktop</span><span class=p>\</span><span class=n>Samples</span><span class=p>\</span><span class=n>backdoor2</span><span class=p>.</span><span class=n>exe</span><span class=p>:</span> <span class=n>OK</span>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=n>C</span><span class=p>:\</span><span class=n>Users</span><span class=p>\</span><span class=n>thm</span><span class=p>\</span><span class=n>Desktop</span><span class=p>\</span><span class=n>Samples</span><span class=p>\</span><span class=n>eicar</span><span class=p>.</span><span class=n>com</span><span class=p>:</span> <span class=n>OK</span>
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=n>C</span><span class=p>:\</span><span class=n>Users</span><span class=p>\</span><span class=n>thm</span><span class=p>\</span><span class=n>Desktop</span><span class=p>\</span><span class=n>Samples</span><span class=p>\</span><span class=n>notes</span><span class=p>.</span><span class=n>txt</span><span class=p>:</span> <span class=n>OK</span>
</code></pre></div> <details class=question> <summary>Answer the questions bellow</summary> <p>Question: What is the <code>sigtool</code> tool output to generate an MD5 of the AV-Check.exe binary?</p> <blockquote> <p>Ans: f4a974b0cf25dca7fbce8701b7ab3a88:6144:AV-Check.exe</p> </blockquote> <p>Question: Use the strings tool to list all human-readable strings of the AV-Check binary. What is the flag?</p> <blockquote> <p>Ans: THM{Y0uC4nC-5tr16s}</p> </blockquote> </details> <h2 id=task-6-other-detection-techniques><strong>Task 6: Other Detection Techniques</strong><a class=headerlink href=#task-6-other-detection-techniques title="Permanent link">&para;</a></h2> <p>The concept of static detection is relatively simple. In this section, we will discuss the different types of detection techniques.</p> <h3 id=dynamic-detection><strong>Dynamic Detection</strong><a class=headerlink href=#dynamic-detection title="Permanent link">&para;</a></h3> <p>The dynamic detection approach is advanced and more complicated than static detection. Dynamic detection is focused more on checking files at runtime using different methods. The following diagram shows the dynamic detection scanning flow:</p> <p><img alt src=image-7.png></p> <p>The first method is by monitoring Windows APIs. The detection engine inspects Windows application calls and monitors Windows API calls using Windows <a href=https://docs.microsoft.com/en-us/windows/win32/winmsg/about-hooks>Hooks</a>.</p> <p>Another method for dynamic detection is Sandboxing. A sandbox is a virtualized environment used to run malicious files separated from the host computer. This is usually done in an isolated environment, and the primary goal is to analyze how the malicious software acts in the system. Once the malicious software is confirmed, a unique signature and rule will be created based on the characteristic of the binary. Finally, a new update will be pushed into the cloud database for future use.</p> <p>This type of detection also has drawbacks because it requires executing and running the malicious software for a limited time in the virtual environment to protect the system resources. As with other detection techniques, dynamic detection can be bypassed. Malware developers implement their software to not work within the virtual or simulated environment to avoid dynamic analysis. For example, they check if the system spawns a real process of executing the software before running malicious activities or let the software wait sometime before execution.</p> <p>For more information about sandbox evasion, we suggest checking the THM room: <a href=https://tryhackme.com/room/sandboxevasion>Sandbox Evasion!</a></p> <h3 id=heuristic-and-behavioral-detection><strong>Heuristic and Behavioral Detection</strong><a class=headerlink href=#heuristic-and-behavioral-detection title="Permanent link">&para;</a></h3> <p>Heuristic and behavioral detection have become essential in today's modern AV products. Modern AV software relies on this type of detection to detect malicious software. The heuristic analysis uses various techniques, including static and dynamic heuristic methods:</p> <ol> <li>Static Heuristic Analysis is a process of decompiling (if possible) and extracting the source code of the malicious software. Then, the extracted source code is compared to other well-known virus source codes. These source codes are previously known and predefined in a heuristic database. If a match meets or exceeds a threshold percentage, the code is flagged as malicious.</li> <li> <p>Dynamic Heuristic Analysis is based on predefined behavioral rules. Security researchers analyzed suspicious software in isolated and secured environments. Based on their findings, they flagged the software as malicious. Then, behavioral rules are created to match the software's malicious activities within a target machine. The following are examples of behavioral rules: </p> </li> <li> <p>If a process tries to interact with the LSASS.exe process that contains users' NTLM hashes, Kerberos tickets, and more</p> </li> <li>If a process opens a listening port and waits to receive commands from a Command and Control (C2) server</li> </ol> <p>The following diagram shows the Heuristic and behavioral detection scanning flow:</p> <p><img alt src=image-8.png></p> <h3 id=summing-up-detection-methods><strong>Summing up detection methods</strong><a class=headerlink href=#summing-up-detection-methods title="Permanent link">&para;</a></h3> <p>Let's summarize how modern AV software works as one unit, including all components, and combines various features and detection techniques to implement its AV engine. The following is an example of the components of an antivirus engine:</p> <p><img alt src=image-9.png></p> <p>In the diagram, you can see a suspicious <code>Foobar.zip</code> file is passed to AV software to scan. AV software recognizes that it is a compressed file (.zip). Since the software supports .zip files, it applies an un-archiver feature to extract the files (<code>Foobar.exe</code>). Next, it identifies the file type to know which module to work with and then performs a PE parsing operation to pull the binary's information and other characteristic features. Next, it checks whether the file is packed; if it is, it unpacks the code. Finally, it passes the collected information and the binary to the AV engine, where it tries to detect if it is malicious and gives us the result.</p> <details class=question> <summary>Answer the questions bellow</summary> <p>Question: Which detection method is used to analyze malicious software inside virtual environments? </p> <blockquote> <p>Ans: Dynamic Detection</p> </blockquote> </details> <h2 id=task-7-av-testing-and-fingerprinting><strong>Task 7: AV Testing and Fingerprinting</strong><a class=headerlink href=#task-7-av-testing-and-fingerprinting title="Permanent link">&para;</a></h2> <h3 id=av-vendors><strong>AV Vendors</strong><a class=headerlink href=#av-vendors title="Permanent link">&para;</a></h3> <p>Many AV vendors in the market mainly focus on implementing a security product for home or enterprise users. Modern AV software has improved and now combines antivirus capabilities with other security features such as Firewall, Encryption, Anti-spam, EDR, vulnerability scanning, VPN, etc.</p> <p>It is important to note that it is hard to recommend which AV software is the best. It all comes down to user preferences and experience. Nowadays, AV vendors focus on business security in addition to end-user security. We suggest checking the <a href=https://www.av-comparatives.org/list-of-enterprise-av-vendors-pc/ >AV comparatives website</a> for more details on enterprise AV vendors.</p> <h3 id=av-testing-environment><strong>AV Testing Environment</strong><a class=headerlink href=#av-testing-environment title="Permanent link">&para;</a></h3> <p>AV testing environments are a great place to check suspicious or malicious files. You can upload files to get them scanned against various AV software vendors. Moreover, platforms such as VirusTotal use various techniques and provide results within seconds. As a red teamer or a pentester, we must test a payload against the most well-known AV applications to check the effectiveness of the bypass technique.</p> <h3 id=virustotal><strong>VirusTotal</strong><a class=headerlink href=#virustotal title="Permanent link">&para;</a></h3> <p><img alt src=image-10.png></p> <p>VirusTotal is a well-known web-based scanning platform for checking suspicious files. It allows users to upload files to be scanned with over 70 antivirus detection engines. VirusTotal passes the uploaded files to the Antivirus engines to be checked, returns the result, and reports whether it is malicious or not. Many checkpoints are applied, including checking for blacklisted URLs or services, signatures, binary analysis, behavioral analysis, as well as checking for API calls. In addition, the binary will be run and checked in a simulated and isolated environment for better results. For more information and to check other features, you may visit the <a href=https://www.virustotal.com/ >VirusTotal</a> website.</p> <h3 id=virustotal-alternatives><strong>VirusTotal alternatives</strong><a class=headerlink href=#virustotal-alternatives title="Permanent link">&para;</a></h3> <p><strong>Important Note</strong>: VirusTotal is a handy scanning platform with great features, but it has a sharing policy. All scanned results will be passed and shared with antivirus vendors to improve their products and update their databases for known malware. As a red teamer, this will burn a dropper or a payload you use in engagements. Thus, alternative solutions are available for testing against various security product vendors, and the most important advantage is that they do not have a sharing policy. However, there are other limitations. You will have a limited number of files to scan per day; otherwise, a subscription is needed for unlimited testing. For those reasons, we recommend you only test your malware on sites that do not share information, such as:</p> <ul> <li><a href=https://antiscan.me/ >AntiscanMe</a> (6 free scans a day)</li> <li><a href=https://virusscan.jotti.org/ >Virus Scan Jotti's malware scan</a></li> </ul> <h3 id=fingerprinting-av-software><strong>Fingerprinting AV software</strong><a class=headerlink href=#fingerprinting-av-software title="Permanent link">&para;</a></h3> <p>As a red teamer, we do not know what AV software is in place once we gain initial access to a target machine. Therefore, it is important to find and identify what host-based security products are installed, including AV software. AV fingerprinting is an essential process to determine which AV vendor is present. Knowing which AV software is installed is also quite helpful in creating the same environment to test bypass techniques. </p> <p>This section introduces different ways to look at and identify antivirus software based on static artifacts, including service names, process names, domain names, registry keys, and filesystems.</p> <p>The following table contains well-known and commonly used AV software. </p> <table> <thead> <tr> <th>Antivirus Name</th> <th>Service Name</th> <th>Process Name</th> </tr> </thead> <tbody> <tr> <td>Microsoft Defender</td> <td>WinDefend</td> <td>MSMpEng.exe</td> </tr> <tr> <td>Trend Micro</td> <td>TMBMSRV</td> <td>TMBMSRV.exe</td> </tr> <tr> <td>Avira</td> <td>AntivirService, Avira.ServiceHost</td> <td>avguard.exe, Avira.ServiceHost.exe</td> </tr> <tr> <td>Bitdefender</td> <td>VSSERV</td> <td>bdagent.exe, vsserv.exe</td> </tr> <tr> <td>Kaspersky</td> <td>AVP&lt;Version #></td> <td>avp.exe, ksde.exe</td> </tr> <tr> <td>AVG</td> <td>AVG Antivirus</td> <td>AVGSvc.exe</td> </tr> <tr> <td>Norton</td> <td>Norton Security</td> <td>NortonSecurity.exe</td> </tr> <tr> <td>McAfee</td> <td>McAPExe, Mfemms</td> <td>MCAPExe.exe, mfemms.exe</td> </tr> <tr> <td>Panda</td> <td>PavPrSvr</td> <td>PavPrSvr.exe</td> </tr> <tr> <td>Avast</td> <td>Avast Antivirus</td> <td>afwServ.exe, AvastSvc.exe</td> </tr> </tbody> </table> <h3 id=sharpedrchecker><strong>SharpEDRChecker</strong><a class=headerlink href=#sharpedrchecker title="Permanent link">&para;</a></h3> <p>One way to fingerprint AV is by using public tools such as <a href=https://github.com/PwnDexter/SharpEDRChecker>SharpEDRChecker</a>. It is written in C# and performs various checks on a target machine, including checks for AV software, like running processes, files' metadata, loaded DLL files, Registry keys, services, directories, and files.</p> <p>We have pre-downloaded the SharpEDRChecker from the <a href=https://github.com/PwnDexter/SharpEDRChecker>GitHub repo</a> so that we can use it in the attached VM. Now we need to compile the project, and we have already created a shortcut to the project on the desktop (SharpEDRChecker). To do so, double-click on it to open it in Microsoft Visual Studio 2022. Now that we have our project ready, we need to compile it, as shown in the following screenshot:</p> <p><img alt src=image-11.png></p> <p>Once it is compiled, we can find the path of the compiled version in the output section, as highlighted in step 3. We also added a copy of the compiled version in the <code>C:\Users\thm\Desktop\Files</code> directory. Now let's try to run it and see the result as follows:</p> <div class=grid> <div class=highlight><span class=filename>Command Prompt!</span><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=n>C</span><span class=p>:\&gt;</span> <span class=n>SharpEDRChecker</span><span class=p>.</span><span class=n>exe</span>
</code></pre></div> <div class=highlight><span class=filename>SharpEDRChecker's Summary</span><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=p>[!]</span> <span class=n>Directory</span> <span class=n>Summary</span><span class=p>:</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>   <span class=p>[-]</span> <span class=n>C</span><span class=p>:\</span><span class=n>Program</span> <span class=n>Files</span><span class=p>\</span><span class=n>Windows</span> <span class=n>Defender</span> <span class=p>:</span> <span class=n>defender</span>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>   <span class=p>[-]</span> <span class=n>C</span><span class=p>:\</span><span class=n>Program</span> <span class=n>Files</span><span class=p>\</span><span class=n>Windows</span> <span class=n>Defender</span> <span class=n>Advanced</span> <span class=n>Threat</span> <span class=n>Protection</span> <span class=p>:</span> <span class=n>defender</span><span class=p>,</span> <span class=n>threat</span>
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>   <span class=p>[-]</span> <span class=n>C</span><span class=p>:\</span><span class=n>Program</span> <span class=n>Files</span> <span class=p>(</span><span class=n>x86</span><span class=p>)\</span><span class=n>Windows</span> <span class=n>Defender</span> <span class=p>:</span> <span class=n>defender</span>
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>
<a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=p>[!]</span> <span class=n>Service</span> <span class=n>Summary</span><span class=p>:</span>
<a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a>   <span class=p>[-]</span> <span class=n>PsShutdownSvc</span> <span class=p>:</span> <span class=n>sysinternal</span>
<a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a>   <span class=p>[-]</span> <span class=n>Sense</span> <span class=p>:</span> <span class=n>defender</span><span class=p>,</span> <span class=n>threat</span>
<a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a>   <span class=p>[-]</span> <span class=n>WdNisSvc</span> <span class=p>:</span> <span class=n>defender</span><span class=p>,</span> <span class=n>nissrv</span>
<a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a>   <span class=p>[-]</span> <span class=n>WinDefend</span> <span class=p>:</span> <span class=n>antimalware</span><span class=p>,</span> <span class=n>defender</span><span class=p>,</span> <span class=n>malware</span><span class=p>,</span> <span class=n>msmpeng</span>
<a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a>   <span class=p>[-]</span> <span class=n>wscsvc</span> <span class=p>:</span> <span class=n>antivirus</span>
</code></pre></div> </div> <p>As a result, the Windows Defender is found based on folders and services. Note that this program may be flagged by AV software as malicious since it does various checks and APIs calls. </p> <h3 id=c-fingerprint-checks><strong>C# Fingerprint checks</strong><a class=headerlink href=#c-fingerprint-checks title="Permanent link">&para;</a></h3> <p>Another way to enumerate AV software is by coding our own program. We have prepared a C# program in the provided Windows 10 Pro VM, so we can do some hands-on experiments! You can find the project's icon on the desktop (AV-Check) and double-click it to open it using Microsoft Visual Studio 2022. </p> <p>The following C# code is straightforward, and its primary goal is to determine whether AV software is installed based on a predefined list of well-known AV applications.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=k>using</span><span class=w> </span><span class=nn>System</span><span class=p>;</span>
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=k>using</span><span class=w> </span><span class=nn>System.Management</span><span class=p>;</span>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=k>internal</span><span class=w> </span><span class=k>class</span><span class=w> </span><span class=nc>Program</span>
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=p>{</span>
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=w>    </span><span class=k>static</span><span class=w> </span><span class=k>void</span><span class=w> </span><span class=nf>Main</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span>
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=w>    </span><span class=p>{</span>
<a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=w>        </span><span class=kt>var</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>false</span><span class=p>;</span>
<a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=w>        </span><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&quot;[+] Antivirus check is running .. &quot;</span><span class=p>);</span>
<a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=w>        </span><span class=kt>string</span><span class=p>[]</span><span class=w> </span><span class=n>AV_Check</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span>
<a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=w>            </span><span class=s>&quot;MsMpEng.exe&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;AdAwareService.exe&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;afwServ.exe&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;avguard.exe&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;AVGSvc.exe&quot;</span><span class=p>,</span><span class=w> </span>
<a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=w>            </span><span class=s>&quot;bdagent.exe&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;BullGuardCore.exe&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;ekrn.exe&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;fshoster32.exe&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;GDScan.exe&quot;</span><span class=p>,</span><span class=w> </span>
<a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a><span class=w>            </span><span class=s>&quot;avp.exe&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;K7CrvSvc.exe&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;McAPExe.exe&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;NortonSecurity.exe&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;PavFnSvr.exe&quot;</span><span class=p>,</span><span class=w> </span>
<a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a><span class=w>            </span><span class=s>&quot;SavService.exe&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;EnterpriseService.exe&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;WRSA.exe&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;ZAPrivacyService.exe&quot;</span><span class=w> </span>
<a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a><span class=w>        </span><span class=p>};</span>
<a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a><span class=w>        </span><span class=kt>var</span><span class=w> </span><span class=n>searcher</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ManagementObjectSearcher</span><span class=p>(</span><span class=s>&quot;select * from win32_process&quot;</span><span class=p>);</span>
<a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a><span class=w>        </span><span class=kt>var</span><span class=w> </span><span class=n>processList</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>searcher</span><span class=p>.</span><span class=n>Get</span><span class=p>();</span>
<a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>0</span><span class=p>;</span>
<a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a><span class=w>        </span><span class=k>foreach</span><span class=w> </span><span class=p>(</span><span class=kt>var</span><span class=w> </span><span class=n>process</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>processList</span><span class=p>)</span>
<a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a><span class=w>        </span><span class=p>{</span>
<a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a><span class=w>            </span><span class=kt>int</span><span class=w> </span><span class=n>_index</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Array</span><span class=p>.</span><span class=n>IndexOf</span><span class=p>(</span><span class=n>AV_Check</span><span class=p>,</span><span class=w> </span><span class=n>process</span><span class=p>[</span><span class=s>&quot;Name&quot;</span><span class=p>].</span><span class=n>ToString</span><span class=p>());</span>
<a id=__codelineno-14-22 name=__codelineno-14-22 href=#__codelineno-14-22></a><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>_index</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=o>-</span><span class=m>1</span><span class=p>)</span>
<a id=__codelineno-14-23 name=__codelineno-14-23 href=#__codelineno-14-23></a><span class=w>            </span><span class=p>{</span>
<a id=__codelineno-14-24 name=__codelineno-14-24 href=#__codelineno-14-24></a><span class=w>                </span><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&quot;--AV Found: {0}&quot;</span><span class=p>,</span><span class=w> </span><span class=n>process</span><span class=p>[</span><span class=s>&quot;Name&quot;</span><span class=p>].</span><span class=n>ToString</span><span class=p>());</span>
<a id=__codelineno-14-25 name=__codelineno-14-25 href=#__codelineno-14-25></a><span class=w>                </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>true</span><span class=p>;</span>
<a id=__codelineno-14-26 name=__codelineno-14-26 href=#__codelineno-14-26></a><span class=w>            </span><span class=p>}</span>
<a id=__codelineno-14-27 name=__codelineno-14-27 href=#__codelineno-14-27></a><span class=w>            </span><span class=n>i</span><span class=o>++</span><span class=p>;</span>
<a id=__codelineno-14-28 name=__codelineno-14-28 href=#__codelineno-14-28></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-14-29 name=__codelineno-14-29 href=#__codelineno-14-29></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>status</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&quot;--AV software is not found!&quot;</span><span class=p>);</span><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-14-30 name=__codelineno-14-30 href=#__codelineno-14-30></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-14-31 name=__codelineno-14-31 href=#__codelineno-14-31></a><span class=p>}</span>
</code></pre></div> <p>Let's explain the code a bit more. We have predefined a list of well-known AV applications in the <code>AV_Check</code> array within our code, which is taken from the previous section, where we discussed fingerprinting AV software (table above). Then, we use the Windows Management Instrumentation Command-Line (WMIC) query (<code>select * from win32_process</code>) to list all currently running processes in the target machine and store them in the <code>processList</code> variable. Next, we go through the currently running processes and compare if they exist in the predefined array. If a match is found, then we have AV software installed.</p> <p>The C# program utilizes a WMIC object to list current running processes, which may be monitored by AV software. If AV software is poorly implemented to monitor the WMIC queries or Windows APIs, it may cause false-positive results in scanning our C# program.</p> <p>Let's compile an x86 version of the C# program, upload it to the VirusTotal website, and check the results! To compile the C# program in the Microsoft Visual Studio 2022, select <code>Build</code> from the bar menu and choose the <code>Build Solution</code> option. Then, if it complied correctly, you can find the path of the compiled version in the output section, as highlighted in step 3 in the screenshot below.</p> <p><img alt src=image-12.png></p> <p>If we upload the AV-Check program to the <a href=https://www.virustotal.com/gui/home/upload>VirusTotal website</a> and check the result, surprisingly, VirusTotal showed that two AV vendors (MaxSecure and SecureAge APEX) flagged our program as malicious! Thus, this is a false-positive result where it incorrectly identifies a file as malicious where it is not. One of the possible reasons is that these AV vendors' software uses a machine-learning classifier or rule-based detection method that is poorly implemented. For more details about the actual submission report, see <a href="https://www.virustotal.com/gui/file/5f7d3e6cf58596a0186d89c20004c76805769f9ef93dc39e346e7331eee9e7ff?nocache=1">here</a>. There are four main sections: Detection, Details, Behavior, and Community. If we check the Behavior section, we can see all calls of Windows APIs, Registry keys, modules, and the WMIC query.</p> <p><img alt src=image-13.png></p> <p>In the Detection section, there are Sigma rules that, if a system event during execution is matched (in the sandbox environment), consider the file malicious. This result is likely based on the rules; VirusTotal flagged our program because of the <a href=https://pentestlaboratories.com/2021/12/08/process-ghosting/ >Process Ghosting technique</a>, as shown in the following screenshot.</p> <p><img alt src=image-14.png></p> <p>Now let's re-compile the C# program using an x64 CPU and check if the check engines act differently. In our submission attempt this time, three AV vendors' software (Cyren AV is added to the list) flagged the file as malicious. For more details about the actual submission report, look <a href="https://www.virustotal.com/gui/file/b092173827888ed62adea0c2bf4f451175898d158608cf7090e668952314e308?nocache=1">here</a>. </p> <p><img alt src=image-15.png></p> <p><strong>Note:</strong> if you try to submit a file to the VirusTotal website, it may give you a different result. Keep in mind that VirusTotal shares submission reports with the Antivirus vendors to improve their AV detection engines, including false-positive results.</p> <details class=question> <summary>Answer the questions bellow</summary> <p>Question: For the C# AV fingerprint, try to rewrite the code in a different language, such as Python, and check whether VirusTotal flag it as malicious.</p> <blockquote> <p>Ans: No answer needed</p> </blockquote> <p>Question: Read the Above!</p> <blockquote> <p>Ans: No answer needed</p> </blockquote> </details> <h2 id=task-8-conclusion><strong>Task 8: Conclusion</strong><a class=headerlink href=#task-8-conclusion title="Permanent link">&para;</a></h2> <h3 id=recap><strong>Recap</strong><a class=headerlink href=#recap title="Permanent link">&para;</a></h3> <p>In this room, we covered Antivirus software and its detection approaches. As a red teamer, it is important to know how AV software works and detects malicious applications to be able to implement bypass techniques.</p> <p>We also discussed the static detection technique in detail and showcased how ClamAV, an open-source Antivirus, detects malicious files using static analysis. Additionally, we showed how to create your own database and use Yara rules to detect malicious files that are not detected by the official database.</p> <p>Once we obtain access to a target, it is essential to enumerate the target machine before performing further actions, such as privilege escalation or lateral movement. The reason is to not trigger alerts for suspicious activities, which may cause losing access to the target machine. Thus, we introduced two methods to practice AV fingerprinting using public and private tools.</p> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">September 16, 2023</span> <br> Created: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">September 16, 2023</span> </small> </div> <!-- Giscus --> <h2 id=__comments>Comments</h2> <!-- Replace with generated snippet --> <script src=https://giscus.app/client.js data-repo=hieuhdh/hieuhdh.github.io data-repo-id=R_kgDOHowGCg data-category=General data-category-id=DIC_kwDOHowGCs4CQLlU data-mapping=pathname data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=vi crossorigin=anonymous async>
  </script> <!-- Synchronize Giscus theme with palette --> <script>
    var giscus = document.querySelector("script[src*=giscus]")

    /* Set palette on initial load */
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "slate" ? "dark" : "light"
      giscus.setAttribute("data-theme", theme) 
    }

    /* Register event handlers after documented loaded */
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate" ? "dark" : "light"

          /* Instruct Giscus to change theme */
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })
  </script> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 0x5h1n0k0 </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../..", "features": ["content.code.annotate", "content.tooltips", "navigation.sections", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../../../assets/javascripts/bundle.6c7ad80a.min.js></script> <script src=../../../../assets/javascripts/cursor-effects.js></script> <!-- get ip
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <script>
            function taskService() {
                this.postListApi = function () {
                    return axios({
                        url: "https://api.ipify.org?format=json",
                        method: "GET",
                    });
                };
            }
            var TaskList = new taskService();

            TaskList.postListApi()
                .then(function (result) {

                    function taskService02() {
                        this.getListApiii = function () {
                            return axios({
                                url: "https://bedeu.herokuapp.com/iphomeposts/views/",
                                method: "POST",
                                data: {
                                    "ip": result.data.ip,
                                },
                            });
                        };
                    }
                    var TaskListList = new taskService02();

                    TaskListList.getListApiii()
                        .then(function (result) {
                            if (result.data.sl > 1) {
                                document.getElementById("view-user").innerHTML = result.data.sl + " times"
                            } else {
                                document.getElementById("view-user").innerHTML = result.data.sl + " time"
                            }
                        })
                        .catch(function (erro) {
                            console.log(erro)
                        });
                        
                    function taskService01() {
                        this.getListApii = function () {
                            return axios({
                                url: "https://bedeu.herokuapp.com/iphomeposts/views_total/",
                                method: "GET",
                            });
                        };
                    }
                    var TaskListt = new taskService01();

                    TaskListt.getListApii()
                        .then(function (result) {
                            document.getElementById("view-all").innerHTML = result.data
                        })
                        .catch(function (erro) {
                            console.log(erro)
                        });
                })
                .catch(function (erro) {});

        </script>

        <script>
            function taskServicePost() {
                this.postListApiTotal = function () {
                    return axios({
                        url: "https://api.ipify.org?format=json",
                        method: "GET",
                    });
                };
            }
            var TaskList = new taskServicePost();
            var arr = window.location.pathname.split('/');


            TaskList.postListApiTotal()
                .then(function (result) {

                    function taskServicePost02() {
                        this.getListApiUser = function () {
                            return axios({
                                url: "https://bedeu.herokuapp.com/ipposts/views/",
                                method: "POST",
                                data: {
                                    "ip": result.data.ip,
                                    "post": arr[arr.length - 2],
                                },
                            });
                        };
                    }
                    var TaskListUser = new taskServicePost02();

                    TaskListUser.getListApiUser()
                        .then(function (result) {
                            if (result.data.sl > 1) {
                                document.getElementById("view-post-user").innerHTML = result.data.sl + " times";
                            } else {
                                document.getElementById("view-post-user").innerHTML = result.data.sl + " time";
                            }
                        })
                        .catch(function (erro) {
                            console.log(erro)
                        });

                        function taskServicePost01() {
                        this.getListApiTotal = function () {
                            return axios({
                                url: "https://bedeu.herokuapp.com/ipposts/views_total/",
                                method: "POST",
                                data: {
                                    "post": arr[arr.length - 2],
                                },
                            });
                        };
                    }
                    var TaskListTotal = new taskServicePost01();

                    TaskListTotal.getListApiTotal()
                        .then(function (result) {
                            if (result.data > 1) {
                                document.getElementById("view-post-all").innerHTML = result.data + " times";
                            } else {
                                document.getElementById("view-post-all").innerHTML = result.data + " time";
                            }
                        })
                        .catch(function (erro) {
                            console.log(erro)
                        });
                })
                .catch(function (erro) {});

        </script> --> <script src=../../../../javascripts/consent.js></script> <script src=../../../../javascripts/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script src=https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js></script> <script src=../../../../javascripts/tablesort.js></script> </body> </html>